<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="韩乔落">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://jelasin.github.io/2024/08/19/ble蓝牙安全/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="前言学习参考 https:&#x2F;&#x2F;www.nordicsemi.cn&#x2F;，此外请先阅读博客种无线电安全专题的蓝牙安全部分。  常见攻击类型身份跟踪：利用蓝牙地址来跟踪设备。这可以通过使用随机变化的可解析私有地址（Resolvable Random Private Address）来避免，其中只有绑定&#x2F;可信设备才能解析私有地址。IRK（身份解析密钥）用于生成和解析私有地址。 被动窃听（嗅探）：就">
<meta property="og:type" content="article">
<meta property="og:title" content="BLE蓝牙安全">
<meta property="og:url" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/index.html">
<meta property="og:site_name" content="Jelasin">
<meta property="og:description" content="前言学习参考 https:&#x2F;&#x2F;www.nordicsemi.cn&#x2F;，此外请先阅读博客种无线电安全专题的蓝牙安全部分。  常见攻击类型身份跟踪：利用蓝牙地址来跟踪设备。这可以通过使用随机变化的可解析私有地址（Resolvable Random Private Address）来避免，其中只有绑定&#x2F;可信设备才能解析私有地址。IRK（身份解析密钥）用于生成和解析私有地址。 被动窃听（嗅探）：就">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725604289597-1.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725611892231-1.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725611892232-2.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725612005266-9.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725613943606-93.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-96.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-97.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-98.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-99.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617446630-108.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617446630-109.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-114.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-115.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-116.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320055-123.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-124.webp">
<meta property="og:image" content="https://jelasin.github.io/640-1725618320056-125.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-126.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-127.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-128.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-129.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-130.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-131.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781751-162.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781751-163.webp">
<meta property="og:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781752-164.webp">
<meta property="article:published_time" content="2024-08-19T03:12:11.000Z">
<meta property="article:modified_time" content="2024-09-09T03:45:54.275Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="BLE安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jelasin.github.io/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725604289597-1.webp">
    
    
        <!-- Google tag (gtag.js) -->
        <script src="https://www.googletagmanager.com/gtag/js?id=G-3333333333"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3333333333');
        </script>
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!--- Page Info-->
    
    <title>
        
            BLE蓝牙安全 | Jelasin
        
    </title>

    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/css/build/tailwind.css">
    

    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/GeistMono/geist-mono.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fonts/Geist/geist.css">
    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"jelasin.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":false,"family":"Farsan","url":"https://fonts.googleapis.com/css2?family=Farsan&display=swap"},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":false,"site_uv":false,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":true,"google_analytics":{"enable":true,"id":"G-3333333333"}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"“会当身由己，婉转入江湖”","subtitle":{"text":["Loading..."],"hitokoto":{"enable":true,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":null,"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Links":{"icon":"fa-regular fa-link","submenus":{"看雪":"https://bbs.kanxue.com/homepage-958172.htm","吾爱破解":"https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space","中国诗歌网":"https://www.zgshige.com/c/2022-04-13/21151100.shtml"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Essays":{"path":"/essays","icon":"fa-regular fa-comment"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"AI":{"path":"/AI","icon":"fa-brands fa-python"},"IOT":{"path":"/IOT","icon":"fas fa-network-wired"},"CTF":{"path":"/CTF","icon":"fa-solid fa-snowflake"},"Web":{"path":"/Web","icon":"fa-solid fa-shield"},"Linux":{"path":"/Linux","icon":"fa-brands fa-linux"},"Android":{"path":"/Android","icon":"fa-brands fa-android"},"Windows":{"path":"/Windows","icon":"fa-brands fa-windows"}}},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":4},"tags":{"enable":true,"limit":4}},"footerStart":"2023/9/20 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>



<body>
	<div class="progress-bar-container">
	
	<span class="scroll-progress-bar"></span>
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/favicon.ico" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Jelasin
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-958172.htm">
                                                    看雪
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space">
                                                    吾爱破解
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://www.zgshige.com/c/2022-04-13/21151100.shtml">
                                                    中国诗歌网
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://bbs.kanxue.com/homepage-958172.htm">看雪</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://www.52pojie.cn/home.php?mod=space&uid=2101606&do=thread&view=me&from=space">吾爱破解</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://www.zgshige.com/c/2022-04-13/21151100.shtml">中国诗歌网</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/essays"
                        >
                            <span>Essays</span>
                            <i class="fa-regular fa-comment fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/AI"
                        >
                            <span>AI</span>
                            <i class="fa-brands fa-python fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/IOT"
                        >
                            <span>IOT</span>
                            <i class="fas fa-network-wired fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/CTF"
                        >
                            <span>CTF</span>
                            <i class="fa-solid fa-snowflake fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Web"
                        >
                            <span>Web</span>
                            <i class="fa-solid fa-shield fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Linux"
                        >
                            <span>Linux</span>
                            <i class="fa-brands fa-linux fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Android"
                        >
                            <span>Android</span>
                            <i class="fa-brands fa-android fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/Windows"
                        >
                            <span>Windows</span>
                            <i class="fa-brands fa-windows fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">42</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">19</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">71</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">BLE蓝牙安全</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/touxiang.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">韩乔落</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-08-19 11:12:11</span>
        <span class="mobile">2024-08-19 11:12:11</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-09-09 11:45:54</span>
            <span class="mobile">2024-09-09 11:45:54</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E6%97%A0%E7%BA%BF%E7%94%B5%E5%AE%89%E5%85%A8/">无线电安全</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/BLE%E5%AE%89%E5%85%A8/">BLE安全</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>学习参考 <a class="link"   target="_blank" rel="noopener" href="https://www.nordicsemi.cn/%EF%BC%8C%E6%AD%A4%E5%A4%96%E8%AF%B7%E5%85%88%E9%98%85%E8%AF%BB%E5%8D%9A%E5%AE%A2%E7%A7%8D%E6%97%A0%E7%BA%BF%E7%94%B5%E5%AE%89%E5%85%A8%E4%B8%93%E9%A2%98%E7%9A%84%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8%E9%83%A8%E5%88%86%E3%80%82" >https://www.nordicsemi.cn/，此外请先阅读博客种无线电安全专题的蓝牙安全部分。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="常见攻击类型"><a href="#常见攻击类型" class="headerlink" title="常见攻击类型"></a>常见攻击类型</h1><h2 id="身份跟踪："><a href="#身份跟踪：" class="headerlink" title="身份跟踪："></a>身份跟踪：</h2><p>利用蓝牙地址来跟踪设备。这可以通过使用随机变化的可解析私有地址（Resolvable Random Private Address）来避免，其中只有绑定&#x2F;可信设备才能解析私有地址。IRK（身份解析密钥）用于生成和解析私有地址。</p>
<h2 id="被动窃听（嗅探）："><a href="#被动窃听（嗅探）：" class="headerlink" title="被动窃听（嗅探）："></a>被动窃听（嗅探）：</h2><p>就是攻击者偷偷窃听设备之间的数据传输。可以通过加密对等设备之间的通信来防止这种情况。这里的挑战是对等设备如何生成和&#x2F;或交换密钥以建立安全地加密连接。Bluetooth LE 传统配对的密码生成和交换存在不足，然后提出了LE secure Connections。</p>
<h2 id="主动窃听（中间人MITM）："><a href="#主动窃听（中间人MITM）：" class="headerlink" title="主动窃听（中间人MITM）："></a>主动窃听（中间人MITM）：</h2><p>在主动窃听（或中间人）攻击中，攻击者冒充合法设备来欺骗另外两个设备，与他们建立连接。为了防止这种情况，我们需要确保我们正在通信的设备实际上是我们想要与之通信的设备，而不是未经身份验证的设备。可靠的身份验证过程可以有效的防止中间人攻击。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725604289597-1.webp"
                      alt="640"
                ></p>
<h1 id="BLE-安全相关术语"><a href="#BLE-安全相关术语" class="headerlink" title="BLE 安全相关术语"></a>BLE 安全相关术语</h1><ul>
<li><strong>临时密钥</strong> (Temporary Key，TK): 临时密钥的生成取决于所选的配对方法。每次配对过程发生时都会生成 TK（仅用于传统配对）。</li>
<li><strong>短期密钥</strong> (Short Term Key，STK): 此密钥由设备之间交换的 TK 生成。每次配对过程发生时都会生成 STK，并用于加密当前连接中的数据（仅用于传统配对）。</li>
<li><strong>长期密钥</strong> (LongTerm Key，LTK): 此密钥在传统配对的第三阶段和 LE 安全连接的第二阶段期间生成和存储，是一个 128 位密钥，用于生成session key。它存储在绑定的两个设备中的每一个上，并用于两个设备之间的后续加密连接。</li>
<li><strong>加密多样化</strong>(Encrypted Diversifier，EDIV)<strong>和 随机值</strong>(Random Number，Rand): 这两个值用于创建和识别 LTK。它们也会在绑定过程中储存起来。</li>
<li><strong>身份解析密钥</strong> (ldentity Resolving Key，IRK): 用于生成和解析随机私有可解析地址（Resolvable Random  Private Address）。该密钥对于每个设备都是唯一的，因此主设备的 IRK 将存储在从设备端，而从设备的IRK 将存储在主设备端。</li>
<li><strong>连接签名解析密钥</strong>(Connection Signature Resolving Key，CSRK):  如果启用，该密钥将存储在两个绑定设备中的每一个上，用于对数据进行签名并验证附加到另一端数据的签名（used in signing data  sent over an unencrypted link ）。</li>
<li><strong>ECDH</strong>（Elliptic-curve Diffie–Hellman）椭圆曲线diffie-hellman密钥交换算法</li>
</ul>
<h1 id="可解析随机私有地址"><a href="#可解析随机私有地址" class="headerlink" title="可解析随机私有地址"></a>可解析随机私有地址</h1><p>可解析随机私有地址可以防止被未知设备扫描和追踪</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640.webp"
                      alt="图片"
                ></p>
<p>如图，由两部分组成：高位24bits是随机数部分，其中最高两个bit为”10”，用于标识地址类型；低位24bits是随机数和IRK经过hash运算得到的hash值，运算的公式为hash &#x3D; ah(IRK, prand)。</p>
<p>当对端Bluetooth LE设备扫描到该类型的蓝牙地址后，会使用保存在本机的IRK，和该地址中的prand，进行同样的hash运算，并将运算结果和地址中的hash字段比较，相同的时候，才进行后续的操作。</p>
<p>这个过程称作resolve（解析），这也是Non-resolvable private address&#x2F;Resolvable private address命名的由来。</p>
<p>以T_GAP(private_addr_int)为周期，定时更新。哪怕在广播、扫描、已连接等过程中，也可能改变。</p>
<h1 id="Bluetooth-LE安全等级"><a href="#Bluetooth-LE安全等级" class="headerlink" title="Bluetooth LE安全等级"></a>Bluetooth LE安全等级</h1><blockquote>
<p>Bluetooth LE 在安全模式 1 中定义了 4 个安全级别：</p>
<ul>
<li><p>1 级：无安全性（开放文本，意味着无需身份验证且无需加密）</p>
</li>
<li><p>2 级：未经身份验证的配对加密</p>
</li>
<li><p>3 级：经过身份验证的配对加密</p>
</li>
<li><p>4 级：经过身份验证的 LE 安全连接配对加密（LE Secure Connections）</p>
</li>
</ul>
<p>安全等级1代表没有加密。安全等级2，3对应传统配对（Legacy pairing），安全等级4对应LE安全连接（LE Secure Connections）</p>
</blockquote>
<ul>
<li><strong>传统配对（Legacy pairing）</strong></li>
</ul>
<p>在蓝牙 v4.2 之前，传统配对是Bluetooth LE中唯一可用的配对方法。它非常简单，但存在风险，因为用于加密链接的短期密钥 (STK) 很容易被破解。在传统配对中使用 Just Works 时，TK 设置为 0，这在窃听或中间人 (MITM) 方面不提供任何保护。攻击者可以轻松暴力破解 STK 并窃听连接，而且也没有办法验证设备。</p>
<ul>
<li><strong>带密钥输入</strong></li>
</ul>
<p>使用密钥输入会好一些，因为 TK 现在是一个 6 位数字，由用户在设备之间传递。例如，其中一个设备在其屏幕上显示该数字，用户使用键盘在其他设备上输入该数字。不幸的是，攻击者可以轻松嗅探正在交换的值，然后很容易找出 STK 并解密连接。即使无法直接确定 TK，也可以通过尝试所有 999999 种组合轻松破解密钥。</p>
<ul>
<li><strong>带外配对（OOB）</strong></li>
</ul>
<p>在带外配对（OOB）中，TK 通过Bluetooth LE以外的其他方式进行交换，例如使用 NFC。此方法支持使用最大 128 位的 TK，从而提高了连接的安全性。交换期间使用的 OOB 通道的安全性也决定了Bluetooth LE 连接的安全性。如果 OOB 通道受到保护以免遭受窃听和 MITM 攻击，那么Bluetooth LE链路也是如此。</p>
<p>蓝牙 SIG 不推荐使用传统配对，但如果必须使用，请使用 OOB 方式。OOB身份验证与传统配对配合使用可被视为安全的方法。</p>
<ul>
<li><strong>LE安全连接（LE Secure Connections）</strong></li>
</ul>
<p>因此，在蓝牙 v4.2 中引入了 LE 安全连接（LE Secure Connections）。<strong>LE 安全连接不使用 TK 和 STK</strong>，而是使用<strong>椭圆曲线 Diffie-Hellman (ECDH) 加密技术来生成公钥-私钥对</strong>。设备交换公钥。它们将使用四种配对方法之一（<strong>Just Works, Passkey entry, OOB or Numeric Comparison</strong>）来验证对等设备的真实性，并根据 Diffie-Hellman 密钥和身份验证数据生成 LTK。</p>
<p>尽管 Just Works 在使用 LE 安全连接时更安全，但它仍然不提供身份验证，因此不建议将其用作配对方法。密钥输入（Passkey entry）配对方式，使用密钥、ECDH 公钥和 128 位任意数字来验证连接。这意味着它比传统配对要安全得多。使用 OOB 配对仍然是推荐的选项，因为只要 OOB 通道是安全的，它就会提供保护，就像在传统配对中一样。</p>
<p>此外，此功能引入了一种称为<strong>数字比较（Numeric Comparison）</strong>的新配对方式。虽然它遵循与 Just Works 配对方式相同的程序，但它在最后增加了另一个步骤来防止 MITM 攻击，即让用户根据两个对等点上显示的值，进行手动检查和确认。</p>
<p>对等点之间交换的唯一数据是公钥。使用 ECDH 公钥加密使得破解 LTK 变得极其困难，与传统配对相比，这是一个显著的改进。</p>
<p>注：尽管大多数设备都支持 LE 安全连接，但仍有一些蓝牙 LE 产品仅支持传统配对。因此，除了 LE 安全连接之外，启用对传统配对的支持也是一个好主意，以便在您的应用程序中实现更好的兼容性。</p>
<h1 id="SMP安全管理协议"><a href="#SMP安全管理协议" class="headerlink" title="SMP安全管理协议"></a>SMP安全管理协议</h1><p>在蓝牙核心规范中，有三个主要的架构层：控制器、主机和应用程序，如下图所示。在主机层，有一个名为安全管理器 (SM) 的模块，它定义了配对和密钥分发的方法和协议、相应的安全工具箱，以及安全管理器协议 (SMP)。SMP定义了配对命令帧格式、帧结构和超时限制，用于配对和传输特定的密钥分发。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640.webp"
                      alt="Image"
                ></p>
<p>SMP具体命令如下图：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725611892231-1.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725611892232-2.webp"
                      alt="Image"
                ></p>
<h1 id="Bluetooth-LE配对过程"><a href="#Bluetooth-LE配对过程" class="headerlink" title="Bluetooth LE配对过程"></a>Bluetooth LE配对过程</h1><p>配对是为了创建密钥，然后可以使用这些密钥来加密链接。配对过程中还可能传输特定的密钥和数据，以便双方共享一些机密信息。这些机密信息可用于在未来重新连接时加密链接、验证签名或执行随机地址解析。</p>
<p>Bluetooth LE配对之前需要先建立连接。配对过程可以分为三个过程，前两个过程是必须的，第三个过程是可选的。</p>
<ul>
<li>Phase1 Pairing Feature Exchange: 配对特征交换</li>
<li>Phase2 (LE legacy pairing): Short Term Key (STK) Generation: STK密钥生成</li>
<li>Phase2 (LE Secure Connections): Long Term Key (LTK) Generation: LTK密钥生成</li>
<li>Phase3 Transport Specific Key Distribution: 传输特定密钥分发（在传统配对中，LTK 也在该阶段被派发）</li>
</ul>
<p>配对过程如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725612005266-9.webp"
                      alt="Image"
                ></p>
<h2 id="配对特征交换"><a href="#配对特征交换" class="headerlink" title="配对特征交换"></a>配对特征交换</h2><p>配对特征交换(Pairing Feature Exchange)</p>
<h3 id="1-配对命令"><a href="#1-配对命令" class="headerlink" title="1. 配对命令"></a><strong>1. 配对命令</strong></h3><p>两个设备之间的配对信息交换是通过配对请求（pairing request）和配对响应(pairing response)数据包完成的。只有主机才能发送配对请求命令，从机发送配对响应命令进行回复。如果从机也想发起配对，那么可以发送安全请求（security request ）命令，主机收到这条命令后，可以选择发送配对请求，也可以拒绝。处理逻辑如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725613943606-93.webp"
                      alt="Image"
                ></p>
<p>主机，从机都可以调用<code>int bt_conn_set_security(struct bt_conn *conn, bt_security_t sec)</code>函数来发起配对。这个函数的处理逻辑里面会判断当前的身份是主机还是从机，从而发送不同的命令。</p>
<h3 id="2-配对命令格式"><a href="#2-配对命令格式" class="headerlink" title="2. 配对命令格式"></a><strong>2. 配对命令格式</strong></h3><p>Pairing Feature Exchange主要交换I&#x2F;O能力，是否支持OOB，是否支持绑定，是否支持MITM，是否支持安全连接（SC）等，还有分发密钥的相关的信息。格式如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-96.webp"
                      alt="Image"
                ></p>
<p>1）I&#x2F;O能力包括：</p>
<ul>
<li>DisplayOnly：仅有显示能力</li>
<li>DisplayYesNo：有显示能力，并可选择“是”或“否”</li>
<li>KeyboardOnly：仅有键盘输入能力</li>
<li>NoInputNoOutput：没有输入和输出能力</li>
<li>KeyboardDisplay：有键盘输入和显示能力</li>
</ul>
<p>I&#x2F;O能力编码，如下图：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-97.webp"
                      alt="Image"
                ></p>
<p>2）OOB 数据flag如下图：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-98.webp"
                      alt="Image"
                ></p>
<p>3）AuthReq中各个字段的含义如下：</p>
<ul>
<li>Bonding Flags：指示是否支持绑定</li>
<li>MITM：如果设备需要请求 MITM 保护，则必须设置此位字段。这将启用设备的身份验证。</li>
<li>SC：代表安全连接，如果支持安全连接功能，则设置此字段。如果设备支持 LE 安全连接配对，则必须将 SC 字段设置为 1，否则必须将其设置为 0。如果两个设备都支持 LE 安全连接配对，则必须使用 LE 安全连接配对，否则将使用 LE 传统配对。</li>
<li>Keypress：仅在 Passkey Entry 协议中使用，其他协议将忽略它。设置此字段后，输入 passkey 时将使用按键通知。这将一次交换一位（one bit）passkey，这是蓝牙 4.2 相对于之前的机制（蓝牙 4.1 或更早版本）的一项重要增强。蓝牙 4.2之前的处理中，整个passkey在一次确认操作中交换。这增强了passkey交换机制，现在在 MITM 攻击中预测passkey变得更加困难。</li>
<li>CT2：表示加密过程可以使用名为 h7 的安全功能。</li>
<li>RFU：保留以备将来使用。</li>
</ul>
<p>4）最大加密密钥大小 (Maximum Encryption Key Size)：由于不同设备的处理能力不同，此字节表示设备可以处理的最大密钥大小。大小可以是 7 到 16 个字节。Nordic支持16个字节。</p>
<p>5)发起方密钥分发（Initiator Key Distribution）：此字段表示发起方希望在后续阶段生成和分发哪些密钥。</p>
<p>6)响应方密钥分发 (Responder Key Distribution)：此字段表示发起方希望请求响应方生成和分发哪些密钥。</p>
<p>密钥的种类如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617264820-99.webp"
                      alt="Image"
                ></p>
<p>EncKey代表LTK；IdKey代表IRK ；SignKey代表 CSRK；Bluetooth LE中LinkKey不被分发。</p>
<h3 id="3-配对模式选择"><a href="#3-配对模式选择" class="headerlink" title="3. 配对模式选择"></a><strong>3. 配对模式选择</strong></h3><p>通过综合考虑双方的OOB标志、MITM标志和I&#x2F;O能力，来决定使用哪种配对方法。OOB和MITM标志首先确定是直接使用OOB配对方法还是根据I&#x2F;O能力确定配对方法。如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617446630-108.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617446630-109.webp"
                      alt="Image"
                ></p>
<p>1） Initiator和Responder两方都设定了OOB flag的情况下，选用OOB</p>
<p>2） Initiator和Responder一方设定了OOB flag的情况下，需要判断SC flag</p>
<ul>
<li>Secure connection的情况下，选用OOB。</li>
<li>Legacy的情况下，需要去判断MITM flag，只要一方设定了MITM flag，就要通过I&#x2F;O能力去选择pairing mothed。如果两方都没有设定MITM flag，那么直接用Just works</li>
</ul>
<p>3） Initiator和Responder都没有设OOB的情况下，判断MITM flag</p>
<ul>
<li>只要一方设定了MITM，需要去判断I&#x2F;O能力</li>
<li>两方都没设定MITM的情况下，使用Just Works</li>
</ul>
<h2 id="密钥生成阶段"><a href="#密钥生成阶段" class="headerlink" title="密钥生成阶段"></a>密钥生成阶段</h2><h3 id="1-传统配对方式，生成STK，流程如下："><a href="#1-传统配对方式，生成STK，流程如下：" class="headerlink" title="1. 传统配对方式，生成STK，流程如下："></a>1. 传统配对方式，生成STK，流程如下：</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-114.webp"
                      alt="Image"
                ></p>
<p>传统配对方式中，首先交换临时密钥 (TK)，用于生成短期密钥 (STK)，然后使用短期密钥 (STK) 加密链路，传输长期密钥（LTK）。</p>
<h4 id="1-1-传统配对定义了三种不同的方法来交互-TK"><a href="#1-1-传统配对定义了三种不同的方法来交互-TK" class="headerlink" title="1.1 传统配对定义了三种不同的方法来交互 TK"></a>1.1 传统配对定义了三种不同的方法来交互 TK</h4><ul>
<li>Just Works：TK默认为0，不提供身份验证，因此无法防御 MITM 攻击。</li>
<li>Passkey Entry ：一台设备上显示 6 位数字密码（passkey），另一台设备上需要输入。设备的 I&#x2F;O 能力决定了哪台设备显示数字以及哪台设备输入数字。用户输入的6位数字passkey，用前导零填充以得出 128 位TK值。</li>
<li>Out of Band：在设备之间通过带外通信，传递完整 128 位TK值，例如使用 NFC传输。</li>
</ul>
<p>注：Just Works 配对不提供身份验证，无法防御 MITM 攻击。</p>
<h4 id="1-2-传统配对的认证（authentication）过程："><a href="#1-2-传统配对的认证（authentication）过程：" class="headerlink" title="1.2 传统配对的认证（authentication）过程："></a>1.2 传统配对的认证（authentication）过程：</h4><p>首先，每个设备计算一个 128 位的确认值（confirm value）。确认值是使用名为 c1 的函数计算的，该函数接受多个参数，包括 TK。除了 TK 值之外，还包括两个设备都知道的字段以及一个随机数，在这个阶段，只有创建确认值的设备知道这个随机数。在主机上，这个值称为LP_RAND_I。在从机上，称为LP_RAND_R。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-115.webp"
                      alt="Image"
                ></p>
<p>然后，主机将其确认值 (LP_CONFIRM_I) 发送到从机，从机以其确认值 (LP_CONFIRM_R) 进行响应。</p>
<p>收到 LP_CONFIRM_R 后，主机发送自己的随机数 LP_RAND_I给从机。从机计算出LP_CONFIRM_I 值，并将其与主机端发送过来的 LP_CONFIRM_I 值进行比较。如果它们匹配，则从机已对主机进行了身份验证，因此它将发送自己的随机数LP_RAND_R进行响应。主机计算 LP_CONFIRM_R 值并将其与之前收到的值进行比较。如果它们匹配，则主机完成了对从机的身份验证。</p>
<p>以Passkey为例，认证流程如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725617957620-116.webp"
                      alt="Image"
                ></p>
<h4 id="1-3传统配对中，STK的生成公式如下："><a href="#1-3传统配对中，STK的生成公式如下：" class="headerlink" title="1.3传统配对中，STK的生成公式如下："></a>1.3传统配对中，STK的生成公式如下：</h4><p><code>STK=s1(TK,LP_RAND_R,LP_RAND_I)</code></p>
<p>注意：TK值是不会被蓝牙链路传输的，这确保了一定的安全性。TK的密码强度直接影响了STK的密码强度，显然OOB要好一些。</p>
<h3 id="2-安全配对方式，-生成LTK"><a href="#2-安全配对方式，-生成LTK" class="headerlink" title="2.安全配对方式， 生成LTK"></a>2.安全配对方式， 生成LTK</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320055-123.webp"
                      alt="Image"
                ></p>
<p>LE 安全连接使用椭圆曲线 Diffie-Hellman (ECDH) 密钥交换算法交换数据，然后使用数据创建对称密钥，称为长期密钥 (LTK)。</p>
<h4 id="2-1-Public-Key-Exchange"><a href="#2-1-Public-Key-Exchange" class="headerlink" title="2.1 Public Key Exchange"></a>2.1 Public Key Exchange</h4><p>发起配对的设备（发起者）将其公钥发送给另一台设备（响应者），后者用其公钥进行回复。公钥在收到后进行检验，以检查它们是否在正确的椭圆曲线上。注意，LE 安全连接仅使用 P-256 曲线。</p>
<h4 id="2-2-Calculate-DHKey"><a href="#2-2-Calculate-DHKey" class="headerlink" title="2.2 Calculate DHKey"></a>2.2 Calculate DHKey</h4><p>每个设备都会计算一个称为 Diffie-Hellman key (DHKey) 的密钥。假设一方是Alice，一方是Bob，Alice 和 Bob 这两个设备按以下方式计算 DHKey：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Alice: DHKey = P256(SKa, PKb) Bob: DHKey = P256(SKb, PKa)</span><br></pre></td></tr></table></figure></div>

<p>两个设备 A 和 B 的私钥分别表示为 SKa 和 SKb。PKa和PKb是它们的公钥，交换之后，双方都知道对方的公钥。基于公钥和私钥作为参数，两边能计算出相同的DHkey。DHKey 是一个对称共享密钥。</p>
<p>上述过程如下图所示（图一描述过程，图二描述协议）：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-124.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/640-1725618320056-125.webp"
                      alt="Image"
                ></p>
<h4 id="2-3-Authentication-Stage-1"><a href="#2-3-Authentication-Stage-1" class="headerlink" title="2.3 Authentication Stage 1"></a>2.3 Authentication Stage 1</h4><p>不同的配对模式，对应的算法略有不同。LE安全配对有4种模式，除了前面提到的传统配对中的3种模式以外，还引入了一种新模式，称为数字比较（Numeric Comparison）</p>
<p>1） Just Works 和Numeric Comparison身份验证阶段1：</p>
<p>首先，设备 B 生成一个伪随机数 Nb，并将其与两个设备的公钥一起，作为 f4 （函数）的参数，来计算确认值Cb 。Cb&#x3D;f4(PKb, PKa, Nb, 0)，然后将 Cb 发送到设备 A。由于设备 A 不知道 Nb 的值，因此它无法在此阶段对确认值执行任何操作。</p>
<p>设备 A 现在将其自己的伪随机数 Na 发送到设备 B，设备 B 则用其随机数 Nb 回复。现在，设备 A 拥有 f4 函数的所有参数，因此它使用在公钥交换期间获取的公钥和刚刚收到的另一台设备的随机数 Nb 重新计算确认值。它将计算出的确认值与从设备 B 收到的 Cb 值进行比较。如果它们不相同，则配对中止。</p>
<p>如果使用 Just Works，则身份验证第 1 阶段已完成。如果使用Numeric Comparison，则还需要执行一步。</p>
<p>每个设备使用两个公钥 PKa 和 PKb 以及两个伪随机数 Na 和 Nb，通过g2 函数计算出一个六位数字。然后，每个设备显示其计算出的数字。用户被邀请确认两个设备是否显示相同的六位数字，也可以通过按下特定按钮来实现。通过指示两个数字相同，用户确认参与通信的两个设备确实是用户尝试配对的设备。换句话说，用户参与了配对设备的身份验证。对设备进行身份验证后，就会进入身份验证阶段 2。</p>
<p>另一方面，如果用户发现两个数字不相同，则身份验证阶段 1 失败，并且终止该过程。</p>
<p>具体流程如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-126.webp"
                      alt="Image"
                ></p>
<p>2） Passkey Entry身份验证阶段1：</p>
<p>用户输入密码（Passkey）后，设备会计算、交换和检查确认值 Ca 和 Cb。但是，与 Just Works&#x2F;Numeric Comparison 中的单次确认不同，使用密码（Passkey）输入，确认过程是迭代和增量的。</p>
<p>在每次迭代过程中，每个设备都会生成一个 128 位随机数 Na 或 Nb，并且每次将密钥值的一位纳入确认值的计算中。确认值函数 f4 的输入包括两个公钥、本次迭代的随机数以及从本次迭代的密码位值派生的值。</p>
<p>每次迭代都会交换和检查确认值。Cai&#x3D;f4(Pka, PKb, Nai, rbi)，Cbi&#x3D;f4(PKb, PKa, Nbi, rbi)（i&#x3D;0 to 19）（ra&#x3D;rb&#x3D;passkey）rai和rbi是passkey二进制值对应的每一位。</p>
<p>六位密码（passkey）对应 20 位二进制数字（999999&#x3D;0xF423F），因此计算、交换和检查完整确认值的过程需要迭代20次，每次迭代都会合并或披露密码的新位。这种方法称为“逐步披露”，其优点是 MITM 攻击在实际应用中更加困难，大多数攻击在攻击者尚未看到完整和最终确认值的情况下就会提前失败。缺点是计算过程比较复杂，数据交互的次数较多，耗时耗电。</p>
<p>具体流程如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-127.webp"
                      alt="Image"
                ></p>
<p>3） OOB身份验证阶段1：</p>
<p>使用 OOB 方式，整个过程使用非蓝牙的数据交换机制进行的。</p>
<p>具体流程如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-128.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-129.webp"
                      alt="Image"
                ></p>
<p>使用带内接收的公钥和带外接收的随机数 ra 和 rb 重新计算接收到的确认值 Ca 和 Cb，这个是基于OOB双向数据传输的情况。如果 OOB 通信只能在一个方向上进行（单方向传输数据），则接收 OOB 数据的设备的认证将基于该设备知道通过 OOB 发送的随机数 r（ra或rb）。</p>
<p>在这种情况下，r 必须是保密的：r 可以每次重新创建，或者必须限制对发送 r 的设备的访问。如果设备未发送 r，则设备会将其假定为 0。计算出的确认值必须与接收到的 OOB 值匹配。如果两者之一不匹配，配对将中止。</p>
<p>2.4 Authentication Stage 2</p>
<p>身份验证阶段 2 有四个步骤。</p>
<p>1）使用函数 f5 计算长期密钥 (LTK) 和 MacKey ，MacKey || LTK &#x3D; f5(DHKey, Na, Nb, BD_ADDR_C, BD_ADDR_P)</p>
<p>2）设备 A 计算称为 Ea 的检查值并将其发送到设备 B，在设备 B 中重新计算该值并将其与收到的值进行比较</p>
<p>3）设备 B 计算称为 Eb 的检查值并将其发送到设备 A，在设备 A 中重新计算该值并将其与收到的值进行比较</p>
<p>4）使用计算出的 LTK 在链路上启动加密，为阶段 3 做好准备</p>
<p>Ea,Eb的计算公式如下表：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-130.webp"
                      alt="Image"
                ></p>
<p>如果步骤 2 或 3 中的任何一个检查失败，配对将中止。具体流程如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725618320056-131.webp"
                      alt="Image"
                ></p>
<h2 id="密钥分发"><a href="#密钥分发" class="headerlink" title="密钥分发"></a>密钥分发</h2><ul>
<li>对于传统配对和LE安全连接，它们分发的内容是有区别的。另外，传统配对密钥分发的链路是通过STK加密的；LE安全连接的密钥分发是通过LTK加密的。传统配对可能分发的内容如下：</li>
</ul>
<ol>
<li>LTK by the Peripheral</li>
<li>EDIV AND Rand by the Peripheral</li>
<li>IRK by the Peripheral</li>
<li>BD_ADDR by the Peripheral</li>
<li>CSRK by the Peripheral</li>
<li>LTK by the Central</li>
<li>EDIV and Rand by the Central</li>
<li>IRK by the Central</li>
<li>BD_ADDR by the Central</li>
<li>CSRK by the Central</li>
</ol>
<ul>
<li>LE安全连接可能分发的内容如下：</li>
</ul>
<ol>
<li>IRK by the Peripheral</li>
<li>BD_ADDR by the Peripheral</li>
<li>CSRK by the Peripheral</li>
<li>IRK by the Central</li>
<li>BD_ADDR by the Central</li>
<li>CSRK by the Central</li>
</ol>
<h2 id="Bluetooth-LE绑定"><a href="#Bluetooth-LE绑定" class="headerlink" title="Bluetooth LE绑定"></a>Bluetooth LE绑定</h2><p>创建绑定后，每个设备都会存储已分发的密钥信息，并在下一次连接中使用这些密钥，这样就可以跳过配对过程，从而节省能源并减少用户操作设备时必须等待的时间。</p>
<p>LTK 存储在安全数据库中，并通过 EDIV 和 Rand 值进行标识。执行绑定后，每次后续重新连接都将使用已分发的 LTK 生成的密钥来加密链接。</p>
<p>NCS中可以通过配置编译选项使能绑定功能（CONFIG_BT_BONDABLE&#x3D;y）。注意，绑定信息存储在settings区，更具体的是bt settings区域，所以，使能绑定功能的同时也要使能bt settings区。具体信息如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781751-162.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781751-163.webp"
                      alt="Image"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2024/08/19/BLE%E8%93%9D%E7%89%99%E5%AE%89%E5%85%A8/640-1725619781752-164.webp"
                      alt="Image"
                ></p>
<p>如果要删除绑定信息，可以调用int bt_unpair(uint8_t id, const bt_addr_le_t *addr)函数，函数说明和使用示例如下：</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @brief Clear pairing information.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @param id  Local identity (mostly just BT_ID_DEFAULT).</span></span><br><span class="line"><span class="comment">* @param addr Remote address, NULL or BT_ADDR_LE_ANY to clear all remote                 *             devices.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @return 0 on success or negative error value on failure.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bt_unpair</span><span class="params">(<span class="type">unit8_t</span> id, <span class="type">const</span> <span class="type">bt_addr_le_t</span> *addr)</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">button_changed</span><span class="params">(<span class="type">unit32_t</span> button_state,<span class="type">unit32_t</span> has_changed)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">int</span> err;</span><br><span class="line">     <span class="type">unit32_t</span> buttons = button_state &amp; has_changed;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span>(buttons &amp; KEY_BOND_REMOVE_MASK) &#123;</span><br><span class="line">        err = bt_unpair(BT_ID_DEFAULT,<span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          printk(<span class="string">&quot;Bond remove failed err: %d\n&quot;</span>, err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            printk(<span class="string">&quot;All bond removed\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">remove_peers</span><span class="params">(<span class="type">unit8_t</span> identity)</span></span><br><span class="line">&#123;</span><br><span class="line">    LOG_INF(<span class="string">&quot;Remove peer on identity %u&quot;</span>, identity);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> err = bt_unpair(get_bt_stack_peer_id(identity), BT_ADDR_LE_ANY);</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        LOG_ERR(<span class="string">&quot;Failed to remove&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> BLE蓝牙安全</li>
        <li><strong>Author:</strong> 韩乔落</li>
        <li><strong>Created at
                :</strong> 2024-08-19 11:12:11</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-09-09 11:45:54
            </li>
        
        <li>
            <strong>Link:</strong> https://jelasin.github.io/2024/08/19/BLE蓝牙安全/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/BLE%E5%AE%89%E5%85%A8/">#BLE安全</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2024/09/09/Android%E5%AE%89%E5%85%A8-%E6%8A%93%E5%8C%85%E7%AF%87/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Android安全-抓包篇</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2024/08/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BATEE/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">深入浅出TEE</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'jelasin/jelasin.github.io',
                'data-repo-id': 'R_kgDOKVydDA',
                'data-category': 'Announcements',
                'data-category-id': 'DIC_kwDOKVydDM4CZe2W',
                'data-mapping': 'pathname',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'zh-CN',
                'data-input-position': 'bottom',
                'data-loading': 'not-lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">BLE蓝牙安全</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E7%B1%BB%E5%9E%8B"><span class="nav-text">常见攻击类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BA%AB%E4%BB%BD%E8%B7%9F%E8%B8%AA%EF%BC%9A"><span class="nav-text">身份跟踪：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A2%AB%E5%8A%A8%E7%AA%83%E5%90%AC%EF%BC%88%E5%97%85%E6%8E%A2%EF%BC%89%EF%BC%9A"><span class="nav-text">被动窃听（嗅探）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E7%AA%83%E5%90%AC%EF%BC%88%E4%B8%AD%E9%97%B4%E4%BA%BAMITM%EF%BC%89%EF%BC%9A"><span class="nav-text">主动窃听（中间人MITM）：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BLE-%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD"><span class="nav-text">BLE 安全相关术语</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%A7%A3%E6%9E%90%E9%9A%8F%E6%9C%BA%E7%A7%81%E6%9C%89%E5%9C%B0%E5%9D%80"><span class="nav-text">可解析随机私有地址</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bluetooth-LE%E5%AE%89%E5%85%A8%E7%AD%89%E7%BA%A7"><span class="nav-text">Bluetooth LE安全等级</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SMP%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE"><span class="nav-text">SMP安全管理协议</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bluetooth-LE%E9%85%8D%E5%AF%B9%E8%BF%87%E7%A8%8B"><span class="nav-text">Bluetooth LE配对过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E5%AF%B9%E7%89%B9%E5%BE%81%E4%BA%A4%E6%8D%A2"><span class="nav-text">配对特征交换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%85%8D%E5%AF%B9%E5%91%BD%E4%BB%A4"><span class="nav-text">1. 配对命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%85%8D%E5%AF%B9%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="nav-text">2. 配对命令格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%85%8D%E5%AF%B9%E6%A8%A1%E5%BC%8F%E9%80%89%E6%8B%A9"><span class="nav-text">3. 配对模式选择</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E9%98%B6%E6%AE%B5"><span class="nav-text">密钥生成阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BC%A0%E7%BB%9F%E9%85%8D%E5%AF%B9%E6%96%B9%E5%BC%8F%EF%BC%8C%E7%94%9F%E6%88%90STK%EF%BC%8C%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="nav-text">1. 传统配对方式，生成STK，流程如下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E9%85%8D%E5%AF%B9%E6%96%B9%E5%BC%8F%EF%BC%8C-%E7%94%9F%E6%88%90LTK"><span class="nav-text">2.安全配对方式， 生成LTK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E5%88%86%E5%8F%91"><span class="nav-text">密钥分发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bluetooth-LE%E7%BB%91%E5%AE%9A"><span class="nav-text">Bluetooth LE绑定</span></a></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
            <div class="customize-info my-1">关山初度尘未洗，策马扬鞭再奋蹄。</div>
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-circle-info fa-beat-fade" style="--fa-beat-fade-opacity: 0.67; --fa-beat-fade-scale: 1.075;" ></i>&nbsp;&nbsp;<a href="/">韩乔落</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        71 posts in total
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>


<script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Swup.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupSlideTheme.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScriptsPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupProgressPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupScrollPlugin.min.js" ></script><script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/SwupPreloadPlugin.min.js" ></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	<script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/imageViewer.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/utils.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/main.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/navbarShrink.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/scrollTopBottom.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/lightDarkSwitch.js" ></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/categoryList.js" ></script>


    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/localSearch.js" ></script>



    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/codeBlock.js" ></script>



    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/lazyload.js" ></script>



    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/runtime.js" ></script>
    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/odometer.min.js" ></script>
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/assets/odometer-theme-minimal.css">



  <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/Typed.min.js" ></script>
  <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/typed.js" ></script>







    <script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/anime.min.js" ></script>




    <script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/plugins/tabs.js" data-swup-reload-script></script>


<script  src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script>
<script type="module" src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.2/files/source/js/build/layouts/essays.js" data-swup-reload-script></script>




	
</body>

</html>